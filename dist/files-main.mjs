/*! third party licenses: dist/vendor.LICENSE.txt */
var $i=Object.defineProperty;var zi=(e,r,n)=>r in e?$i(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n;var xt=(e,r,n)=>(zi(e,typeof r!="symbol"?r+"":r,n),n);import{d as ct,m as Wi,P as Hi}from"./chunks/pinia-DMoXqkoa.mjs";import{Q as bt,f as ii,L as ut,b as Gi,u as Ki,T as Yi,J as _t,D as Qi,N as Tt,v as Ne,_ as Xi,i as Zi,r as Ee,W as Ji,p as to,s as eo}from"./chunks/index-BdIeO5n5.mjs";import{aW as H,b_ as Ft,c0 as Lt,c1 as nt,bS as De,bR as At,g as oi,aa as ro,bT as B,O as no,A as io,G as Ce,cc as oo,c2 as so,bY as ao,S as lo,a1 as kt,c7 as U,cb as uo,d9 as co,bV as Q,ca as ne,a$ as et,J as ho,E as po,da as fo,b as si,v as ai,l as mo,a4 as Gt,al as go,db as yo,P as vo,F as li,cd as wo,H as bo,X as _o,ch as ie,c6 as To,N as So}from"./core-common.mjs";import{b as Kt,M as ui,d as No,U as ci,h as Eo,e as tr,f as di,j as Do,k as Co,Y as xo,p as Oo}from"./chunks/LivePhotos-CUhPYrnz.mjs";import{q as Ao}from"./chunks/base-DGiCN8Wo.mjs";import{V as Yt}from"./chunks/vue-router.esm-CkRP8kF4.mjs";import{bB as Io,n as J,z as Po,bC as Fo,bD as Lo,bE as ko,a8 as hi,bF as Mo,bc as Ro,ak as er,bG as _e,a9 as jo,bH as Vo,bI as rr,N as Te,bJ as nr,bK as ir,bL as Bo,bg as Uo,bh as qo,bM as $o,bN as zo,b5 as Wo,bO as Ho}from"./chunks/icons-Dg_LJaFK.mjs";import{l as V}from"./chunks/logger-abzvQ-j7.mjs";import{p as It}from"./chunks/index-7XKGWWeV.mjs";import{z as X,B as Mt,j as xe,_ as Go}from"./chunks/_plugin-vue2_normalizer-VrK6B12S-B9aYHv6f.mjs";import{u as pi,i as Rt}from"./chunks/util-MKsKVvMG.mjs";import{T as wt}from"./chunks/index-YIotKjSS.mjs";import{a as zt}from"./chunks/sidebarAction-Cvd2IrgV.mjs";import{j as Ko}from"./chunks/index-CFlSzEWv.mjs";import{m as Yo}from"./chunks/index-BB6ZXwkp.mjs";import{h as Qo}from"./chunks/Files-CnJT5alL.mjs";import{a as Xo,d as Zo}from"./chunks/index-D61A_Z5g.mjs";import"./chunks/index-Dizl7-P2.mjs";import"./chunks/index-BHGcQw02.mjs";import"./chunks/preload-helper-BG02UnR2.mjs";import"./chunks/index-BxD44Goc.mjs";H.use(Yt);const or=Yt.prototype.push;Yt.prototype.push=function(e,r,n){return r||n?or.call(this,e,r,n):or.call(this,e).catch(o=>o)};const fi=new Yt({mode:"history",base:Ft("/apps/files"),linkActiveClass:"active",routes:[{path:"/",redirect:{name:"filelist",params:{view:"files"}}},{path:"/:view/:fileid(\\d+)?",name:"filelist",props:!0}],stringifyQuery(e){const r=Ao.stringify(e).replace(/%2F/gmi,"/");return r?"?"+r:""}});var Jo=Object.defineProperty,ts=(e,r,n)=>r in e?Jo(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,es=(e,r,n)=>(ts(e,r+"",n),n);class rs{constructor(r){es(this,"_router"),this._router=r}get name(){return this._router.currentRoute.name}get query(){return this._router.currentRoute.query||{}}get params(){return this._router.currentRoute.params||{}}goTo(r,n=!1){return this._router.push({path:r,replace:n})}goToRoute(r,n,o,l){return this._router.push({name:r,query:o,params:n,replace:l})}}let ns=class{constructor(e,{el:r,open:n,close:o}){xt(this,"_close");xt(this,"_el");xt(this,"_name");xt(this,"_open");this._name=e,this._el=r,this._open=n,this._close=o,typeof this._open!="function"&&(this._open=()=>{}),typeof this._close!="function"&&(this._close=()=>{})}get name(){return this._name}get el(){return this._el}get open(){return this._open}get close(){return this._close}},is=class{constructor(){xt(this,"_settings");this._settings=[],console.debug("OCA.Files.Settings initialized")}register(e){return this._settings.filter(r=>r.name===e.name).length>0?(console.error("A setting with the same name is already registered"),!1):(this._settings.push(e),!0)}get settings(){return this._settings}};const os=Lt("files","viewConfigs",{}),Oe=function(...e){const r=ct("viewconfig",{state:()=>({viewConfig:os}),getters:{getConfig:n=>o=>n.viewConfig[o]||{}},actions:{onUpdate(n,o,l){this.viewConfig[n]||H.set(this.viewConfig,n,{}),H.set(this.viewConfig[n],o,l)},async update(n,o,l){De.put(Ft("/apps/files/api/v1/views/".concat(n,"/").concat(o)),{value:l}),At("files:viewconfig:updated",{view:n,key:o,value:l})},setSortingBy(n="basename",o="files"){this.update(o,"sorting_mode",n),this.update(o,"sorting_direction","asc")},toggleSortingDirection(n="files"){const o=(this.getConfig(n)||{sorting_direction:"asc"}).sorting_direction==="asc"?"desc":"asc";this.update(n,"sorting_direction",o)}}})(...e);return r._initialized||(nt("files:viewconfig:updated",function({view:n,key:o,value:l}){r.onUpdate(n,o,l)}),r._initialized=!0),r};function mi(e,r,n){var o=n||{},l=o.noTrailing,i=l===void 0?!1:l,s=o.noLeading,a=s===void 0?!1:s,c=o.debounceMode,w=c===void 0?void 0:c,y,g=!1,m=0;function E(){y&&clearTimeout(y)}function N(C){var S=C||{},v=S.upcomingOnly,d=v===void 0?!1:v;E(),g=!d}function D(){for(var C=arguments.length,S=new Array(C),v=0;v<C;v++)S[v]=arguments[v];var d=this,f=Date.now()-m;if(g)return;function b(){m=Date.now(),r.apply(d,S)}function x(){y=void 0}!a&&w&&!y&&b(),E(),w===void 0&&f>e?a?(m=Date.now(),i||(y=setTimeout(w?x:b,e))):b():i!==!0&&(y=setTimeout(w?x:b,w===void 0?e-f:e))}return D.cancel=N,D}function ss(e,r,n){var o={},l=o.atBegin,i=l===void 0?!1:l;return mi(e,r,{debounceMode:i!==!1})}const as={name:"NavigationQuota",components:{ChartPie:Io,NcAppNavigationItem:oi,NcProgressBar:ro},data(){return{loadingStorageStats:!1,storageStats:Lt("files","storageStats",null)}},computed:{storageStatsTitle(){var n,o,l;const e=bt((n=this.storageStats)==null?void 0:n.used,!1,!1),r=bt((o=this.storageStats)==null?void 0:o.quota,!1,!1);return((l=this.storageStats)==null?void 0:l.quota)<0?this.t("files","{usedQuotaByte} used",{usedQuotaByte:e}):this.t("files","{used} of {quota} used",{used:e,quota:r})},storageStatsTooltip(){return this.storageStats.relative?this.t("files","{relative}% used",this.storageStats):""}},beforeMount(){setInterval(this.throttleUpdateStorageStats,60*1e3),nt("files:node:created",this.throttleUpdateStorageStats),nt("files:node:deleted",this.throttleUpdateStorageStats),nt("files:node:moved",this.throttleUpdateStorageStats),nt("files:node:updated",this.throttleUpdateStorageStats)},mounted(){var e,r;((e=this.storageStats)==null?void 0:e.quota)>0&&((r=this.storageStats)==null?void 0:r.free)<=0&&this.showStorageFullWarning()},methods:{debounceUpdateStorageStats:ss(200,function(e){this.updateStorageStats(e)}),throttleUpdateStorageStats:mi(1e3,function(e){this.updateStorageStats(e)}),async updateStorageStats(e=null){var r,n,o,l;if(!this.loadingStorageStats){this.loadingStorageStats=!0;try{const i=await De.get(Ft("/apps/files/api/v1/stats"));if(!((r=i==null?void 0:i.data)!=null&&r.data))throw new Error("Invalid storage stats");((n=this.storageStats)==null?void 0:n.free)>0&&((o=i.data.data)==null?void 0:o.free)<=0&&((l=i.data.data)==null?void 0:l.quota)>0&&this.showStorageFullWarning(),this.storageStats=i.data.data}catch(i){V.error("Could not refresh storage stats",{error:i}),e&&X(t("files","Could not refresh storage stats"))}finally{this.loadingStorageStats=!1}}},showStorageFullWarning(){X(this.t("files","Your storage is full, files can not be updated or synced anymore!"))},t:B}};var ls=function(){var e=this,r=e._self._c;return e.storageStats?r("NcAppNavigationItem",{staticClass:"app-navigation-entry__settings-quota",class:{"app-navigation-entry__settings-quota--not-unlimited":e.storageStats.quota>=0},attrs:{"aria-label":e.t("files","Storage informations"),loading:e.loadingStorageStats,name:e.storageStatsTitle,title:e.storageStatsTooltip,"data-cy-files-navigation-settings-quota":""},on:{click:function(n){return n.stopPropagation(),n.preventDefault(),e.debounceUpdateStorageStats.apply(null,arguments)}}},[r("ChartPie",{attrs:{slot:"icon",size:20},slot:"icon"}),e.storageStats.quota>=0?r("NcProgressBar",{attrs:{slot:"extra",error:e.storageStats.relative>80,value:Math.min(e.storageStats.relative,100)},slot:"extra"}):e._e()],1):e._e()},us=[],cs=J(as,ls,us,!1,null,"10146d3e");const ds=cs.exports,hs={name:"Setting",props:{el:{type:Function,required:!0}},mounted(){this.$el.appendChild(this.el())}};var ps=function(){var e=this,r=e._self._c;return r("div")},fs=[],ms=J(hs,ps,fs,!1,null,null);const gs=ms.exports,ys={name:"Settings",components:{Clipboard:Po,NcAppSettingsDialog:no,NcAppSettingsSection:io,NcCheckboxRadioSwitch:Ce,NcInputField:oo,Setting:gs},props:{open:{type:Boolean,default:!1}},setup(){return{userConfigStore:Kt()}},data(){var e,r,n,o,l;return{settings:((n=(r=(e=window.OCA)==null?void 0:e.Files)==null?void 0:r.Settings)==null?void 0:n.settings)||[],webdavUrl:so("dav/files/"+encodeURIComponent((o=ao())==null?void 0:o.uid)),webdavDocs:"https://docs.nextcloud.com/server/stable/go.php?to=user-webdav",appPasswordUrl:Ft("/settings/user/security#generate-app-token-section"),webdavUrlCopied:!1,enableGridView:(l=Lt("core","config",[])["enable_non-accessible_features"])!=null?l:!0}},computed:{userConfig(){return this.userConfigStore.userConfig}},beforeMount(){this.settings.forEach(e=>e.open())},beforeDestroy(){this.settings.forEach(e=>e.close())},methods:{onClose(){this.$emit("close")},setConfig(e,r){this.userConfigStore.update(e,r)},async copyCloudId(){if(document.querySelector("input#webdav-url-input").select(),!navigator.clipboard){X(t("files","Clipboard is not available"));return}await navigator.clipboard.writeText(this.webdavUrl),this.webdavUrlCopied=!0,Mt(t("files","WebDAV URL copied to clipboard")),setTimeout(()=>{this.webdavUrlCopied=!1},5e3)},t:B}};var vs=function(){var e=this,r=e._self._c;return r("NcAppSettingsDialog",{attrs:{open:e.open,"show-navigation":!0,name:e.t("files","Files settings")},on:{"update:open":e.onClose}},[r("NcAppSettingsSection",{attrs:{id:"settings",name:e.t("files","Files settings")}},[r("NcCheckboxRadioSwitch",{attrs:{"data-cy-files-settings-setting":"sort_favorites_first",checked:e.userConfig.sort_favorites_first},on:{"update:checked":function(n){return e.setConfig("sort_favorites_first",n)}}},[e._v(" "+e._s(e.t("files","Sort favorites first"))+" ")]),r("NcCheckboxRadioSwitch",{attrs:{"data-cy-files-settings-setting":"sort_folders_first",checked:e.userConfig.sort_folders_first},on:{"update:checked":function(n){return e.setConfig("sort_folders_first",n)}}},[e._v(" "+e._s(e.t("files","Sort folders before files"))+" ")]),r("NcCheckboxRadioSwitch",{attrs:{"data-cy-files-settings-setting":"show_hidden",checked:e.userConfig.show_hidden},on:{"update:checked":function(n){return e.setConfig("show_hidden",n)}}},[e._v(" "+e._s(e.t("files","Show hidden files"))+" ")]),r("NcCheckboxRadioSwitch",{attrs:{"data-cy-files-settings-setting":"crop_image_previews",checked:e.userConfig.crop_image_previews},on:{"update:checked":function(n){return e.setConfig("crop_image_previews",n)}}},[e._v(" "+e._s(e.t("files","Crop image previews"))+" ")]),e.enableGridView?r("NcCheckboxRadioSwitch",{attrs:{"data-cy-files-settings-setting":"grid_view",checked:e.userConfig.grid_view},on:{"update:checked":function(n){return e.setConfig("grid_view",n)}}},[e._v(" "+e._s(e.t("files","Enable the grid view"))+" ")]):e._e()],1),e.settings.length!==0?r("NcAppSettingsSection",{attrs:{id:"more-settings",name:e.t("files","Additional settings")}},[e._l(e.settings,function(n){return[r("Setting",{key:n.name,attrs:{el:n.el}})]})],2):e._e(),r("NcAppSettingsSection",{attrs:{id:"webdav",name:e.t("files","WebDAV")}},[r("NcInputField",{attrs:{id:"webdav-url-input",label:e.t("files","WebDAV URL"),"show-trailing-button":!0,success:e.webdavUrlCopied,"trailing-button-label":e.t("files","Copy to clipboard"),value:e.webdavUrl,readonly:"readonly",type:"url"},on:{focus:function(n){return n.target.select()},"trailing-button-click":e.copyCloudId},scopedSlots:e._u([{key:"trailing-button-icon",fn:function(){return[r("Clipboard",{attrs:{size:20}})]},proxy:!0}])}),r("em",[r("a",{staticClass:"setting-link",attrs:{href:e.webdavDocs,target:"_blank",rel:"noreferrer noopener"}},[e._v(" "+e._s(e.t("files","Use this address to access your Files via WebDAV"))+" ↗ ")])]),r("br"),r("em",[r("a",{staticClass:"setting-link",attrs:{href:e.appPasswordUrl}},[e._v(" "+e._s(e.t("files","If you have enabled 2FA, you must create and use a new app password by clicking here."))+" ↗ ")])])],1)],1)},ws=[],bs=J(ys,vs,ws,!1,null,"c96944d7");const _s=bs.exports,Ts={name:"Navigation",components:{Cog:Fo,NavigationQuota:ds,NcAppNavigation:lo,NcAppNavigationItem:oi,NcIconSvgWrapper:kt,SettingsModal:_s},setup(){return{viewConfigStore:Oe()}},data(){return{settingsOpened:!1}},computed:{currentViewId(){var e,r;return((r=(e=this.$route)==null?void 0:e.params)==null?void 0:r.view)||"files"},currentView(){return this.views.find(e=>e.id===this.currentViewId)},views(){return this.$navigation.views},parentViews(){return this.views.filter(e=>!e.parent).sort((e,r)=>e.order-r.order)},childViews(){return this.views.filter(e=>!!e.parent).reduce((e,r)=>(e[r.parent]=[...e[r.parent]||[],r],e[r.parent].sort((n,o)=>n.order-o.order),e),{})}},watch:{currentView(e,r){e.id!==(r==null?void 0:r.id)&&(this.$navigation.setActive(e),V.debug("Navigation changed from ".concat(r.id," to ").concat(e.id),{from:r,to:e}),this.showView(e))}},beforeMount(){this.currentView&&(V.debug("Navigation mounted. Showing requested view",{view:this.currentView}),this.showView(this.currentView))},methods:{useExactRouteMatching(e){var r;return((r=this.childViews[e.id])==null?void 0:r.length)>0},showView(e){var r,n,o,l;(l=(o=(n=(r=window==null?void 0:window.OCA)==null?void 0:r.Files)==null?void 0:n.Sidebar)==null?void 0:o.close)==null||l.call(o),this.$navigation.setActive(e),At("files:navigation:changed",e)},onToggleExpand(e){const r=this.isExpanded(e);e.expanded=!r,this.viewConfigStore.update(e.id,"expanded",!r)},isExpanded(e){var r;return typeof((r=this.viewConfigStore.getConfig(e.id))==null?void 0:r.expanded)=="boolean"?this.viewConfigStore.getConfig(e.id).expanded===!0:e.expanded===!0},generateToNavigation(e){if(e.params){const{dir:r}=e.params;return{name:"filelist",params:e.params,query:{dir:r}}}return{name:"filelist",params:{view:e.id}}},openSettings(){this.settingsOpened=!0},onSettingsClose(){this.settingsOpened=!1},t:B}};var Ss=function(){var e=this,r=e._self._c;return r("NcAppNavigation",{attrs:{"data-cy-files-navigation":"","aria-label":e.t("files","Files")},scopedSlots:e._u([{key:"list",fn:function(){return e._l(e.parentViews,function(n){return r("NcAppNavigationItem",{key:n.id,attrs:{"allow-collapse":!0,"data-cy-files-navigation-item":n.id,exact:e.useExactRouteMatching(n),icon:n.iconClass,name:n.name,open:e.isExpanded(n),pinned:n.sticky,to:e.generateToNavigation(n)},on:{"update:open":function(o){return e.onToggleExpand(n)}}},[n.icon?r("NcIconSvgWrapper",{attrs:{slot:"icon",svg:n.icon},slot:"icon"}):e._e(),e._l(e.childViews[n.id],function(o){return r("NcAppNavigationItem",{key:o.id,attrs:{"data-cy-files-navigation-item":o.id,"exact-path":!0,icon:o.iconClass,name:o.name,to:e.generateToNavigation(o)}},[o.icon?r("NcIconSvgWrapper",{attrs:{slot:"icon",svg:o.icon},slot:"icon"}):e._e()],1)})],2)})},proxy:!0},{key:"footer",fn:function(){return[r("ul",{staticClass:"app-navigation-entry__settings"},[r("NavigationQuota"),r("NcAppNavigationItem",{attrs:{"aria-label":e.t("files","Open the files app settings"),name:e.t("files","Files settings"),"data-cy-files-navigation-settings-button":""},on:{click:function(n){return n.preventDefault(),n.stopPropagation(),e.openSettings.apply(null,arguments)}}},[r("Cog",{attrs:{slot:"icon",size:20},slot:"icon"})],1)],1)]},proxy:!0}])},[r("SettingsModal",{attrs:{open:e.settingsOpened,"data-cy-files-navigation-settings":""},on:{close:e.onSettingsClose}})],1)},Ns=[],Es=J(Ts,Ss,Ns,!1,null,"4977d19e");const Ds=Es.exports;var gi=function(e,r){return e<r?-1:e>r?1:0},Cs=function(e,r){var n=e.localeCompare(r);return n?n/Math.abs(n):0},xs=/(^0x[\da-fA-F]+$|^([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?(?!\.\d+)(?=\D|\s|$))|\d+)/g,yi=/^\s+|\s+$/g,Os=/\s+/g,As=/^[+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:[eE][+-]?\d+)?$/,Is=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[/-]\d{1,4}[/-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,Ps=/^0+[1-9]{1}[0-9]*$/,Fs=/[^\x00-\x80]/,sr=function(e,r){return e<r?-1:e>r?1:0},Ls=function(e,r){for(var n=e.length,o=r.length,l=Math.min(n,o),i=0;i<l;i++){var s=e[i],a=r[i];if(s.normalizedString!==a.normalizedString){if(s.normalizedString===""!=(a.normalizedString===""))return s.normalizedString===""?-1:1;if(s.parsedNumber!==void 0&&a.parsedNumber!==void 0){var c=gi(s.parsedNumber,a.parsedNumber);return c===0?sr(s.normalizedString,a.normalizedString):c}else return s.parsedNumber!==void 0||a.parsedNumber!==void 0?s.parsedNumber!==void 0?-1:1:Fs.test(s.normalizedString+a.normalizedString)?Cs(s.normalizedString,a.normalizedString):sr(s.normalizedString,a.normalizedString)}}return n>l||o>l?n<=l?-1:1:0},ks=function(e,r){return(e.chunks?!r.chunks:r.chunks)?e.chunks?-1:1:(e.isNaN?!r.isNaN:r.isNaN)?e.isNaN?-1:1:(e.isSymbol?!r.isSymbol:r.isSymbol)?e.isSymbol?-1:1:(e.isObject?!r.isObject:r.isObject)?e.isObject?-1:1:(e.isArray?!r.isArray:r.isArray)?e.isArray?-1:1:(e.isFunction?!r.isFunction:r.isFunction)?e.isFunction?-1:1:(e.isNull?!r.isNull:r.isNull)?e.isNull?-1:1:0},Ms=function(e,r){return e.value===r.value?0:e.parsedNumber!==void 0&&r.parsedNumber!==void 0?gi(e.parsedNumber,r.parsedNumber):e.chunks&&r.chunks?Ls(e.chunks,r.chunks):ks(e,r)},Rs=function(e){return e.replace(Os," ").replace(yi,"")},vi=function(e){if(e.length!==0){var r=Number(e);if(!Number.isNaN(r))return r}},js=function(e,r,n){if(As.test(e)&&(!Ps.test(e)||r===0||n[r-1]!=="."))return vi(e)||0},Vs=function(e,r,n){return{parsedNumber:js(e,r,n),normalizedString:Rs(e)}},Bs=function(e){return e.replace(xs,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")},Us=function(e){var r=Bs(e).map(Vs);return r},qs=function(e){return typeof e=="function"},ar=function(e){return Number.isNaN(e)||e instanceof Number&&Number.isNaN(e.valueOf())},$s=function(e){return e===null},zs=function(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)&&!(e instanceof Number)&&!(e instanceof String)&&!(e instanceof Boolean)&&!(e instanceof Date)},Ws=function(e){return typeof e=="symbol"},Hs=function(e){return e===void 0},Gs=function(e){try{var r=Date.parse(e);return!Number.isNaN(r)&&Is.test(e)?r:void 0}catch{return}},Ks=function(e){var r=vi(e);return r!==void 0?r:Gs(e)},Ys=function(e){return typeof e=="boolean"||e instanceof Boolean?Number(e).toString():typeof e=="number"||e instanceof Number?e.toString():e instanceof Date?e.getTime().toString():typeof e=="string"||e instanceof String?e.toLowerCase().replace(yi,""):""},Qs=function(e){if(typeof e=="string"||e instanceof String||(typeof e=="number"||e instanceof Number)&&!ar(e)||typeof e=="boolean"||e instanceof Boolean||e instanceof Date){var r=Ys(e),n=Ks(r),o=Us(n?""+n:r);return{parsedNumber:n,chunks:o,value:e}}return{isArray:Array.isArray(e),isFunction:qs(e),isNaN:ar(e),isNull:$s(e),isObject:zs(e),isSymbol:Ws(e),isUndefined:Hs(e),value:e}},Xs=function(e,r,n){for(var o=e.index,l=e.values,i=r.index,s=r.values,a=l.length,c=n.length,w=0;w<a;w++){var y=w<c?n[w]:null;if(y&&typeof y=="function"){var g=y(l[w].value,s[w].value);if(g)return g}else{var m=Ms(l[w],s[w]);if(m)return m*(y==="desc"?-1:1)}}return o-i},Zs=function(e){return typeof e=="function"?e:function(r){if(Array.isArray(r)){var n=Number(e);if(Number.isInteger(n))return r[n]}else if(r&&typeof r=="object"){var o=Object.getOwnPropertyDescriptor(r,e);return o==null?void 0:o.value}return r}},Js=function(e,r){return e[r]},ta=function(e,r){return r(e)},ea=function(e,r,n){var o=r.length?r.map(Zs):[function(i){return i}],l=e.map(function(i,s){var a=o.map(function(c){return ta(i,c)}).map(Qs);return{index:s,values:a}});return l.sort(function(i,s){return Xs(i,s,n)}),l.map(function(i){return Js(e,i.index)})},ra=function(e){if(!e)return[];var r=Array.isArray(e)?[].concat(e):[e];return r.some(function(n){return typeof n!="string"&&typeof n!="number"&&typeof n!="function"})?[]:r},na=function(e){if(!e)return[];var r=Array.isArray(e)?[].concat(e):[e];return r.some(function(n){return n!=="asc"&&n!=="desc"&&typeof n!="function"})?[]:r};function ia(e,r,n){if(!e||!Array.isArray(e))return[];var o=ra(r),l=na(n);return ea(e,o,l)}var lr={},ur;function Ae(){return ur||(ur=1,(function(){lr.defaults={"0.1":{explicitCharkey:!1,trim:!0,normalize:!0,normalizeTags:!1,attrkey:"@",charkey:"#",explicitArray:!1,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!1,validator:null,xmlns:!1,explicitChildren:!1,childkey:"@@",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,emptyTag:""},"0.2":{explicitCharkey:!1,trim:!1,normalize:!1,normalizeTags:!1,attrkey:"$",charkey:"_",explicitArray:!0,ignoreAttrs:!1,mergeAttrs:!1,explicitRoot:!0,validator:null,xmlns:!1,explicitChildren:!1,preserveChildrenOrder:!1,childkey:"$$",charsAsChildren:!1,includeWhiteChars:!1,async:!1,strict:!0,attrNameProcessors:null,attrValueProcessors:null,tagNameProcessors:null,valueProcessors:null,rootName:"root",xmldec:{version:"1.0",encoding:"UTF-8",standalone:!0},doctype:null,renderOpts:{pretty:!0,indent:"  ",newline:"\n"},headless:!1,chunkSize:1e4,emptyTag:"",cdata:!1}}}).call(U)),lr}var cr={},ft={},mt={},dr;function dt(){return dr||(dr=1,(function(){var e,r,n,o,l,i,s,a=[].slice,c={}.hasOwnProperty;e=function(){var w,y,g,m,E,N;if(N=arguments[0],E=2<=arguments.length?a.call(arguments,1):[],l(Object.assign))Object.assign.apply(null,arguments);else for(w=0,g=E.length;w<g;w++)if(m=E[w],m!=null)for(y in m)c.call(m,y)&&(N[y]=m[y]);return N},l=function(w){return!!w&&Object.prototype.toString.call(w)==="[object Function]"},i=function(w){var y;return!!w&&((y=typeof w)=="function"||y==="object")},n=function(w){return l(Array.isArray)?Array.isArray(w):Object.prototype.toString.call(w)==="[object Array]"},o=function(w){var y;if(n(w))return!w.length;for(y in w)if(c.call(w,y))return!1;return!0},s=function(w){var y,g;return i(w)&&(g=Object.getPrototypeOf(w))&&(y=g.constructor)&&typeof y=="function"&&y instanceof y&&Function.prototype.toString.call(y)===Function.prototype.toString.call(Object)},r=function(w){return l(w.valueOf)?w.valueOf():w},mt.assign=e,mt.isFunction=l,mt.isObject=i,mt.isArray=n,mt.isEmpty=o,mt.isPlainObject=s,mt.getValue=r}).call(U)),mt}var hr={exports:{}},pr;function wi(){return pr||(pr=1,(function(){hr.exports=function(){function e(){}return e.prototype.hasFeature=function(r,n){return!0},e.prototype.createDocumentType=function(r,n,o){throw new Error("This DOM method is not implemented.")},e.prototype.createDocument=function(r,n,o){throw new Error("This DOM method is not implemented.")},e.prototype.createHTMLDocument=function(r){throw new Error("This DOM method is not implemented.")},e.prototype.getFeature=function(r,n){throw new Error("This DOM method is not implemented.")},e}()}).call(U)),hr.exports}var fr={exports:{}},mr={exports:{}},gr={exports:{}},yr;function oa(){return yr||(yr=1,(function(){gr.exports=function(){function e(){}return e.prototype.handleError=function(r){throw new Error(r)},e}()}).call(U)),gr.exports}var vr={exports:{}},wr;function sa(){return wr||(wr=1,(function(){vr.exports=function(){function e(r){this.arr=r||[]}return Object.defineProperty(e.prototype,"length",{get:function(){return this.arr.length}}),e.prototype.item=function(r){return this.arr[r]||null},e.prototype.contains=function(r){return this.arr.indexOf(r)!==-1},e}()}).call(U)),vr.exports}var br;function aa(){return br||(br=1,(function(){var e,r;e=oa(),r=sa(),mr.exports=function(){function n(){this.defaultParams={"canonical-form":!1,"cdata-sections":!1,comments:!1,"datatype-normalization":!1,"element-content-whitespace":!0,entities:!0,"error-handler":new e,infoset:!0,"validate-if-schema":!1,namespaces:!0,"namespace-declarations":!0,"normalize-characters":!1,"schema-location":"","schema-type":"","split-cdata-sections":!0,validate:!1,"well-formed":!0},this.params=Object.create(this.defaultParams)}return Object.defineProperty(n.prototype,"parameterNames",{get:function(){return new r(Object.keys(this.defaultParams))}}),n.prototype.getParameter=function(o){return this.params.hasOwnProperty(o)?this.params[o]:null},n.prototype.canSetParameter=function(o,l){return!0},n.prototype.setParameter=function(o,l){return l!=null?this.params[o]=l:delete this.params[o]},n}()}).call(U)),mr.exports}var _r={exports:{}},Tr={exports:{}},Sr={exports:{}},Nr;function tt(){return Nr||(Nr=1,(function(){Sr.exports={Element:1,Attribute:2,Text:3,CData:4,EntityReference:5,EntityDeclaration:6,ProcessingInstruction:7,Comment:8,Document:9,DocType:10,DocumentFragment:11,NotationDeclaration:12,Declaration:201,Raw:202,AttributeDeclaration:203,ElementDeclaration:204,Dummy:205}}).call(U)),Sr.exports}var Er={exports:{}},Dr;function bi(){return Dr||(Dr=1,(function(){var e;e=tt(),ot(),Er.exports=function(){function r(n,o,l){if(this.parent=n,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),o==null)throw new Error("Missing attribute name. "+this.debugInfo(o));this.name=this.stringify.name(o),this.value=this.stringify.attValue(l),this.type=e.Attribute,this.isId=!1,this.schemaTypeInfo=null}return Object.defineProperty(r.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(r.prototype,"ownerElement",{get:function(){return this.parent}}),Object.defineProperty(r.prototype,"textContent",{get:function(){return this.value},set:function(n){return this.value=n||""}}),Object.defineProperty(r.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(r.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(r.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(r.prototype,"specified",{get:function(){return!0}}),r.prototype.clone=function(){return Object.create(this)},r.prototype.toString=function(n){return this.options.writer.attribute(this,this.options.writer.filterOptions(n))},r.prototype.debugInfo=function(n){return n=n||this.name,n==null?"parent: <"+this.parent.name+">":"attribute: {"+n+"}, parent: <"+this.parent.name+">"},r.prototype.isEqualNode=function(n){return!(n.namespaceURI!==this.namespaceURI||n.prefix!==this.prefix||n.localName!==this.localName||n.value!==this.value)},r}()}).call(U)),Er.exports}var Cr={exports:{}},xr;function Ie(){return xr||(xr=1,(function(){Cr.exports=function(){function e(r){this.nodes=r}return Object.defineProperty(e.prototype,"length",{get:function(){return Object.keys(this.nodes).length||0}}),e.prototype.clone=function(){return this.nodes=null},e.prototype.getNamedItem=function(r){return this.nodes[r]},e.prototype.setNamedItem=function(r){var n;return n=this.nodes[r.nodeName],this.nodes[r.nodeName]=r,n||null},e.prototype.removeNamedItem=function(r){var n;return n=this.nodes[r],delete this.nodes[r],n||null},e.prototype.item=function(r){return this.nodes[Object.keys(this.nodes)[r]]||null},e.prototype.getNamedItemNS=function(r,n){throw new Error("This DOM method is not implemented.")},e.prototype.setNamedItemNS=function(r){throw new Error("This DOM method is not implemented.")},e.prototype.removeNamedItemNS=function(r,n){throw new Error("This DOM method is not implemented.")},e}()}).call(U)),Cr.exports}var Or;function Pe(){return Or||(Or=1,(function(){var e,r,n,o,l,i,s,a,c=function(y,g){for(var m in g)w.call(g,m)&&(y[m]=g[m]);function E(){this.constructor=y}return E.prototype=g.prototype,y.prototype=new E,y.__super__=g.prototype,y},w={}.hasOwnProperty;a=dt(),s=a.isObject,i=a.isFunction,l=a.getValue,o=ot(),e=tt(),r=bi(),n=Ie(),Tr.exports=function(y){c(g,y);function g(m,E,N){var D,C,S,v;if(g.__super__.constructor.call(this,m),E==null)throw new Error("Missing element name. "+this.debugInfo());if(this.name=this.stringify.name(E),this.type=e.Element,this.attribs={},this.schemaTypeInfo=null,N!=null&&this.attribute(N),m.type===e.Document&&(this.isRoot=!0,this.documentObject=m,m.rootObject=this,m.children)){for(v=m.children,C=0,S=v.length;C<S;C++)if(D=v[C],D.type===e.DocType){D.name=this.name;break}}}return Object.defineProperty(g.prototype,"tagName",{get:function(){return this.name}}),Object.defineProperty(g.prototype,"namespaceURI",{get:function(){return""}}),Object.defineProperty(g.prototype,"prefix",{get:function(){return""}}),Object.defineProperty(g.prototype,"localName",{get:function(){return this.name}}),Object.defineProperty(g.prototype,"id",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(g.prototype,"className",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(g.prototype,"classList",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(g.prototype,"attributes",{get:function(){return(!this.attributeMap||!this.attributeMap.nodes)&&(this.attributeMap=new n(this.attribs)),this.attributeMap}}),g.prototype.clone=function(){var m,E,N,D;N=Object.create(this),N.isRoot&&(N.documentObject=null),N.attribs={},D=this.attribs;for(E in D)w.call(D,E)&&(m=D[E],N.attribs[E]=m.clone());return N.children=[],this.children.forEach(function(C){var S;return S=C.clone(),S.parent=N,N.children.push(S)}),N},g.prototype.attribute=function(m,E){var N,D;if(m!=null&&(m=l(m)),s(m))for(N in m)w.call(m,N)&&(D=m[N],this.attribute(N,D));else i(E)&&(E=E.apply()),this.options.keepNullAttributes&&E==null?this.attribs[m]=new r(this,m,""):E!=null&&(this.attribs[m]=new r(this,m,E));return this},g.prototype.removeAttribute=function(m){var E,N,D;if(m==null)throw new Error("Missing attribute name. "+this.debugInfo());if(m=l(m),Array.isArray(m))for(N=0,D=m.length;N<D;N++)E=m[N],delete this.attribs[E];else delete this.attribs[m];return this},g.prototype.toString=function(m){return this.options.writer.element(this,this.options.writer.filterOptions(m))},g.prototype.att=function(m,E){return this.attribute(m,E)},g.prototype.a=function(m,E){return this.attribute(m,E)},g.prototype.getAttribute=function(m){return this.attribs.hasOwnProperty(m)?this.attribs[m].value:null},g.prototype.setAttribute=function(m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.getAttributeNode=function(m){return this.attribs.hasOwnProperty(m)?this.attribs[m]:null},g.prototype.setAttributeNode=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.removeAttributeNode=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.getElementsByTagName=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.getAttributeNS=function(m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.setAttributeNS=function(m,E,N){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.removeAttributeNS=function(m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.getAttributeNodeNS=function(m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.setAttributeNodeNS=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.getElementsByTagNameNS=function(m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.hasAttribute=function(m){return this.attribs.hasOwnProperty(m)},g.prototype.hasAttributeNS=function(m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.setIdAttribute=function(m,E){return this.attribs.hasOwnProperty(m)?this.attribs[m].isId:E},g.prototype.setIdAttributeNS=function(m,E,N){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.setIdAttributeNode=function(m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.getElementsByTagName=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.getElementsByTagNameNS=function(m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.getElementsByClassName=function(m){throw new Error("This DOM method is not implemented."+this.debugInfo())},g.prototype.isEqualNode=function(m){var E,N,D;if(!g.__super__.isEqualNode.apply(this,arguments).isEqualNode(m)||m.namespaceURI!==this.namespaceURI||m.prefix!==this.prefix||m.localName!==this.localName||m.attribs.length!==this.attribs.length)return!1;for(E=N=0,D=this.attribs.length-1;0<=D?N<=D:N>=D;E=0<=D?++N:--N)if(!this.attribs[E].isEqualNode(m.attribs[E]))return!1;return!0},g}(o)}).call(U)),Tr.exports}var Ar={exports:{}},Ir={exports:{}},Pr;function Qt(){return Pr||(Pr=1,(function(){var e,r=function(o,l){for(var i in l)n.call(l,i)&&(o[i]=l[i]);function s(){this.constructor=o}return s.prototype=l.prototype,o.prototype=new s,o.__super__=l.prototype,o},n={}.hasOwnProperty;e=ot(),Ir.exports=function(o){r(l,o);function l(i){l.__super__.constructor.call(this,i),this.value=""}return Object.defineProperty(l.prototype,"data",{get:function(){return this.value},set:function(i){return this.value=i||""}}),Object.defineProperty(l.prototype,"length",{get:function(){return this.value.length}}),Object.defineProperty(l.prototype,"textContent",{get:function(){return this.value},set:function(i){return this.value=i||""}}),l.prototype.clone=function(){return Object.create(this)},l.prototype.substringData=function(i,s){throw new Error("This DOM method is not implemented."+this.debugInfo())},l.prototype.appendData=function(i){throw new Error("This DOM method is not implemented."+this.debugInfo())},l.prototype.insertData=function(i,s){throw new Error("This DOM method is not implemented."+this.debugInfo())},l.prototype.deleteData=function(i,s){throw new Error("This DOM method is not implemented."+this.debugInfo())},l.prototype.replaceData=function(i,s,a){throw new Error("This DOM method is not implemented."+this.debugInfo())},l.prototype.isEqualNode=function(i){return!(!l.__super__.isEqualNode.apply(this,arguments).isEqualNode(i)||i.data!==this.data)},l}(e)}).call(U)),Ir.exports}var Fr;function Fe(){return Fr||(Fr=1,(function(){var e,r,n=function(l,i){for(var s in i)o.call(i,s)&&(l[s]=i[s]);function a(){this.constructor=l}return a.prototype=i.prototype,l.prototype=new a,l.__super__=i.prototype,l},o={}.hasOwnProperty;e=tt(),r=Qt(),Ar.exports=function(l){n(i,l);function i(s,a){if(i.__super__.constructor.call(this,s),a==null)throw new Error("Missing CDATA text. "+this.debugInfo());this.name="#cdata-section",this.type=e.CData,this.value=this.stringify.cdata(a)}return i.prototype.clone=function(){return Object.create(this)},i.prototype.toString=function(s){return this.options.writer.cdata(this,this.options.writer.filterOptions(s))},i}(r)}).call(U)),Ar.exports}var Lr={exports:{}},kr;function Le(){return kr||(kr=1,(function(){var e,r,n=function(l,i){for(var s in i)o.call(i,s)&&(l[s]=i[s]);function a(){this.constructor=l}return a.prototype=i.prototype,l.prototype=new a,l.__super__=i.prototype,l},o={}.hasOwnProperty;e=tt(),r=Qt(),Lr.exports=function(l){n(i,l);function i(s,a){if(i.__super__.constructor.call(this,s),a==null)throw new Error("Missing comment text. "+this.debugInfo());this.name="#comment",this.type=e.Comment,this.value=this.stringify.comment(a)}return i.prototype.clone=function(){return Object.create(this)},i.prototype.toString=function(s){return this.options.writer.comment(this,this.options.writer.filterOptions(s))},i}(r)}).call(U)),Lr.exports}var Mr={exports:{}},Rr;function ke(){return Rr||(Rr=1,(function(){var e,r,n,o=function(i,s){for(var a in s)l.call(s,a)&&(i[a]=s[a]);function c(){this.constructor=i}return c.prototype=s.prototype,i.prototype=new c,i.__super__=s.prototype,i},l={}.hasOwnProperty;n=dt().isObject,r=ot(),e=tt(),Mr.exports=function(i){o(s,i);function s(a,c,w,y){var g;s.__super__.constructor.call(this,a),n(c)&&(g=c,c=g.version,w=g.encoding,y=g.standalone),c||(c="1.0"),this.type=e.Declaration,this.version=this.stringify.xmlVersion(c),w!=null&&(this.encoding=this.stringify.xmlEncoding(w)),y!=null&&(this.standalone=this.stringify.xmlStandalone(y))}return s.prototype.toString=function(a){return this.options.writer.declaration(this,this.options.writer.filterOptions(a))},s}(r)}).call(U)),Mr.exports}var jr={exports:{}},Vr={exports:{}},Br;function Me(){return Br||(Br=1,(function(){var e,r,n=function(l,i){for(var s in i)o.call(i,s)&&(l[s]=i[s]);function a(){this.constructor=l}return a.prototype=i.prototype,l.prototype=new a,l.__super__=i.prototype,l},o={}.hasOwnProperty;r=ot(),e=tt(),Vr.exports=function(l){n(i,l);function i(s,a,c,w,y,g){if(i.__super__.constructor.call(this,s),a==null)throw new Error("Missing DTD element name. "+this.debugInfo());if(c==null)throw new Error("Missing DTD attribute name. "+this.debugInfo(a));if(!w)throw new Error("Missing DTD attribute type. "+this.debugInfo(a));if(!y)throw new Error("Missing DTD attribute default. "+this.debugInfo(a));if(y.indexOf("#")!==0&&(y="#"+y),!y.match(/^(#REQUIRED|#IMPLIED|#FIXED|#DEFAULT)$/))throw new Error("Invalid default value type; expected: #REQUIRED, #IMPLIED, #FIXED or #DEFAULT. "+this.debugInfo(a));if(g&&!y.match(/^(#FIXED|#DEFAULT)$/))throw new Error("Default value only applies to #FIXED or #DEFAULT. "+this.debugInfo(a));this.elementName=this.stringify.name(a),this.type=e.AttributeDeclaration,this.attributeName=this.stringify.name(c),this.attributeType=this.stringify.dtdAttType(w),g&&(this.defaultValue=this.stringify.dtdAttDefault(g)),this.defaultValueType=y}return i.prototype.toString=function(s){return this.options.writer.dtdAttList(this,this.options.writer.filterOptions(s))},i}(r)}).call(U)),Vr.exports}var Ur={exports:{}},qr;function Re(){return qr||(qr=1,(function(){var e,r,n,o=function(i,s){for(var a in s)l.call(s,a)&&(i[a]=s[a]);function c(){this.constructor=i}return c.prototype=s.prototype,i.prototype=new c,i.__super__=s.prototype,i},l={}.hasOwnProperty;n=dt().isObject,r=ot(),e=tt(),Ur.exports=function(i){o(s,i);function s(a,c,w,y){if(s.__super__.constructor.call(this,a),w==null)throw new Error("Missing DTD entity name. "+this.debugInfo(w));if(y==null)throw new Error("Missing DTD entity value. "+this.debugInfo(w));if(this.pe=!!c,this.name=this.stringify.name(w),this.type=e.EntityDeclaration,!n(y))this.value=this.stringify.dtdEntityValue(y),this.internal=!0;else{if(!y.pubID&&!y.sysID)throw new Error("Public and/or system identifiers are required for an external entity. "+this.debugInfo(w));if(y.pubID&&!y.sysID)throw new Error("System identifier is required for a public external entity. "+this.debugInfo(w));if(this.internal=!1,y.pubID!=null&&(this.pubID=this.stringify.dtdPubID(y.pubID)),y.sysID!=null&&(this.sysID=this.stringify.dtdSysID(y.sysID)),y.nData!=null&&(this.nData=this.stringify.dtdNData(y.nData)),this.pe&&this.nData)throw new Error("Notation declaration is not allowed in a parameter entity. "+this.debugInfo(w))}}return Object.defineProperty(s.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(s.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(s.prototype,"notationName",{get:function(){return this.nData||null}}),Object.defineProperty(s.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(s.prototype,"xmlEncoding",{get:function(){return null}}),Object.defineProperty(s.prototype,"xmlVersion",{get:function(){return null}}),s.prototype.toString=function(a){return this.options.writer.dtdEntity(this,this.options.writer.filterOptions(a))},s}(r)}).call(U)),Ur.exports}var $r={exports:{}},zr;function je(){return zr||(zr=1,(function(){var e,r,n=function(l,i){for(var s in i)o.call(i,s)&&(l[s]=i[s]);function a(){this.constructor=l}return a.prototype=i.prototype,l.prototype=new a,l.__super__=i.prototype,l},o={}.hasOwnProperty;r=ot(),e=tt(),$r.exports=function(l){n(i,l);function i(s,a,c){if(i.__super__.constructor.call(this,s),a==null)throw new Error("Missing DTD element name. "+this.debugInfo());c||(c="(#PCDATA)"),Array.isArray(c)&&(c="("+c.join(",")+")"),this.name=this.stringify.name(a),this.type=e.ElementDeclaration,this.value=this.stringify.dtdElementValue(c)}return i.prototype.toString=function(s){return this.options.writer.dtdElement(this,this.options.writer.filterOptions(s))},i}(r)}).call(U)),$r.exports}var Wr={exports:{}},Hr;function Ve(){return Hr||(Hr=1,(function(){var e,r,n=function(l,i){for(var s in i)o.call(i,s)&&(l[s]=i[s]);function a(){this.constructor=l}return a.prototype=i.prototype,l.prototype=new a,l.__super__=i.prototype,l},o={}.hasOwnProperty;r=ot(),e=tt(),Wr.exports=function(l){n(i,l);function i(s,a,c){if(i.__super__.constructor.call(this,s),a==null)throw new Error("Missing DTD notation name. "+this.debugInfo(a));if(!c.pubID&&!c.sysID)throw new Error("Public or system identifiers are required for an external entity. "+this.debugInfo(a));this.name=this.stringify.name(a),this.type=e.NotationDeclaration,c.pubID!=null&&(this.pubID=this.stringify.dtdPubID(c.pubID)),c.sysID!=null&&(this.sysID=this.stringify.dtdSysID(c.sysID))}return Object.defineProperty(i.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(i.prototype,"systemId",{get:function(){return this.sysID}}),i.prototype.toString=function(s){return this.options.writer.dtdNotation(this,this.options.writer.filterOptions(s))},i}(r)}).call(U)),Wr.exports}var Gr;function Be(){return Gr||(Gr=1,(function(){var e,r,n,o,l,i,s,a,c=function(y,g){for(var m in g)w.call(g,m)&&(y[m]=g[m]);function E(){this.constructor=y}return E.prototype=g.prototype,y.prototype=new E,y.__super__=g.prototype,y},w={}.hasOwnProperty;a=dt().isObject,s=ot(),e=tt(),r=Me(),o=Re(),n=je(),l=Ve(),i=Ie(),jr.exports=function(y){c(g,y);function g(m,E,N){var D,C,S,v,d,f;if(g.__super__.constructor.call(this,m),this.type=e.DocType,m.children){for(v=m.children,C=0,S=v.length;C<S;C++)if(D=v[C],D.type===e.Element){this.name=D.name;break}}this.documentObject=m,a(E)&&(d=E,E=d.pubID,N=d.sysID),N==null&&(f=[E,N],N=f[0],E=f[1]),E!=null&&(this.pubID=this.stringify.dtdPubID(E)),N!=null&&(this.sysID=this.stringify.dtdSysID(N))}return Object.defineProperty(g.prototype,"entities",{get:function(){var m,E,N,D,C;for(D={},C=this.children,E=0,N=C.length;E<N;E++)m=C[E],m.type===e.EntityDeclaration&&!m.pe&&(D[m.name]=m);return new i(D)}}),Object.defineProperty(g.prototype,"notations",{get:function(){var m,E,N,D,C;for(D={},C=this.children,E=0,N=C.length;E<N;E++)m=C[E],m.type===e.NotationDeclaration&&(D[m.name]=m);return new i(D)}}),Object.defineProperty(g.prototype,"publicId",{get:function(){return this.pubID}}),Object.defineProperty(g.prototype,"systemId",{get:function(){return this.sysID}}),Object.defineProperty(g.prototype,"internalSubset",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),g.prototype.element=function(m,E){var N;return N=new n(this,m,E),this.children.push(N),this},g.prototype.attList=function(m,E,N,D,C){var S;return S=new r(this,m,E,N,D,C),this.children.push(S),this},g.prototype.entity=function(m,E){var N;return N=new o(this,!1,m,E),this.children.push(N),this},g.prototype.pEntity=function(m,E){var N;return N=new o(this,!0,m,E),this.children.push(N),this},g.prototype.notation=function(m,E){var N;return N=new l(this,m,E),this.children.push(N),this},g.prototype.toString=function(m){return this.options.writer.docType(this,this.options.writer.filterOptions(m))},g.prototype.ele=function(m,E){return this.element(m,E)},g.prototype.att=function(m,E,N,D,C){return this.attList(m,E,N,D,C)},g.prototype.ent=function(m,E){return this.entity(m,E)},g.prototype.pent=function(m,E){return this.pEntity(m,E)},g.prototype.not=function(m,E){return this.notation(m,E)},g.prototype.up=function(){return this.root()||this.documentObject},g.prototype.isEqualNode=function(m){return!(!g.__super__.isEqualNode.apply(this,arguments).isEqualNode(m)||m.name!==this.name||m.publicId!==this.publicId||m.systemId!==this.systemId)},g}(s)}).call(U)),jr.exports}var Kr={exports:{}},Yr;function Ue(){return Yr||(Yr=1,(function(){var e,r,n=function(l,i){for(var s in i)o.call(i,s)&&(l[s]=i[s]);function a(){this.constructor=l}return a.prototype=i.prototype,l.prototype=new a,l.__super__=i.prototype,l},o={}.hasOwnProperty;e=tt(),r=ot(),Kr.exports=function(l){n(i,l);function i(s,a){if(i.__super__.constructor.call(this,s),a==null)throw new Error("Missing raw text. "+this.debugInfo());this.type=e.Raw,this.value=this.stringify.raw(a)}return i.prototype.clone=function(){return Object.create(this)},i.prototype.toString=function(s){return this.options.writer.raw(this,this.options.writer.filterOptions(s))},i}(r)}).call(U)),Kr.exports}var Qr={exports:{}},Xr;function qe(){return Xr||(Xr=1,(function(){var e,r,n=function(l,i){for(var s in i)o.call(i,s)&&(l[s]=i[s]);function a(){this.constructor=l}return a.prototype=i.prototype,l.prototype=new a,l.__super__=i.prototype,l},o={}.hasOwnProperty;e=tt(),r=Qt(),Qr.exports=function(l){n(i,l);function i(s,a){if(i.__super__.constructor.call(this,s),a==null)throw new Error("Missing element text. "+this.debugInfo());this.name="#text",this.type=e.Text,this.value=this.stringify.text(a)}return Object.defineProperty(i.prototype,"isElementContentWhitespace",{get:function(){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),Object.defineProperty(i.prototype,"wholeText",{get:function(){var s,a,c;for(c="",a=this.previousSibling;a;)c=a.data+c,a=a.previousSibling;for(c+=this.data,s=this.nextSibling;s;)c=c+s.data,s=s.nextSibling;return c}}),i.prototype.clone=function(){return Object.create(this)},i.prototype.toString=function(s){return this.options.writer.text(this,this.options.writer.filterOptions(s))},i.prototype.splitText=function(s){throw new Error("This DOM method is not implemented."+this.debugInfo())},i.prototype.replaceWholeText=function(s){throw new Error("This DOM method is not implemented."+this.debugInfo())},i}(r)}).call(U)),Qr.exports}var Zr={exports:{}},Jr;function $e(){return Jr||(Jr=1,(function(){var e,r,n=function(l,i){for(var s in i)o.call(i,s)&&(l[s]=i[s]);function a(){this.constructor=l}return a.prototype=i.prototype,l.prototype=new a,l.__super__=i.prototype,l},o={}.hasOwnProperty;e=tt(),r=Qt(),Zr.exports=function(l){n(i,l);function i(s,a,c){if(i.__super__.constructor.call(this,s),a==null)throw new Error("Missing instruction target. "+this.debugInfo());this.type=e.ProcessingInstruction,this.target=this.stringify.insTarget(a),this.name=this.target,c&&(this.value=this.stringify.insValue(c))}return i.prototype.clone=function(){return Object.create(this)},i.prototype.toString=function(s){return this.options.writer.processingInstruction(this,this.options.writer.filterOptions(s))},i.prototype.isEqualNode=function(s){return!(!i.__super__.isEqualNode.apply(this,arguments).isEqualNode(s)||s.target!==this.target)},i}(r)}).call(U)),Zr.exports}var tn={exports:{}},en;function _i(){return en||(en=1,(function(){var e,r,n=function(l,i){for(var s in i)o.call(i,s)&&(l[s]=i[s]);function a(){this.constructor=l}return a.prototype=i.prototype,l.prototype=new a,l.__super__=i.prototype,l},o={}.hasOwnProperty;r=ot(),e=tt(),tn.exports=function(l){n(i,l);function i(s){i.__super__.constructor.call(this,s),this.type=e.Dummy}return i.prototype.clone=function(){return Object.create(this)},i.prototype.toString=function(s){return""},i}(r)}).call(U)),tn.exports}var rn={exports:{}},nn;function la(){return nn||(nn=1,(function(){rn.exports=function(){function e(r){this.nodes=r}return Object.defineProperty(e.prototype,"length",{get:function(){return this.nodes.length||0}}),e.prototype.clone=function(){return this.nodes=null},e.prototype.item=function(r){return this.nodes[r]||null},e}()}).call(U)),rn.exports}var on={exports:{}},sn;function ua(){return sn||(sn=1,(function(){on.exports={Disconnected:1,Preceding:2,Following:4,Contains:8,ContainedBy:16,ImplementationSpecific:32}}).call(U)),on.exports}var an;function ot(){return an||(an=1,(function(){var e,r,n,o,l,i,s,a,c,w,y,g,m,E,N,D,C,S={}.hasOwnProperty;C=dt(),D=C.isObject,N=C.isFunction,E=C.isEmpty,m=C.getValue,a=null,n=null,o=null,l=null,i=null,y=null,g=null,w=null,s=null,r=null,c=null,e=null,_r.exports=function(){function v(d){this.parent=d,this.parent&&(this.options=this.parent.options,this.stringify=this.parent.stringify),this.value=null,this.children=[],this.baseURI=null,a||(a=Pe(),n=Fe(),o=Le(),l=ke(),i=Be(),y=Ue(),g=qe(),w=$e(),s=_i(),r=tt(),c=la(),Ie(),e=ua())}return Object.defineProperty(v.prototype,"nodeName",{get:function(){return this.name}}),Object.defineProperty(v.prototype,"nodeType",{get:function(){return this.type}}),Object.defineProperty(v.prototype,"nodeValue",{get:function(){return this.value}}),Object.defineProperty(v.prototype,"parentNode",{get:function(){return this.parent}}),Object.defineProperty(v.prototype,"childNodes",{get:function(){return(!this.childNodeList||!this.childNodeList.nodes)&&(this.childNodeList=new c(this.children)),this.childNodeList}}),Object.defineProperty(v.prototype,"firstChild",{get:function(){return this.children[0]||null}}),Object.defineProperty(v.prototype,"lastChild",{get:function(){return this.children[this.children.length-1]||null}}),Object.defineProperty(v.prototype,"previousSibling",{get:function(){var d;return d=this.parent.children.indexOf(this),this.parent.children[d-1]||null}}),Object.defineProperty(v.prototype,"nextSibling",{get:function(){var d;return d=this.parent.children.indexOf(this),this.parent.children[d+1]||null}}),Object.defineProperty(v.prototype,"ownerDocument",{get:function(){return this.document()||null}}),Object.defineProperty(v.prototype,"textContent",{get:function(){var d,f,b,x,L;if(this.nodeType===r.Element||this.nodeType===r.DocumentFragment){for(L="",x=this.children,f=0,b=x.length;f<b;f++)d=x[f],d.textContent&&(L+=d.textContent);return L}else return null},set:function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())}}),v.prototype.setParent=function(d){var f,b,x,L,A;for(this.parent=d,d&&(this.options=d.options,this.stringify=d.stringify),L=this.children,A=[],b=0,x=L.length;b<x;b++)f=L[b],A.push(f.setParent(this));return A},v.prototype.element=function(d,f,b){var x,L,A,u,F,k,j,z,K,Z,G;if(k=null,f===null&&b==null&&(K=[{},null],f=K[0],b=K[1]),f==null&&(f={}),f=m(f),D(f)||(Z=[f,b],b=Z[0],f=Z[1]),d!=null&&(d=m(d)),Array.isArray(d))for(A=0,j=d.length;A<j;A++)L=d[A],k=this.element(L);else if(N(d))k=this.element(d.apply());else if(D(d)){for(F in d)if(S.call(d,F))if(G=d[F],N(G)&&(G=G.apply()),!this.options.ignoreDecorators&&this.stringify.convertAttKey&&F.indexOf(this.stringify.convertAttKey)===0)k=this.attribute(F.substr(this.stringify.convertAttKey.length),G);else if(!this.options.separateArrayItems&&Array.isArray(G)&&E(G))k=this.dummy();else if(D(G)&&E(G))k=this.element(F);else if(!this.options.keepNullNodes&&G==null)k=this.dummy();else if(!this.options.separateArrayItems&&Array.isArray(G))for(u=0,z=G.length;u<z;u++)L=G[u],x={},x[F]=L,k=this.element(x);else D(G)?!this.options.ignoreDecorators&&this.stringify.convertTextKey&&F.indexOf(this.stringify.convertTextKey)===0?k=this.element(G):(k=this.element(F),k.element(G)):k=this.element(F,G)}else!this.options.keepNullNodes&&b===null?k=this.dummy():!this.options.ignoreDecorators&&this.stringify.convertTextKey&&d.indexOf(this.stringify.convertTextKey)===0?k=this.text(b):!this.options.ignoreDecorators&&this.stringify.convertCDataKey&&d.indexOf(this.stringify.convertCDataKey)===0?k=this.cdata(b):!this.options.ignoreDecorators&&this.stringify.convertCommentKey&&d.indexOf(this.stringify.convertCommentKey)===0?k=this.comment(b):!this.options.ignoreDecorators&&this.stringify.convertRawKey&&d.indexOf(this.stringify.convertRawKey)===0?k=this.raw(b):!this.options.ignoreDecorators&&this.stringify.convertPIKey&&d.indexOf(this.stringify.convertPIKey)===0?k=this.instruction(d.substr(this.stringify.convertPIKey.length),b):k=this.node(d,f,b);if(k==null)throw new Error("Could not create any elements with: "+d+". "+this.debugInfo());return k},v.prototype.insertBefore=function(d,f,b){var x,L,A,u,F;if(d!=null&&d.type)return A=d,u=f,A.setParent(this),u?(L=children.indexOf(u),F=children.splice(L),children.push(A),Array.prototype.push.apply(children,F)):children.push(A),A;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(d));return L=this.parent.children.indexOf(this),F=this.parent.children.splice(L),x=this.parent.element(d,f,b),Array.prototype.push.apply(this.parent.children,F),x},v.prototype.insertAfter=function(d,f,b){var x,L,A;if(this.isRoot)throw new Error("Cannot insert elements at root level. "+this.debugInfo(d));return L=this.parent.children.indexOf(this),A=this.parent.children.splice(L+1),x=this.parent.element(d,f,b),Array.prototype.push.apply(this.parent.children,A),x},v.prototype.remove=function(){var d;if(this.isRoot)throw new Error("Cannot remove the root element. "+this.debugInfo());return d=this.parent.children.indexOf(this),[].splice.apply(this.parent.children,[d,d-d+1].concat([])),this.parent},v.prototype.node=function(d,f,b){var x,L;return d!=null&&(d=m(d)),f||(f={}),f=m(f),D(f)||(L=[f,b],b=L[0],f=L[1]),x=new a(this,d,f),b!=null&&x.text(b),this.children.push(x),x},v.prototype.text=function(d){var f;return D(d)&&this.element(d),f=new g(this,d),this.children.push(f),this},v.prototype.cdata=function(d){var f;return f=new n(this,d),this.children.push(f),this},v.prototype.comment=function(d){var f;return f=new o(this,d),this.children.push(f),this},v.prototype.commentBefore=function(d){var f,b;return f=this.parent.children.indexOf(this),b=this.parent.children.splice(f),this.parent.comment(d),Array.prototype.push.apply(this.parent.children,b),this},v.prototype.commentAfter=function(d){var f,b;return f=this.parent.children.indexOf(this),b=this.parent.children.splice(f+1),this.parent.comment(d),Array.prototype.push.apply(this.parent.children,b),this},v.prototype.raw=function(d){var f;return f=new y(this,d),this.children.push(f),this},v.prototype.dummy=function(){var d;return d=new s(this),d},v.prototype.instruction=function(d,f){var b,x,L,A,u;if(d!=null&&(d=m(d)),f!=null&&(f=m(f)),Array.isArray(d))for(A=0,u=d.length;A<u;A++)b=d[A],this.instruction(b);else if(D(d))for(b in d)S.call(d,b)&&(x=d[b],this.instruction(b,x));else N(f)&&(f=f.apply()),L=new w(this,d,f),this.children.push(L);return this},v.prototype.instructionBefore=function(d,f){var b,x;return b=this.parent.children.indexOf(this),x=this.parent.children.splice(b),this.parent.instruction(d,f),Array.prototype.push.apply(this.parent.children,x),this},v.prototype.instructionAfter=function(d,f){var b,x;return b=this.parent.children.indexOf(this),x=this.parent.children.splice(b+1),this.parent.instruction(d,f),Array.prototype.push.apply(this.parent.children,x),this},v.prototype.declaration=function(d,f,b){var x,L;return x=this.document(),L=new l(x,d,f,b),x.children.length===0?x.children.unshift(L):x.children[0].type===r.Declaration?x.children[0]=L:x.children.unshift(L),x.root()||x},v.prototype.dtd=function(d,f){var b,x,L,A,u,F,k,j,z,K;for(x=this.document(),L=new i(x,d,f),z=x.children,A=u=0,k=z.length;u<k;A=++u)if(b=z[A],b.type===r.DocType)return x.children[A]=L,L;for(K=x.children,A=F=0,j=K.length;F<j;A=++F)if(b=K[A],b.isRoot)return x.children.splice(A,0,L),L;return x.children.push(L),L},v.prototype.up=function(){if(this.isRoot)throw new Error("The root node has no parent. Use doc() if you need to get the document object.");return this.parent},v.prototype.root=function(){var d;for(d=this;d;){if(d.type===r.Document)return d.rootObject;if(d.isRoot)return d;d=d.parent}},v.prototype.document=function(){var d;for(d=this;d;){if(d.type===r.Document)return d;d=d.parent}},v.prototype.end=function(d){return this.document().end(d)},v.prototype.prev=function(){var d;if(d=this.parent.children.indexOf(this),d<1)throw new Error("Already at the first node. "+this.debugInfo());return this.parent.children[d-1]},v.prototype.next=function(){var d;if(d=this.parent.children.indexOf(this),d===-1||d===this.parent.children.length-1)throw new Error("Already at the last node. "+this.debugInfo());return this.parent.children[d+1]},v.prototype.importDocument=function(d){var f;return f=d.root().clone(),f.parent=this,f.isRoot=!1,this.children.push(f),this},v.prototype.debugInfo=function(d){var f,b;return d=d||this.name,d==null&&!((f=this.parent)!=null&&f.name)?"":d==null?"parent: <"+this.parent.name+">":(b=this.parent)!=null&&b.name?"node: <"+d+">, parent: <"+this.parent.name+">":"node: <"+d+">"},v.prototype.ele=function(d,f,b){return this.element(d,f,b)},v.prototype.nod=function(d,f,b){return this.node(d,f,b)},v.prototype.txt=function(d){return this.text(d)},v.prototype.dat=function(d){return this.cdata(d)},v.prototype.com=function(d){return this.comment(d)},v.prototype.ins=function(d,f){return this.instruction(d,f)},v.prototype.doc=function(){return this.document()},v.prototype.dec=function(d,f,b){return this.declaration(d,f,b)},v.prototype.e=function(d,f,b){return this.element(d,f,b)},v.prototype.n=function(d,f,b){return this.node(d,f,b)},v.prototype.t=function(d){return this.text(d)},v.prototype.d=function(d){return this.cdata(d)},v.prototype.c=function(d){return this.comment(d)},v.prototype.r=function(d){return this.raw(d)},v.prototype.i=function(d,f){return this.instruction(d,f)},v.prototype.u=function(){return this.up()},v.prototype.importXMLBuilder=function(d){return this.importDocument(d)},v.prototype.replaceChild=function(d,f){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.removeChild=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.appendChild=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.hasChildNodes=function(){return this.children.length!==0},v.prototype.cloneNode=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.normalize=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.isSupported=function(d,f){return!0},v.prototype.hasAttributes=function(){return this.attribs.length!==0},v.prototype.compareDocumentPosition=function(d){var f,b;return f=this,f===d?0:this.document()!==d.document()?(b=e.Disconnected|e.ImplementationSpecific,Math.random()<.5?b|=e.Preceding:b|=e.Following,b):f.isAncestor(d)?e.Contains|e.Preceding:f.isDescendant(d)?e.Contains|e.Following:f.isPreceding(d)?e.Preceding:e.Following},v.prototype.isSameNode=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.lookupPrefix=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.isDefaultNamespace=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.lookupNamespaceURI=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.isEqualNode=function(d){var f,b,x;if(d.nodeType!==this.nodeType||d.children.length!==this.children.length)return!1;for(f=b=0,x=this.children.length-1;0<=x?b<=x:b>=x;f=0<=x?++b:--b)if(!this.children[f].isEqualNode(d.children[f]))return!1;return!0},v.prototype.getFeature=function(d,f){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.setUserData=function(d,f,b){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.getUserData=function(d){throw new Error("This DOM method is not implemented."+this.debugInfo())},v.prototype.contains=function(d){return d?d===this||this.isDescendant(d):!1},v.prototype.isDescendant=function(d){var f,b,x,L,A;for(A=this.children,x=0,L=A.length;x<L;x++)if(f=A[x],d===f||(b=f.isDescendant(d),b))return!0;return!1},v.prototype.isAncestor=function(d){return d.isDescendant(this)},v.prototype.isPreceding=function(d){var f,b;return f=this.treePosition(d),b=this.treePosition(this),f===-1||b===-1?!1:f<b},v.prototype.isFollowing=function(d){var f,b;return f=this.treePosition(d),b=this.treePosition(this),f===-1||b===-1?!1:f>b},v.prototype.treePosition=function(d){var f,b;return b=0,f=!1,this.foreachTreeNode(this.document(),function(x){if(b++,!f&&x===d)return f=!0}),f?b:-1},v.prototype.foreachTreeNode=function(d,f){var b,x,L,A,u;for(d||(d=this.document()),A=d.children,x=0,L=A.length;x<L;x++)if(b=A[x],(u=f(b))||(u=this.foreachTreeNode(b,f),u))return u},v}()}).call(U)),_r.exports}var ln={exports:{}},un;function Ti(){return un||(un=1,(function(){var e=function(n,o){return function(){return n.apply(o,arguments)}},r={}.hasOwnProperty;ln.exports=function(){function n(o){this.assertLegalName=e(this.assertLegalName,this),this.assertLegalChar=e(this.assertLegalChar,this);var l,i,s;o||(o={}),this.options=o,this.options.version||(this.options.version="1.0"),i=o.stringify||{};for(l in i)r.call(i,l)&&(s=i[l],this[l]=s)}return n.prototype.name=function(o){return this.options.noValidation?o:this.assertLegalName(""+o||"")},n.prototype.text=function(o){return this.options.noValidation?o:this.assertLegalChar(this.textEscape(""+o||""))},n.prototype.cdata=function(o){return this.options.noValidation?o:(o=""+o||"",o=o.replace("]]>","]]]]><![CDATA[>"),this.assertLegalChar(o))},n.prototype.comment=function(o){if(this.options.noValidation)return o;if(o=""+o||"",o.match(/--/))throw new Error("Comment text cannot contain double-hypen: "+o);return this.assertLegalChar(o)},n.prototype.raw=function(o){return this.options.noValidation?o:""+o||""},n.prototype.attValue=function(o){return this.options.noValidation?o:this.assertLegalChar(this.attEscape(o=""+o||""))},n.prototype.insTarget=function(o){return this.options.noValidation?o:this.assertLegalChar(""+o||"")},n.prototype.insValue=function(o){if(this.options.noValidation)return o;if(o=""+o||"",o.match(/\?>/))throw new Error("Invalid processing instruction value: "+o);return this.assertLegalChar(o)},n.prototype.xmlVersion=function(o){if(this.options.noValidation)return o;if(o=""+o||"",!o.match(/1\.[0-9]+/))throw new Error("Invalid version number: "+o);return o},n.prototype.xmlEncoding=function(o){if(this.options.noValidation)return o;if(o=""+o||"",!o.match(/^[A-Za-z](?:[A-Za-z0-9._-])*$/))throw new Error("Invalid encoding: "+o);return this.assertLegalChar(o)},n.prototype.xmlStandalone=function(o){return this.options.noValidation?o:o?"yes":"no"},n.prototype.dtdPubID=function(o){return this.options.noValidation?o:this.assertLegalChar(""+o||"")},n.prototype.dtdSysID=function(o){return this.options.noValidation?o:this.assertLegalChar(""+o||"")},n.prototype.dtdElementValue=function(o){return this.options.noValidation?o:this.assertLegalChar(""+o||"")},n.prototype.dtdAttType=function(o){return this.options.noValidation?o:this.assertLegalChar(""+o||"")},n.prototype.dtdAttDefault=function(o){return this.options.noValidation?o:this.assertLegalChar(""+o||"")},n.prototype.dtdEntityValue=function(o){return this.options.noValidation?o:this.assertLegalChar(""+o||"")},n.prototype.dtdNData=function(o){return this.options.noValidation?o:this.assertLegalChar(""+o||"")},n.prototype.convertAttKey="@",n.prototype.convertPIKey="?",n.prototype.convertTextKey="#text",n.prototype.convertCDataKey="#cdata",n.prototype.convertCommentKey="#comment",n.prototype.convertRawKey="#raw",n.prototype.assertLegalChar=function(o){var l,i;if(this.options.noValidation)return o;if(l="",this.options.version==="1.0"){if(l=/[\0-\x08\x0B\f\x0E-\x1F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,i=o.match(l))throw new Error("Invalid character in string: "+o+" at index "+i.index)}else if(this.options.version==="1.1"&&(l=/[\0\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,i=o.match(l)))throw new Error("Invalid character in string: "+o+" at index "+i.index);return o},n.prototype.assertLegalName=function(o){var l;if(this.options.noValidation)return o;if(this.assertLegalChar(o),l=/^([:A-Z_a-z\xC0-\xD6\xD8-\xF6\xF8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])([\x2D\.0-:A-Z_a-z\xB7\xC0-\xD6\xD8-\xF6\xF8-\u037D\u037F-\u1FFF\u200C\u200D\u203F\u2040\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]|[\uD800-\uDB7F][\uDC00-\uDFFF])*$/,!o.match(l))throw new Error("Invalid character in name");return o},n.prototype.textEscape=function(o){var l;return this.options.noValidation?o:(l=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,o.replace(l,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#xD;"))},n.prototype.attEscape=function(o){var l;return this.options.noValidation?o:(l=this.options.noDoubleEncoding?/(?!&\S+;)&/g:/&/g,o.replace(l,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;"))},n}()}).call(U)),ln.exports}var cn={exports:{}},dn={exports:{}},hn={exports:{}},pn;function Xt(){return pn||(pn=1,(function(){hn.exports={None:0,OpenTag:1,InsideTag:2,CloseTag:3}}).call(U)),hn.exports}var fn;function Si(){return fn||(fn=1,(function(){var e,r,n,o={}.hasOwnProperty;n=dt().assign,e=tt(),ke(),Be(),Fe(),Le(),Pe(),Ue(),qe(),$e(),_i(),Me(),je(),Re(),Ve(),r=Xt(),dn.exports=function(){function l(i){var s,a,c;i||(i={}),this.options=i,a=i.writer||{};for(s in a)o.call(a,s)&&(c=a[s],this["_"+s]=this[s],this[s]=c)}return l.prototype.filterOptions=function(i){var s,a,c,w,y,g,m,E;return i||(i={}),i=n({},this.options,i),s={writer:this},s.pretty=i.pretty||!1,s.allowEmpty=i.allowEmpty||!1,s.indent=(a=i.indent)!=null?a:"  ",s.newline=(c=i.newline)!=null?c:"\n",s.offset=(w=i.offset)!=null?w:0,s.dontPrettyTextNodes=(y=(g=i.dontPrettyTextNodes)!=null?g:i.dontprettytextnodes)!=null?y:0,s.spaceBeforeSlash=(m=(E=i.spaceBeforeSlash)!=null?E:i.spacebeforeslash)!=null?m:"",s.spaceBeforeSlash===!0&&(s.spaceBeforeSlash=" "),s.suppressPrettyCount=0,s.user={},s.state=r.None,s},l.prototype.indent=function(i,s,a){var c;return!s.pretty||s.suppressPrettyCount?"":s.pretty&&(c=(a||0)+s.offset+1,c>0)?new Array(c).join(s.indent):""},l.prototype.endline=function(i,s,a){return!s.pretty||s.suppressPrettyCount?"":s.newline},l.prototype.attribute=function(i,s,a){var c;return this.openAttribute(i,s,a),c=" "+i.name+'="'+i.value+'"',this.closeAttribute(i,s,a),c},l.prototype.cdata=function(i,s,a){var c;return this.openNode(i,s,a),s.state=r.OpenTag,c=this.indent(i,s,a)+"<![CDATA[",s.state=r.InsideTag,c+=i.value,s.state=r.CloseTag,c+="]]>"+this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),c},l.prototype.comment=function(i,s,a){var c;return this.openNode(i,s,a),s.state=r.OpenTag,c=this.indent(i,s,a)+"<!-- ",s.state=r.InsideTag,c+=i.value,s.state=r.CloseTag,c+=" -->"+this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),c},l.prototype.declaration=function(i,s,a){var c;return this.openNode(i,s,a),s.state=r.OpenTag,c=this.indent(i,s,a)+"<?xml",s.state=r.InsideTag,c+=' version="'+i.version+'"',i.encoding!=null&&(c+=' encoding="'+i.encoding+'"'),i.standalone!=null&&(c+=' standalone="'+i.standalone+'"'),s.state=r.CloseTag,c+=s.spaceBeforeSlash+"?>",c+=this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),c},l.prototype.docType=function(i,s,a){var c,w,y,g,m;if(a||(a=0),this.openNode(i,s,a),s.state=r.OpenTag,g=this.indent(i,s,a),g+="<!DOCTYPE "+i.root().name,i.pubID&&i.sysID?g+=' PUBLIC "'+i.pubID+'" "'+i.sysID+'"':i.sysID&&(g+=' SYSTEM "'+i.sysID+'"'),i.children.length>0){for(g+=" [",g+=this.endline(i,s,a),s.state=r.InsideTag,m=i.children,w=0,y=m.length;w<y;w++)c=m[w],g+=this.writeChildNode(c,s,a+1);s.state=r.CloseTag,g+="]"}return s.state=r.CloseTag,g+=s.spaceBeforeSlash+">",g+=this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),g},l.prototype.element=function(i,s,a){var c,w,y,g,m,E,N,D,C,S,v,d,f,b;a||(a=0),S=!1,v="",this.openNode(i,s,a),s.state=r.OpenTag,v+=this.indent(i,s,a)+"<"+i.name,d=i.attribs;for(C in d)o.call(d,C)&&(c=d[C],v+=this.attribute(c,s,a));if(y=i.children.length,g=y===0?null:i.children[0],y===0||i.children.every(function(x){return(x.type===e.Text||x.type===e.Raw)&&x.value===""}))s.allowEmpty?(v+=">",s.state=r.CloseTag,v+="</"+i.name+">"+this.endline(i,s,a)):(s.state=r.CloseTag,v+=s.spaceBeforeSlash+"/>"+this.endline(i,s,a));else if(s.pretty&&y===1&&(g.type===e.Text||g.type===e.Raw)&&g.value!=null)v+=">",s.state=r.InsideTag,s.suppressPrettyCount++,S=!0,v+=this.writeChildNode(g,s,a+1),s.suppressPrettyCount--,S=!1,s.state=r.CloseTag,v+="</"+i.name+">"+this.endline(i,s,a);else{if(s.dontPrettyTextNodes){for(f=i.children,m=0,N=f.length;m<N;m++)if(w=f[m],(w.type===e.Text||w.type===e.Raw)&&w.value!=null){s.suppressPrettyCount++,S=!0;break}}for(v+=">"+this.endline(i,s,a),s.state=r.InsideTag,b=i.children,E=0,D=b.length;E<D;E++)w=b[E],v+=this.writeChildNode(w,s,a+1);s.state=r.CloseTag,v+=this.indent(i,s,a)+"</"+i.name+">",S&&s.suppressPrettyCount--,v+=this.endline(i,s,a),s.state=r.None}return this.closeNode(i,s,a),v},l.prototype.writeChildNode=function(i,s,a){switch(i.type){case e.CData:return this.cdata(i,s,a);case e.Comment:return this.comment(i,s,a);case e.Element:return this.element(i,s,a);case e.Raw:return this.raw(i,s,a);case e.Text:return this.text(i,s,a);case e.ProcessingInstruction:return this.processingInstruction(i,s,a);case e.Dummy:return"";case e.Declaration:return this.declaration(i,s,a);case e.DocType:return this.docType(i,s,a);case e.AttributeDeclaration:return this.dtdAttList(i,s,a);case e.ElementDeclaration:return this.dtdElement(i,s,a);case e.EntityDeclaration:return this.dtdEntity(i,s,a);case e.NotationDeclaration:return this.dtdNotation(i,s,a);default:throw new Error("Unknown XML node type: "+i.constructor.name)}},l.prototype.processingInstruction=function(i,s,a){var c;return this.openNode(i,s,a),s.state=r.OpenTag,c=this.indent(i,s,a)+"<?",s.state=r.InsideTag,c+=i.target,i.value&&(c+=" "+i.value),s.state=r.CloseTag,c+=s.spaceBeforeSlash+"?>",c+=this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),c},l.prototype.raw=function(i,s,a){var c;return this.openNode(i,s,a),s.state=r.OpenTag,c=this.indent(i,s,a),s.state=r.InsideTag,c+=i.value,s.state=r.CloseTag,c+=this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),c},l.prototype.text=function(i,s,a){var c;return this.openNode(i,s,a),s.state=r.OpenTag,c=this.indent(i,s,a),s.state=r.InsideTag,c+=i.value,s.state=r.CloseTag,c+=this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),c},l.prototype.dtdAttList=function(i,s,a){var c;return this.openNode(i,s,a),s.state=r.OpenTag,c=this.indent(i,s,a)+"<!ATTLIST",s.state=r.InsideTag,c+=" "+i.elementName+" "+i.attributeName+" "+i.attributeType,i.defaultValueType!=="#DEFAULT"&&(c+=" "+i.defaultValueType),i.defaultValue&&(c+=' "'+i.defaultValue+'"'),s.state=r.CloseTag,c+=s.spaceBeforeSlash+">"+this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),c},l.prototype.dtdElement=function(i,s,a){var c;return this.openNode(i,s,a),s.state=r.OpenTag,c=this.indent(i,s,a)+"<!ELEMENT",s.state=r.InsideTag,c+=" "+i.name+" "+i.value,s.state=r.CloseTag,c+=s.spaceBeforeSlash+">"+this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),c},l.prototype.dtdEntity=function(i,s,a){var c;return this.openNode(i,s,a),s.state=r.OpenTag,c=this.indent(i,s,a)+"<!ENTITY",s.state=r.InsideTag,i.pe&&(c+=" %"),c+=" "+i.name,i.value?c+=' "'+i.value+'"':(i.pubID&&i.sysID?c+=' PUBLIC "'+i.pubID+'" "'+i.sysID+'"':i.sysID&&(c+=' SYSTEM "'+i.sysID+'"'),i.nData&&(c+=" NDATA "+i.nData)),s.state=r.CloseTag,c+=s.spaceBeforeSlash+">"+this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),c},l.prototype.dtdNotation=function(i,s,a){var c;return this.openNode(i,s,a),s.state=r.OpenTag,c=this.indent(i,s,a)+"<!NOTATION",s.state=r.InsideTag,c+=" "+i.name,i.pubID&&i.sysID?c+=' PUBLIC "'+i.pubID+'" "'+i.sysID+'"':i.pubID?c+=' PUBLIC "'+i.pubID+'"':i.sysID&&(c+=' SYSTEM "'+i.sysID+'"'),s.state=r.CloseTag,c+=s.spaceBeforeSlash+">"+this.endline(i,s,a),s.state=r.None,this.closeNode(i,s,a),c},l.prototype.openNode=function(i,s,a){},l.prototype.closeNode=function(i,s,a){},l.prototype.openAttribute=function(i,s,a){},l.prototype.closeAttribute=function(i,s,a){},l}()}).call(U)),dn.exports}var mn;function ze(){return mn||(mn=1,(function(){var e,r=function(o,l){for(var i in l)n.call(l,i)&&(o[i]=l[i]);function s(){this.constructor=o}return s.prototype=l.prototype,o.prototype=new s,o.__super__=l.prototype,o},n={}.hasOwnProperty;e=Si(),cn.exports=function(o){r(l,o);function l(i){l.__super__.constructor.call(this,i)}return l.prototype.document=function(i,s){var a,c,w,y,g;for(s=this.filterOptions(s),y="",g=i.children,c=0,w=g.length;c<w;c++)a=g[c],y+=this.writeChildNode(a,s,0);return s.pretty&&y.slice(-s.newline.length)===s.newline&&(y=y.slice(0,-s.newline.length)),y},l}(e)}).call(U)),cn.exports}var gn;function Ni(){return gn||(gn=1,(function(){var e,r,n,o,l,i,s,a=function(w,y){for(var g in y)c.call(y,g)&&(w[g]=y[g]);function m(){this.constructor=w}return m.prototype=y.prototype,w.prototype=new m,w.__super__=y.prototype,w},c={}.hasOwnProperty;s=dt().isPlainObject,n=wi(),r=aa(),o=ot(),e=tt(),i=Ti(),l=ze(),fr.exports=function(w){a(y,w);function y(g){y.__super__.constructor.call(this,null),this.name="#document",this.type=e.Document,this.documentURI=null,this.domConfig=new r,g||(g={}),g.writer||(g.writer=new l),this.options=g,this.stringify=new i(g)}return Object.defineProperty(y.prototype,"implementation",{value:new n}),Object.defineProperty(y.prototype,"doctype",{get:function(){var g,m,E,N;for(N=this.children,m=0,E=N.length;m<E;m++)if(g=N[m],g.type===e.DocType)return g;return null}}),Object.defineProperty(y.prototype,"documentElement",{get:function(){return this.rootObject||null}}),Object.defineProperty(y.prototype,"inputEncoding",{get:function(){return null}}),Object.defineProperty(y.prototype,"strictErrorChecking",{get:function(){return!1}}),Object.defineProperty(y.prototype,"xmlEncoding",{get:function(){return this.children.length!==0&&this.children[0].type===e.Declaration?this.children[0].encoding:null}}),Object.defineProperty(y.prototype,"xmlStandalone",{get:function(){return this.children.length!==0&&this.children[0].type===e.Declaration?this.children[0].standalone==="yes":!1}}),Object.defineProperty(y.prototype,"xmlVersion",{get:function(){return this.children.length!==0&&this.children[0].type===e.Declaration?this.children[0].version:"1.0"}}),Object.defineProperty(y.prototype,"URL",{get:function(){return this.documentURI}}),Object.defineProperty(y.prototype,"origin",{get:function(){return null}}),Object.defineProperty(y.prototype,"compatMode",{get:function(){return null}}),Object.defineProperty(y.prototype,"characterSet",{get:function(){return null}}),Object.defineProperty(y.prototype,"contentType",{get:function(){return null}}),y.prototype.end=function(g){var m;return m={},g?s(g)&&(m=g,g=this.options.writer):g=this.options.writer,g.document(this,g.filterOptions(m))},y.prototype.toString=function(g){return this.options.writer.document(this,this.options.writer.filterOptions(g))},y.prototype.createElement=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createDocumentFragment=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createTextNode=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createComment=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createCDATASection=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createProcessingInstruction=function(g,m){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createAttribute=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createEntityReference=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.getElementsByTagName=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.importNode=function(g,m){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createElementNS=function(g,m){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createAttributeNS=function(g,m){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.getElementsByTagNameNS=function(g,m){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.getElementById=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.adoptNode=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.normalizeDocument=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.renameNode=function(g,m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.getElementsByClassName=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createEvent=function(g){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createRange=function(){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createNodeIterator=function(g,m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},y.prototype.createTreeWalker=function(g,m,E){throw new Error("This DOM method is not implemented."+this.debugInfo())},y}(o)}).call(U)),fr.exports}var yn={exports:{}},vn;function ca(){return vn||(vn=1,(function(){var e,r,n,o,l,i,s,a,c,w,y,g,m,E,N,D,C,S,v,d,f,b,x,L={}.hasOwnProperty;x=dt(),f=x.isObject,d=x.isFunction,b=x.isPlainObject,v=x.getValue,e=tt(),g=Ni(),m=Pe(),o=Fe(),l=Le(),N=Ue(),S=qe(),E=$e(),w=ke(),y=Be(),i=Me(),a=Re(),s=je(),c=Ve(),n=bi(),C=Ti(),D=ze(),r=Xt(),yn.exports=function(){function A(u,F,k){var j;this.name="?xml",this.type=e.Document,u||(u={}),j={},u.writer?b(u.writer)&&(j=u.writer,u.writer=new D):u.writer=new D,this.options=u,this.writer=u.writer,this.writerOptions=this.writer.filterOptions(j),this.stringify=new C(u),this.onDataCallback=F||function(){},this.onEndCallback=k||function(){},this.currentNode=null,this.currentLevel=-1,this.openTags={},this.documentStarted=!1,this.documentCompleted=!1,this.root=null}return A.prototype.createChildNode=function(u){var F,k,j,z,K,Z,G,q;switch(u.type){case e.CData:this.cdata(u.value);break;case e.Comment:this.comment(u.value);break;case e.Element:j={},G=u.attribs;for(k in G)L.call(G,k)&&(F=G[k],j[k]=F.value);this.node(u.name,j);break;case e.Dummy:this.dummy();break;case e.Raw:this.raw(u.value);break;case e.Text:this.text(u.value);break;case e.ProcessingInstruction:this.instruction(u.target,u.value);break;default:throw new Error("This XML node type is not supported in a JS object: "+u.constructor.name)}for(q=u.children,K=0,Z=q.length;K<Z;K++)z=q[K],this.createChildNode(z),z.type===e.Element&&this.up();return this},A.prototype.dummy=function(){return this},A.prototype.node=function(u,F,k){var j;if(u==null)throw new Error("Missing node name.");if(this.root&&this.currentLevel===-1)throw new Error("Document can only have one root node. "+this.debugInfo(u));return this.openCurrent(),u=v(u),F==null&&(F={}),F=v(F),f(F)||(j=[F,k],k=j[0],F=j[1]),this.currentNode=new m(this,u,F),this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,k!=null&&this.text(k),this},A.prototype.element=function(u,F,k){var j,z,K,Z,G,q;if(this.currentNode&&this.currentNode.type===e.DocType)this.dtdElement.apply(this,arguments);else if(Array.isArray(u)||f(u)||d(u))for(Z=this.options.noValidation,this.options.noValidation=!0,q=new g(this.options).element("TEMP_ROOT"),q.element(u),this.options.noValidation=Z,G=q.children,z=0,K=G.length;z<K;z++)j=G[z],this.createChildNode(j),j.type===e.Element&&this.up();else this.node(u,F,k);return this},A.prototype.attribute=function(u,F){var k,j;if(!this.currentNode||this.currentNode.children)throw new Error("att() can only be used immediately after an ele() call in callback mode. "+this.debugInfo(u));if(u!=null&&(u=v(u)),f(u))for(k in u)L.call(u,k)&&(j=u[k],this.attribute(k,j));else d(F)&&(F=F.apply()),this.options.keepNullAttributes&&F==null?this.currentNode.attribs[u]=new n(this,u,""):F!=null&&(this.currentNode.attribs[u]=new n(this,u,F));return this},A.prototype.text=function(u){var F;return this.openCurrent(),F=new S(this,u),this.onData(this.writer.text(F,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},A.prototype.cdata=function(u){var F;return this.openCurrent(),F=new o(this,u),this.onData(this.writer.cdata(F,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},A.prototype.comment=function(u){var F;return this.openCurrent(),F=new l(this,u),this.onData(this.writer.comment(F,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},A.prototype.raw=function(u){var F;return this.openCurrent(),F=new N(this,u),this.onData(this.writer.raw(F,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},A.prototype.instruction=function(u,F){var k,j,z,K,Z;if(this.openCurrent(),u!=null&&(u=v(u)),F!=null&&(F=v(F)),Array.isArray(u))for(k=0,K=u.length;k<K;k++)j=u[k],this.instruction(j);else if(f(u))for(j in u)L.call(u,j)&&(z=u[j],this.instruction(j,z));else d(F)&&(F=F.apply()),Z=new E(this,u,F),this.onData(this.writer.processingInstruction(Z,this.writerOptions,this.currentLevel+1),this.currentLevel+1);return this},A.prototype.declaration=function(u,F,k){var j;if(this.openCurrent(),this.documentStarted)throw new Error("declaration() must be the first node.");return j=new w(this,u,F,k),this.onData(this.writer.declaration(j,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},A.prototype.doctype=function(u,F,k){if(this.openCurrent(),u==null)throw new Error("Missing root node name.");if(this.root)throw new Error("dtd() must come before the root node.");return this.currentNode=new y(this,F,k),this.currentNode.rootNodeName=u,this.currentNode.children=!1,this.currentLevel++,this.openTags[this.currentLevel]=this.currentNode,this},A.prototype.dtdElement=function(u,F){var k;return this.openCurrent(),k=new s(this,u,F),this.onData(this.writer.dtdElement(k,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},A.prototype.attList=function(u,F,k,j,z){var K;return this.openCurrent(),K=new i(this,u,F,k,j,z),this.onData(this.writer.dtdAttList(K,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},A.prototype.entity=function(u,F){var k;return this.openCurrent(),k=new a(this,!1,u,F),this.onData(this.writer.dtdEntity(k,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},A.prototype.pEntity=function(u,F){var k;return this.openCurrent(),k=new a(this,!0,u,F),this.onData(this.writer.dtdEntity(k,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},A.prototype.notation=function(u,F){var k;return this.openCurrent(),k=new c(this,u,F),this.onData(this.writer.dtdNotation(k,this.writerOptions,this.currentLevel+1),this.currentLevel+1),this},A.prototype.up=function(){if(this.currentLevel<0)throw new Error("The document node has no parent.");return this.currentNode?(this.currentNode.children?this.closeNode(this.currentNode):this.openNode(this.currentNode),this.currentNode=null):this.closeNode(this.openTags[this.currentLevel]),delete this.openTags[this.currentLevel],this.currentLevel--,this},A.prototype.end=function(){for(;this.currentLevel>=0;)this.up();return this.onEnd()},A.prototype.openCurrent=function(){if(this.currentNode)return this.currentNode.children=!0,this.openNode(this.currentNode)},A.prototype.openNode=function(u){var F,k,j,z;if(!u.isOpen){if(!this.root&&this.currentLevel===0&&u.type===e.Element&&(this.root=u),k="",u.type===e.Element){this.writerOptions.state=r.OpenTag,k=this.writer.indent(u,this.writerOptions,this.currentLevel)+"<"+u.name,z=u.attribs;for(j in z)L.call(z,j)&&(F=z[j],k+=this.writer.attribute(F,this.writerOptions,this.currentLevel));k+=(u.children?">":"/>")+this.writer.endline(u,this.writerOptions,this.currentLevel),this.writerOptions.state=r.InsideTag}else this.writerOptions.state=r.OpenTag,k=this.writer.indent(u,this.writerOptions,this.currentLevel)+"<!DOCTYPE "+u.rootNodeName,u.pubID&&u.sysID?k+=' PUBLIC "'+u.pubID+'" "'+u.sysID+'"':u.sysID&&(k+=' SYSTEM "'+u.sysID+'"'),u.children?(k+=" [",this.writerOptions.state=r.InsideTag):(this.writerOptions.state=r.CloseTag,k+=">"),k+=this.writer.endline(u,this.writerOptions,this.currentLevel);return this.onData(k,this.currentLevel),u.isOpen=!0}},A.prototype.closeNode=function(u){var F;if(!u.isClosed)return F="",this.writerOptions.state=r.CloseTag,u.type===e.Element?F=this.writer.indent(u,this.writerOptions,this.currentLevel)+"</"+u.name+">"+this.writer.endline(u,this.writerOptions,this.currentLevel):F=this.writer.indent(u,this.writerOptions,this.currentLevel)+"]>"+this.writer.endline(u,this.writerOptions,this.currentLevel),this.writerOptions.state=r.None,this.onData(F,this.currentLevel),u.isClosed=!0},A.prototype.onData=function(u,F){return this.documentStarted=!0,this.onDataCallback(u,F+1)},A.prototype.onEnd=function(){return this.documentCompleted=!0,this.onEndCallback()},A.prototype.debugInfo=function(u){return u==null?"":"node: <"+u+">"},A.prototype.ele=function(){return this.element.apply(this,arguments)},A.prototype.nod=function(u,F,k){return this.node(u,F,k)},A.prototype.txt=function(u){return this.text(u)},A.prototype.dat=function(u){return this.cdata(u)},A.prototype.com=function(u){return this.comment(u)},A.prototype.ins=function(u,F){return this.instruction(u,F)},A.prototype.dec=function(u,F,k){return this.declaration(u,F,k)},A.prototype.dtd=function(u,F,k){return this.doctype(u,F,k)},A.prototype.e=function(u,F,k){return this.element(u,F,k)},A.prototype.n=function(u,F,k){return this.node(u,F,k)},A.prototype.t=function(u){return this.text(u)},A.prototype.d=function(u){return this.cdata(u)},A.prototype.c=function(u){return this.comment(u)},A.prototype.r=function(u){return this.raw(u)},A.prototype.i=function(u,F){return this.instruction(u,F)},A.prototype.att=function(){return this.currentNode&&this.currentNode.type===e.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},A.prototype.a=function(){return this.currentNode&&this.currentNode.type===e.DocType?this.attList.apply(this,arguments):this.attribute.apply(this,arguments)},A.prototype.ent=function(u,F){return this.entity(u,F)},A.prototype.pent=function(u,F){return this.pEntity(u,F)},A.prototype.not=function(u,F){return this.notation(u,F)},A}()}).call(U)),yn.exports}var wn={exports:{}},bn;function da(){return bn||(bn=1,(function(){var e,r,n,o=function(i,s){for(var a in s)l.call(s,a)&&(i[a]=s[a]);function c(){this.constructor=i}return c.prototype=s.prototype,i.prototype=new c,i.__super__=s.prototype,i},l={}.hasOwnProperty;e=tt(),n=Si(),r=Xt(),wn.exports=function(i){o(s,i);function s(a,c){this.stream=a,s.__super__.constructor.call(this,c)}return s.prototype.endline=function(a,c,w){return a.isLastRootNode&&c.state===r.CloseTag?"":s.__super__.endline.call(this,a,c,w)},s.prototype.document=function(a,c){var w,y,g,m,E,N,D,C,S;for(D=a.children,y=g=0,E=D.length;g<E;y=++g)w=D[y],w.isLastRootNode=y===a.children.length-1;for(c=this.filterOptions(c),C=a.children,S=[],m=0,N=C.length;m<N;m++)w=C[m],S.push(this.writeChildNode(w,c,0));return S},s.prototype.attribute=function(a,c,w){return this.stream.write(s.__super__.attribute.call(this,a,c,w))},s.prototype.cdata=function(a,c,w){return this.stream.write(s.__super__.cdata.call(this,a,c,w))},s.prototype.comment=function(a,c,w){return this.stream.write(s.__super__.comment.call(this,a,c,w))},s.prototype.declaration=function(a,c,w){return this.stream.write(s.__super__.declaration.call(this,a,c,w))},s.prototype.docType=function(a,c,w){var y,g,m,E;if(w||(w=0),this.openNode(a,c,w),c.state=r.OpenTag,this.stream.write(this.indent(a,c,w)),this.stream.write("<!DOCTYPE "+a.root().name),a.pubID&&a.sysID?this.stream.write(' PUBLIC "'+a.pubID+'" "'+a.sysID+'"'):a.sysID&&this.stream.write(' SYSTEM "'+a.sysID+'"'),a.children.length>0){for(this.stream.write(" ["),this.stream.write(this.endline(a,c,w)),c.state=r.InsideTag,E=a.children,g=0,m=E.length;g<m;g++)y=E[g],this.writeChildNode(y,c,w+1);c.state=r.CloseTag,this.stream.write("]")}return c.state=r.CloseTag,this.stream.write(c.spaceBeforeSlash+">"),this.stream.write(this.endline(a,c,w)),c.state=r.None,this.closeNode(a,c,w)},s.prototype.element=function(a,c,w){var y,g,m,E,N,D,C,S,v;w||(w=0),this.openNode(a,c,w),c.state=r.OpenTag,this.stream.write(this.indent(a,c,w)+"<"+a.name),S=a.attribs;for(C in S)l.call(S,C)&&(y=S[C],this.attribute(y,c,w));if(m=a.children.length,E=m===0?null:a.children[0],m===0||a.children.every(function(d){return(d.type===e.Text||d.type===e.Raw)&&d.value===""}))c.allowEmpty?(this.stream.write(">"),c.state=r.CloseTag,this.stream.write("</"+a.name+">")):(c.state=r.CloseTag,this.stream.write(c.spaceBeforeSlash+"/>"));else if(c.pretty&&m===1&&(E.type===e.Text||E.type===e.Raw)&&E.value!=null)this.stream.write(">"),c.state=r.InsideTag,c.suppressPrettyCount++,this.writeChildNode(E,c,w+1),c.suppressPrettyCount--,c.state=r.CloseTag,this.stream.write("</"+a.name+">");else{for(this.stream.write(">"+this.endline(a,c,w)),c.state=r.InsideTag,v=a.children,N=0,D=v.length;N<D;N++)g=v[N],this.writeChildNode(g,c,w+1);c.state=r.CloseTag,this.stream.write(this.indent(a,c,w)+"</"+a.name+">")}return this.stream.write(this.endline(a,c,w)),c.state=r.None,this.closeNode(a,c,w)},s.prototype.processingInstruction=function(a,c,w){return this.stream.write(s.__super__.processingInstruction.call(this,a,c,w))},s.prototype.raw=function(a,c,w){return this.stream.write(s.__super__.raw.call(this,a,c,w))},s.prototype.text=function(a,c,w){return this.stream.write(s.__super__.text.call(this,a,c,w))},s.prototype.dtdAttList=function(a,c,w){return this.stream.write(s.__super__.dtdAttList.call(this,a,c,w))},s.prototype.dtdElement=function(a,c,w){return this.stream.write(s.__super__.dtdElement.call(this,a,c,w))},s.prototype.dtdEntity=function(a,c,w){return this.stream.write(s.__super__.dtdEntity.call(this,a,c,w))},s.prototype.dtdNotation=function(a,c,w){return this.stream.write(s.__super__.dtdNotation.call(this,a,c,w))},s}(n)}).call(U)),wn.exports}var _n;function ha(){return _n||(_n=1,(function(){var e,r,n,o,l,i,s,a,c,w;w=dt(),a=w.assign,c=w.isFunction,n=wi(),o=Ni(),l=ca(),s=ze(),i=da(),e=tt(),r=Xt(),ft.create=function(y,g,m,E){var N,D;if(y==null)throw new Error("Root element needs a name.");return E=a({},g,m,E),N=new o(E),D=N.element(y),E.headless||(N.declaration(E),(E.pubID!=null||E.sysID!=null)&&N.dtd(E)),D},ft.begin=function(y,g,m){var E;return c(y)&&(E=[y,g],g=E[0],m=E[1],y={}),g?new l(y,g,m):new o(y)},ft.stringWriter=function(y){return new s(y)},ft.streamWriter=function(y,g){return new i(y,g)},ft.implementation=new n,ft.nodeType=e,ft.writerState=r}).call(U)),ft}var Tn;function pa(){return Tn||(Tn=1,(function(){var e,r,n,o,l,i={}.hasOwnProperty;e=ha(),r=Ae().defaults,o=function(s){return typeof s=="string"&&(s.indexOf("&")>=0||s.indexOf(">")>=0||s.indexOf("<")>=0)},l=function(s){return"<![CDATA["+n(s)+"]]>"},n=function(s){return s.replace("]]>","]]]]><![CDATA[>")},cr.Builder=function(){function s(a){var c,w,y;this.options={},w=r["0.2"];for(c in w)i.call(w,c)&&(y=w[c],this.options[c]=y);for(c in a)i.call(a,c)&&(y=a[c],this.options[c]=y)}return s.prototype.buildObject=function(a){var c,w,y,g,m;return c=this.options.attrkey,w=this.options.charkey,Object.keys(a).length===1&&this.options.rootName===r["0.2"].rootName?(m=Object.keys(a)[0],a=a[m]):m=this.options.rootName,y=function(E){return function(N,D){var C,S,v,d,f,b;if(typeof D!="object")E.options.cdata&&o(D)?N.raw(l(D)):N.txt(D);else if(Array.isArray(D)){for(d in D)if(i.call(D,d)){S=D[d];for(f in S)v=S[f],N=y(N.ele(f),v).up()}}else for(f in D)if(i.call(D,f))if(S=D[f],f===c){if(typeof S=="object")for(C in S)b=S[C],N=N.att(C,b)}else if(f===w)E.options.cdata&&o(S)?N=N.raw(l(S)):N=N.txt(S);else if(Array.isArray(S))for(d in S)i.call(S,d)&&(v=S[d],typeof v=="string"?E.options.cdata&&o(v)?N=N.ele(f).raw(l(v)).up():N=N.ele(f,v).up():N=y(N.ele(f),v).up());else typeof S=="object"?N=y(N.ele(f),S).up():typeof S=="string"&&E.options.cdata&&o(S)?N=N.ele(f).raw(l(S)).up():(S==null&&(S=""),N=N.ele(f,S.toString()).up());return N}}(this),g=e.create(m,this.options.xmldec,this.options.doctype,{headless:this.options.headless,allowSurrogateChars:this.options.allowSurrogateChars}),y(g,a).end(this.options.renderOpts)},s}()}).call(U)),cr}var Sn={},Nn={},Ht={exports:{}},En;function Zt(){if(En)return Ht.exports;En=1;var e=typeof Reflect=="object"?Reflect:null,r=e&&typeof e.apply=="function"?e.apply:function(f,b,x){return Function.prototype.apply.call(f,b,x)},n;e&&typeof e.ownKeys=="function"?n=e.ownKeys:Object.getOwnPropertySymbols?n=function(f){return Object.getOwnPropertyNames(f).concat(Object.getOwnPropertySymbols(f))}:n=function(f){return Object.getOwnPropertyNames(f)};function o(f){console&&console.warn&&console.warn(f)}var l=Number.isNaN||function(f){return f!==f};function i(){i.init.call(this)}Ht.exports=i,Ht.exports.once=S,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function a(f){if(typeof f!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof f)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(f){if(typeof f!="number"||f<0||l(f))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+f+".");s=f}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(f){if(typeof f!="number"||f<0||l(f))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+f+".");return this._maxListeners=f,this};function c(f){return f._maxListeners===void 0?i.defaultMaxListeners:f._maxListeners}i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(f){for(var b=[],x=1;x<arguments.length;x++)b.push(arguments[x]);var L=f==="error",A=this._events;if(A!==void 0)L=L&&A.error===void 0;else if(!L)return!1;if(L){var u;if(b.length>0&&(u=b[0]),u instanceof Error)throw u;var F=new Error("Unhandled error."+(u?" ("+u.message+")":""));throw F.context=u,F}var k=A[f];if(k===void 0)return!1;if(typeof k=="function")r(k,this,b);else for(var j=k.length,z=N(k,j),x=0;x<j;++x)r(z[x],this,b);return!0};function w(f,b,x,L){var A,u,F;if(a(x),u=f._events,u===void 0?(u=f._events=Object.create(null),f._eventsCount=0):(u.newListener!==void 0&&(f.emit("newListener",b,x.listener?x.listener:x),u=f._events),F=u[b]),F===void 0)F=u[b]=x,++f._eventsCount;else if(typeof F=="function"?F=u[b]=L?[x,F]:[F,x]:L?F.unshift(x):F.push(x),A=c(f),A>0&&F.length>A&&!F.warned){F.warned=!0;var k=new Error("Possible EventEmitter memory leak detected. "+F.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");k.name="MaxListenersExceededWarning",k.emitter=f,k.type=b,k.count=F.length,o(k)}return f}i.prototype.addListener=function(f,b){return w(this,f,b,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(f,b){return w(this,f,b,!0)};function y(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(f,b,x){var L={fired:!1,wrapFn:void 0,target:f,type:b,listener:x},A=y.bind(L);return A.listener=x,L.wrapFn=A,A}i.prototype.once=function(f,b){return a(b),this.on(f,g(this,f,b)),this},i.prototype.prependOnceListener=function(f,b){return a(b),this.prependListener(f,g(this,f,b)),this},i.prototype.removeListener=function(f,b){var x,L,A,u,F;if(a(b),L=this._events,L===void 0)return this;if(x=L[f],x===void 0)return this;if(x===b||x.listener===b)--this._eventsCount===0?this._events=Object.create(null):(delete L[f],L.removeListener&&this.emit("removeListener",f,x.listener||b));else if(typeof x!="function"){for(A=-1,u=x.length-1;u>=0;u--)if(x[u]===b||x[u].listener===b){F=x[u].listener,A=u;break}if(A<0)return this;A===0?x.shift():D(x,A),x.length===1&&(L[f]=x[0]),L.removeListener!==void 0&&this.emit("removeListener",f,F||b)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(f){var b,x,L;if(x=this._events,x===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[f]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete x[f]),this;if(arguments.length===0){var A=Object.keys(x),u;for(L=0;L<A.length;++L)u=A[L],u!=="removeListener"&&this.removeAllListeners(u);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(b=x[f],typeof b=="function")this.removeListener(f,b);else if(b!==void 0)for(L=b.length-1;L>=0;L--)this.removeListener(f,b[L]);return this};function m(f,b,x){var L=f._events;if(L===void 0)return[];var A=L[b];return A===void 0?[]:typeof A=="function"?x?[A.listener||A]:[A]:x?C(A):N(A,A.length)}i.prototype.listeners=function(f){return m(this,f,!0)},i.prototype.rawListeners=function(f){return m(this,f,!1)},i.listenerCount=function(f,b){return typeof f.listenerCount=="function"?f.listenerCount(b):E.call(f,b)},i.prototype.listenerCount=E;function E(f){var b=this._events;if(b!==void 0){var x=b[f];if(typeof x=="function")return 1;if(x!==void 0)return x.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function N(f,b){for(var x=new Array(b),L=0;L<b;++L)x[L]=f[L];return x}function D(f,b){for(;b+1<f.length;b++)f[b]=f[b+1];f.pop()}function C(f){for(var b=new Array(f.length),x=0;x<b.length;++x)b[x]=f[x].listener||f[x];return b}function S(f,b){return new Promise(function(x,L){function A(F){f.removeListener(b,u),L(F)}function u(){typeof f.removeListener=="function"&&f.removeListener("error",A),x([].slice.call(arguments))}d(f,b,u,{once:!0}),b!=="error"&&v(f,A,{once:!0})})}function v(f,b,x){typeof f.on=="function"&&d(f,"error",b,x)}function d(f,b,x,L){if(typeof f.on=="function")L.once?f.once(b,x):f.on(b,x);else if(typeof f.addEventListener=="function")f.addEventListener(b,function A(u){L.once&&f.removeEventListener(b,A),x(u)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof f)}return Ht.exports}var Dn,Cn;function Ei(){return Cn||(Cn=1,Dn=Zt().EventEmitter),Dn}const Jt=uo(co);var oe,xn;function fa(){if(xn)return oe;xn=1;function e(N,D){var C=Object.keys(N);if(Object.getOwnPropertySymbols){var S=Object.getOwnPropertySymbols(N);D&&(S=S.filter(function(v){return Object.getOwnPropertyDescriptor(N,v).enumerable})),C.push.apply(C,S)}return C}function r(N){for(var D=1;D<arguments.length;D++){var C=arguments[D]!=null?arguments[D]:{};D%2?e(Object(C),!0).forEach(function(S){n(N,S,C[S])}):Object.getOwnPropertyDescriptors?Object.defineProperties(N,Object.getOwnPropertyDescriptors(C)):e(Object(C)).forEach(function(S){Object.defineProperty(N,S,Object.getOwnPropertyDescriptor(C,S))})}return N}function n(N,D,C){return D=s(D),D in N?Object.defineProperty(N,D,{value:C,enumerable:!0,configurable:!0,writable:!0}):N[D]=C,N}function o(N,D){if(!(N instanceof D))throw new TypeError("Cannot call a class as a function")}function l(N,D){for(var C=0;C<D.length;C++){var S=D[C];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(N,s(S.key),S)}}function i(N,D,C){return D&&l(N.prototype,D),Object.defineProperty(N,"prototype",{writable:!1}),N}function s(N){var D=a(N,"string");return typeof D=="symbol"?D:String(D)}function a(N,D){if(typeof N!="object"||N===null)return N;var C=N[Symbol.toPrimitive];if(C!==void 0){var S=C.call(N,D||"default");if(typeof S!="object")return S;throw new TypeError("@@toPrimitive must return a primitive value.")}return(D==="string"?String:Number)(N)}var c=Jt,w=c.Buffer,y=pi,g=y.inspect,m=g&&g.custom||"inspect";function E(N,D,C){w.prototype.copy.call(N,D,C)}return oe=function(){function N(){o(this,N),this.head=null,this.tail=null,this.length=0}return i(N,[{key:"push",value:function(D){var C={data:D,next:null};this.length>0?this.tail.next=C:this.head=C,this.tail=C,++this.length}},{key:"unshift",value:function(D){var C={data:D,next:this.head};this.length===0&&(this.tail=C),this.head=C,++this.length}},{key:"shift",value:function(){if(this.length!==0){var D=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,D}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(D){if(this.length===0)return"";for(var C=this.head,S=""+C.data;C=C.next;)S+=D+C.data;return S}},{key:"concat",value:function(D){if(this.length===0)return w.alloc(0);for(var C=w.allocUnsafe(D>>>0),S=this.head,v=0;S;)E(S.data,C,v),v+=S.data.length,S=S.next;return C}},{key:"consume",value:function(D,C){var S;return D<this.head.data.length?(S=this.head.data.slice(0,D),this.head.data=this.head.data.slice(D)):D===this.head.data.length?S=this.shift():S=C?this._getString(D):this._getBuffer(D),S}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(D){var C=this.head,S=1,v=C.data;for(D-=v.length;C=C.next;){var d=C.data,f=D>d.length?d.length:D;if(f===d.length?v+=d:v+=d.slice(0,D),D-=f,D===0){f===d.length?(++S,C.next?this.head=C.next:this.head=this.tail=null):(this.head=C,C.data=d.slice(f));break}++S}return this.length-=S,v}},{key:"_getBuffer",value:function(D){var C=w.allocUnsafe(D),S=this.head,v=1;for(S.data.copy(C),D-=S.data.length;S=S.next;){var d=S.data,f=D>d.length?d.length:D;if(d.copy(C,C.length-D,0,f),D-=f,D===0){f===d.length?(++v,S.next?this.head=S.next:this.head=this.tail=null):(this.head=S,S.data=d.slice(f));break}++v}return this.length-=v,C}},{key:m,value:function(D,C){return g(this,r(r({},C),{},{depth:0,customInspect:!1}))}}]),N}(),oe}var se,On;function Di(){if(On)return se;On=1;function e(s,a){var c=this,w=this._readableState&&this._readableState.destroyed,y=this._writableState&&this._writableState.destroyed;return w||y?(a?a(s):s&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,Q.nextTick(l,this,s)):Q.nextTick(l,this,s)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(s||null,function(g){!a&&g?c._writableState?c._writableState.errorEmitted?Q.nextTick(n,c):(c._writableState.errorEmitted=!0,Q.nextTick(r,c,g)):Q.nextTick(r,c,g):a?(Q.nextTick(n,c),a(g)):Q.nextTick(n,c)}),this)}function r(s,a){l(s,a),n(s)}function n(s){s._writableState&&!s._writableState.emitClose||s._readableState&&!s._readableState.emitClose||s.emit("close")}function o(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function l(s,a){s.emit("error",a)}function i(s,a){var c=s._readableState,w=s._writableState;c&&c.autoDestroy||w&&w.autoDestroy?s.destroy(a):s.emit("error",a)}return se={destroy:e,undestroy:o,errorOrDestroy:i},se}var ae={},An;function jt(){if(An)return ae;An=1;function e(a,c){a.prototype=Object.create(c.prototype),a.prototype.constructor=a,a.__proto__=c}var r={};function n(a,c,w){w||(w=Error);function y(m,E,N){return typeof c=="string"?c:c(m,E,N)}var g=function(m){e(E,m);function E(N,D,C){return m.call(this,y(N,D,C))||this}return E}(w);g.prototype.name=w.name,g.prototype.code=a,r[a]=g}function o(a,c){if(Array.isArray(a)){var w=a.length;return a=a.map(function(y){return String(y)}),w>2?"one of ".concat(c," ").concat(a.slice(0,w-1).join(", "),", or ")+a[w-1]:w===2?"one of ".concat(c," ").concat(a[0]," or ").concat(a[1]):"of ".concat(c," ").concat(a[0])}else return"of ".concat(c," ").concat(String(a))}function l(a,c,w){return a.substr(0,c.length)===c}function i(a,c,w){return(w===void 0||w>a.length)&&(w=a.length),a.substring(w-c.length,w)===c}function s(a,c,w){return typeof w!="number"&&(w=0),w+c.length>a.length?!1:a.indexOf(c,w)!==-1}return n("ERR_INVALID_OPT_VALUE",function(a,c){return'The value "'+c+'" is invalid for option "'+a+'"'},TypeError),n("ERR_INVALID_ARG_TYPE",function(a,c,w){var y;typeof c=="string"&&l(c,"not ")?(y="must not be",c=c.replace(/^not /,"")):y="must be";var g;if(i(a," argument"))g="The ".concat(a," ").concat(y," ").concat(o(c,"type"));else{var m=s(a,".")?"property":"argument";g='The "'.concat(a,'" ').concat(m," ").concat(y," ").concat(o(c,"type"))}return g+=". Received type ".concat(typeof w),g},TypeError),n("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),n("ERR_METHOD_NOT_IMPLEMENTED",function(a){return"The "+a+" method is not implemented"}),n("ERR_STREAM_PREMATURE_CLOSE","Premature close"),n("ERR_STREAM_DESTROYED",function(a){return"Cannot call "+a+" after a stream was destroyed"}),n("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),n("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),n("ERR_STREAM_WRITE_AFTER_END","write after end"),n("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),n("ERR_UNKNOWN_ENCODING",function(a){return"Unknown encoding: "+a},TypeError),n("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),ae.codes=r,ae}var le,In;function Ci(){if(In)return le;In=1;var e=jt().codes.ERR_INVALID_OPT_VALUE;function r(o,l,i){return o.highWaterMark!=null?o.highWaterMark:l?o[i]:null}function n(o,l,i,s){var a=r(l,s,i);if(a!=null){if(!(isFinite(a)&&Math.floor(a)===a)||a<0){var c=s?i:"highWaterMark";throw new e(c,a)}return Math.floor(a)}return o.objectMode?16:16*1024}return le={getHighWaterMark:n},le}var ue,Pn;function ma(){if(Pn)return ue;Pn=1,ue=e;function e(n,o){if(r("noDeprecation"))return n;var l=!1;function i(){if(!l){if(r("throwDeprecation"))throw new Error(o);r("traceDeprecation")?console.trace(o):console.warn(o),l=!0}return n.apply(this,arguments)}return i}function r(n){try{if(!U.localStorage)return!1}catch{return!1}var o=U.localStorage[n];return o==null?!1:String(o).toLowerCase()==="true"}return ue}var ce,Fn;function xi(){if(Fn)return ce;Fn=1,ce=A;function e(P){var p=this;this.next=null,this.entry=null,this.finish=function(){Et(p,P)}}var r;A.WritableState=x;var n={deprecate:ma()},o=Ei(),l=Jt.Buffer,i=(typeof U<"u"?U:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(P){return l.from(P)}function a(P){return l.isBuffer(P)||P instanceof i}var c=Di(),w=Ci(),y=w.getHighWaterMark,g=jt().codes,m=g.ERR_INVALID_ARG_TYPE,E=g.ERR_METHOD_NOT_IMPLEMENTED,N=g.ERR_MULTIPLE_CALLBACK,D=g.ERR_STREAM_CANNOT_PIPE,C=g.ERR_STREAM_DESTROYED,S=g.ERR_STREAM_NULL_VALUES,v=g.ERR_STREAM_WRITE_AFTER_END,d=g.ERR_UNKNOWN_ENCODING,f=c.errorOrDestroy;Rt(A,o);function b(){}function x(P,p,h){r=r||Pt(),P=P||{},typeof h!="boolean"&&(h=p instanceof r),this.objectMode=!!P.objectMode,h&&(this.objectMode=this.objectMode||!!P.writableObjectMode),this.highWaterMark=y(this,P,"writableHighWaterMark",h),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var I=P.decodeStrings===!1;this.decodeStrings=!I,this.defaultEncoding=P.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(O){G(p,O)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=P.emitClose!==!1,this.autoDestroy=!!P.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new e(this)}x.prototype.getBuffer=function(){for(var P=this.bufferedRequest,p=[];P;)p.push(P),P=P.next;return p},function(){try{Object.defineProperty(x.prototype,"buffer",{get:n.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var L;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(L=Function.prototype[Symbol.hasInstance],Object.defineProperty(A,Symbol.hasInstance,{value:function(P){return L.call(this,P)?!0:this!==A?!1:P&&P._writableState instanceof x}})):L=function(P){return P instanceof this};function A(P){r=r||Pt();var p=this instanceof r;if(!p&&!L.call(A,this))return new A(P);this._writableState=new x(P,this,p),this.writable=!0,P&&(typeof P.write=="function"&&(this._write=P.write),typeof P.writev=="function"&&(this._writev=P.writev),typeof P.destroy=="function"&&(this._destroy=P.destroy),typeof P.final=="function"&&(this._final=P.final)),o.call(this)}A.prototype.pipe=function(){f(this,new D)};function u(P,p){var h=new v;f(P,h),Q.nextTick(p,h)}function F(P,p,h,I){var O;return h===null?O=new S:typeof h!="string"&&!p.objectMode&&(O=new m("chunk",["string","Buffer"],h)),O?(f(P,O),Q.nextTick(I,O),!1):!0}A.prototype.write=function(P,p,h){var I=this._writableState,O=!1,_=!I.objectMode&&a(P);return _&&!l.isBuffer(P)&&(P=s(P)),typeof p=="function"&&(h=p,p=null),_?p="buffer":p||(p=I.defaultEncoding),typeof h!="function"&&(h=b),I.ending?u(this,h):(_||F(this,I,P,h))&&(I.pendingcb++,O=j(this,I,_,P,p,h)),O},A.prototype.cork=function(){this._writableState.corked++},A.prototype.uncork=function(){var P=this._writableState;P.corked&&(P.corked--,!P.writing&&!P.corked&&!P.bufferProcessing&&P.bufferedRequest&&at(this,P))},A.prototype.setDefaultEncoding=function(P){if(typeof P=="string"&&(P=P.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((P+"").toLowerCase())>-1))throw new d(P);return this._writableState.defaultEncoding=P,this},Object.defineProperty(A.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function k(P,p,h){return!P.objectMode&&P.decodeStrings!==!1&&typeof p=="string"&&(p=l.from(p,h)),p}Object.defineProperty(A.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function j(P,p,h,I,O,_){if(!h){var T=k(p,I,O);I!==T&&(h=!0,O="buffer",I=T)}var M=p.objectMode?1:I.length;p.length+=M;var R=p.length<p.highWaterMark;if(R||(p.needDrain=!0),p.writing||p.corked){var Y=p.lastBufferedRequest;p.lastBufferedRequest={chunk:I,encoding:O,isBuf:h,callback:_,next:null},Y?Y.next=p.lastBufferedRequest:p.bufferedRequest=p.lastBufferedRequest,p.bufferedRequestCount+=1}else z(P,p,!1,M,I,O,_);return R}function z(P,p,h,I,O,_,T){p.writelen=I,p.writecb=T,p.writing=!0,p.sync=!0,p.destroyed?p.onwrite(new C("write")):h?P._writev(O,p.onwrite):P._write(O,_,p.onwrite),p.sync=!1}function K(P,p,h,I,O){--p.pendingcb,h?(Q.nextTick(O,I),Q.nextTick(lt,P,p),P._writableState.errorEmitted=!0,f(P,I)):(O(I),P._writableState.errorEmitted=!0,f(P,I),lt(P,p))}function Z(P){P.writing=!1,P.writecb=null,P.length-=P.writelen,P.writelen=0}function G(P,p){var h=P._writableState,I=h.sync,O=h.writecb;if(typeof O!="function")throw new N;if(Z(h),p)K(P,h,I,p,O);else{var _=ht(h)||P.destroyed;!_&&!h.corked&&!h.bufferProcessing&&h.bufferedRequest&&at(P,h),I?Q.nextTick(q,P,h,_,O):q(P,h,_,O)}}function q(P,p,h,I){h||St(P,p),p.pendingcb--,I(),lt(P,p)}function St(P,p){p.length===0&&p.needDrain&&(p.needDrain=!1,P.emit("drain"))}function at(P,p){p.bufferProcessing=!0;var h=p.bufferedRequest;if(P._writev&&h&&h.next){var I=p.bufferedRequestCount,O=new Array(I),_=p.corkedRequestsFree;_.entry=h;for(var T=0,M=!0;h;)O[T]=h,h.isBuf||(M=!1),h=h.next,T+=1;O.allBuffers=M,z(P,p,!0,p.length,O,"",_.finish),p.pendingcb++,p.lastBufferedRequest=null,_.next?(p.corkedRequestsFree=_.next,_.next=null):p.corkedRequestsFree=new e(p),p.bufferedRequestCount=0}else{for(;h;){var R=h.chunk,Y=h.encoding,W=h.callback,$=p.objectMode?1:R.length;if(z(P,p,!1,$,R,Y,W),h=h.next,p.bufferedRequestCount--,p.writing)break}h===null&&(p.lastBufferedRequest=null)}p.bufferedRequest=h,p.bufferProcessing=!1}A.prototype._write=function(P,p,h){h(new E("_write()"))},A.prototype._writev=null,A.prototype.end=function(P,p,h){var I=this._writableState;return typeof P=="function"?(h=P,P=null,p=null):typeof p=="function"&&(h=p,p=null),P!=null&&this.write(P,p),I.corked&&(I.corked=1,this.uncork()),I.ending||Nt(this,I,h),this},Object.defineProperty(A.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function ht(P){return P.ending&&P.length===0&&P.bufferedRequest===null&&!P.finished&&!P.writing}function st(P,p){P._final(function(h){p.pendingcb--,h&&f(P,h),p.prefinished=!0,P.emit("prefinish"),lt(P,p)})}function pt(P,p){!p.prefinished&&!p.finalCalled&&(typeof P._final=="function"&&!p.destroyed?(p.pendingcb++,p.finalCalled=!0,Q.nextTick(st,P,p)):(p.prefinished=!0,P.emit("prefinish")))}function lt(P,p){var h=ht(p);if(h&&(pt(P,p),p.pendingcb===0&&(p.finished=!0,P.emit("finish"),p.autoDestroy))){var I=P._readableState;(!I||I.autoDestroy&&I.endEmitted)&&P.destroy()}return h}function Nt(P,p,h){p.ending=!0,lt(P,p),h&&(p.finished?Q.nextTick(h):P.once("finish",h)),p.ended=!0,P.writable=!1}function Et(P,p,h){var I=P.entry;for(P.entry=null;I;){var O=I.callback;p.pendingcb--,O(h),I=I.next}p.corkedRequestsFree.next=P}return Object.defineProperty(A.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(P){this._writableState&&(this._writableState.destroyed=P)}}),A.prototype.destroy=c.destroy,A.prototype._undestroy=c.undestroy,A.prototype._destroy=function(P,p){p(P)},ce}var de,Ln;function Pt(){if(Ln)return de;Ln=1;var e=Object.keys||function(w){var y=[];for(var g in w)y.push(g);return y};de=s;var r=Oi(),n=xi();Rt(s,r);for(var o=e(n.prototype),l=0;l<o.length;l++){var i=o[l];s.prototype[i]||(s.prototype[i]=n.prototype[i])}function s(w){if(!(this instanceof s))return new s(w);r.call(this,w),n.call(this,w),this.allowHalfOpen=!0,w&&(w.readable===!1&&(this.readable=!1),w.writable===!1&&(this.writable=!1),w.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",a)))}Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function a(){this._writableState.ended||Q.nextTick(c,this)}function c(w){w.end()}return Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(w){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=w,this._writableState.destroyed=w)}}),de}var he={},pe={exports:{}},kn;function ga(){return kn||(kn=1,function(e,r){var n=Jt,o=n.Buffer;function l(s,a){for(var c in s)a[c]=s[c]}o.from&&o.alloc&&o.allocUnsafe&&o.allocUnsafeSlow?e.exports=n:(l(n,r),r.Buffer=i);function i(s,a,c){return o(s,a,c)}i.prototype=Object.create(o.prototype),l(o,i),i.from=function(s,a,c){if(typeof s=="number")throw new TypeError("Argument must not be a number");return o(s,a,c)},i.alloc=function(s,a,c){if(typeof s!="number")throw new TypeError("Argument must be a number");var w=o(s);return a!==void 0?typeof c=="string"?w.fill(a,c):w.fill(a):w.fill(0),w},i.allocUnsafe=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return o(s)},i.allocUnsafeSlow=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return n.SlowBuffer(s)}}(pe,pe.exports)),pe.exports}var Mn;function Se(){if(Mn)return he;Mn=1;var e=ga().Buffer,r=e.isEncoding||function(S){switch(S=""+S,S&&S.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function n(S){if(!S)return"utf8";for(var v;;)switch(S){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return S;default:if(v)return;S=(""+S).toLowerCase(),v=!0}}function o(S){var v=n(S);if(typeof v!="string"&&(e.isEncoding===r||!r(S)))throw new Error("Unknown encoding: "+S);return v||S}he.StringDecoder=l;function l(S){this.encoding=o(S);var v;switch(this.encoding){case"utf16le":this.text=g,this.end=m,v=4;break;case"utf8":this.fillLast=c,v=4;break;case"base64":this.text=E,this.end=N,v=3;break;default:this.write=D,this.end=C;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=e.allocUnsafe(v)}l.prototype.write=function(S){if(S.length===0)return"";var v,d;if(this.lastNeed){if(v=this.fillLast(S),v===void 0)return"";d=this.lastNeed,this.lastNeed=0}else d=0;return d<S.length?v?v+this.text(S,d):this.text(S,d):v||""},l.prototype.end=y,l.prototype.text=w,l.prototype.fillLast=function(S){if(this.lastNeed<=S.length)return S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);S.copy(this.lastChar,this.lastTotal-this.lastNeed,0,S.length),this.lastNeed-=S.length};function i(S){return S<=127?0:S>>5===6?2:S>>4===14?3:S>>3===30?4:S>>6===2?-1:-2}function s(S,v,d){var f=v.length-1;if(f<d)return 0;var b=i(v[f]);return b>=0?(b>0&&(S.lastNeed=b-1),b):--f<d||b===-2?0:(b=i(v[f]),b>=0?(b>0&&(S.lastNeed=b-2),b):--f<d||b===-2?0:(b=i(v[f]),b>=0?(b>0&&(b===2?b=0:S.lastNeed=b-3),b):0))}function a(S,v,d){if((v[0]&192)!==128)return S.lastNeed=0,"�";if(S.lastNeed>1&&v.length>1){if((v[1]&192)!==128)return S.lastNeed=1,"�";if(S.lastNeed>2&&v.length>2&&(v[2]&192)!==128)return S.lastNeed=2,"�"}}function c(S){var v=this.lastTotal-this.lastNeed,d=a(this,S);if(d!==void 0)return d;if(this.lastNeed<=S.length)return S.copy(this.lastChar,v,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);S.copy(this.lastChar,v,0,S.length),this.lastNeed-=S.length}function w(S,v){var d=s(this,S,v);if(!this.lastNeed)return S.toString("utf8",v);this.lastTotal=d;var f=S.length-(d-this.lastNeed);return S.copy(this.lastChar,0,f),S.toString("utf8",v,f)}function y(S){var v=S&&S.length?this.write(S):"";return this.lastNeed?v+"�":v}function g(S,v){if((S.length-v)%2===0){var d=S.toString("utf16le",v);if(d){var f=d.charCodeAt(d.length-1);if(f>=55296&&f<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1],d.slice(0,-1)}return d}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=S[S.length-1],S.toString("utf16le",v,S.length-1)}function m(S){var v=S&&S.length?this.write(S):"";if(this.lastNeed){var d=this.lastTotal-this.lastNeed;return v+this.lastChar.toString("utf16le",0,d)}return v}function E(S,v){var d=(S.length-v)%3;return d===0?S.toString("base64",v):(this.lastNeed=3-d,this.lastTotal=3,d===1?this.lastChar[0]=S[S.length-1]:(this.lastChar[0]=S[S.length-2],this.lastChar[1]=S[S.length-1]),S.toString("base64",v,S.length-d))}function N(S){var v=S&&S.length?this.write(S):"";return this.lastNeed?v+this.lastChar.toString("base64",0,3-this.lastNeed):v}function D(S){return S.toString(this.encoding)}function C(S){return S&&S.length?this.write(S):""}return he}var fe,Rn;function We(){if(Rn)return fe;Rn=1;var e=jt().codes.ERR_STREAM_PREMATURE_CLOSE;function r(i){var s=!1;return function(){if(!s){s=!0;for(var a=arguments.length,c=new Array(a),w=0;w<a;w++)c[w]=arguments[w];i.apply(this,c)}}}function n(){}function o(i){return i.setHeader&&typeof i.abort=="function"}function l(i,s,a){if(typeof s=="function")return l(i,null,s);s||(s={}),a=r(a||n);var c=s.readable||s.readable!==!1&&i.readable,w=s.writable||s.writable!==!1&&i.writable,y=function(){i.writable||m()},g=i._writableState&&i._writableState.finished,m=function(){w=!1,g=!0,c||a.call(i)},E=i._readableState&&i._readableState.endEmitted,N=function(){c=!1,E=!0,w||a.call(i)},D=function(v){a.call(i,v)},C=function(){var v;if(c&&!E)return(!i._readableState||!i._readableState.ended)&&(v=new e),a.call(i,v);if(w&&!g)return(!i._writableState||!i._writableState.ended)&&(v=new e),a.call(i,v)},S=function(){i.req.on("finish",m)};return o(i)?(i.on("complete",m),i.on("abort",C),i.req?S():i.on("request",S)):w&&!i._writableState&&(i.on("end",y),i.on("close",y)),i.on("end",N),i.on("finish",m),s.error!==!1&&i.on("error",D),i.on("close",C),function(){i.removeListener("complete",m),i.removeListener("abort",C),i.removeListener("request",S),i.req&&i.req.removeListener("finish",m),i.removeListener("end",y),i.removeListener("close",y),i.removeListener("finish",m),i.removeListener("end",N),i.removeListener("error",D),i.removeListener("close",C)}}return fe=l,fe}var me,jn;function ya(){if(jn)return me;jn=1;var e;function r(d,f,b){return f=n(f),f in d?Object.defineProperty(d,f,{value:b,enumerable:!0,configurable:!0,writable:!0}):d[f]=b,d}function n(d){var f=o(d,"string");return typeof f=="symbol"?f:String(f)}function o(d,f){if(typeof d!="object"||d===null)return d;var b=d[Symbol.toPrimitive];if(b!==void 0){var x=b.call(d,f||"default");if(typeof x!="object")return x;throw new TypeError("@@toPrimitive must return a primitive value.")}return(f==="string"?String:Number)(d)}var l=We(),i=Symbol("lastResolve"),s=Symbol("lastReject"),a=Symbol("error"),c=Symbol("ended"),w=Symbol("lastPromise"),y=Symbol("handlePromise"),g=Symbol("stream");function m(d,f){return{value:d,done:f}}function E(d){var f=d[i];if(f!==null){var b=d[g].read();b!==null&&(d[w]=null,d[i]=null,d[s]=null,f(m(b,!1)))}}function N(d){Q.nextTick(E,d)}function D(d,f){return function(b,x){d.then(function(){if(f[c]){b(m(void 0,!0));return}f[y](b,x)},x)}}var C=Object.getPrototypeOf(function(){}),S=Object.setPrototypeOf((e={get stream(){return this[g]},next:function(){var d=this,f=this[a];if(f!==null)return Promise.reject(f);if(this[c])return Promise.resolve(m(void 0,!0));if(this[g].destroyed)return new Promise(function(A,u){Q.nextTick(function(){d[a]?u(d[a]):A(m(void 0,!0))})});var b=this[w],x;if(b)x=new Promise(D(b,this));else{var L=this[g].read();if(L!==null)return Promise.resolve(m(L,!1));x=new Promise(this[y])}return this[w]=x,x}},r(e,Symbol.asyncIterator,function(){return this}),r(e,"return",function(){var d=this;return new Promise(function(f,b){d[g].destroy(null,function(x){if(x){b(x);return}f(m(void 0,!0))})})}),e),C),v=function(d){var f,b=Object.create(S,(f={},r(f,g,{value:d,writable:!0}),r(f,i,{value:null,writable:!0}),r(f,s,{value:null,writable:!0}),r(f,a,{value:null,writable:!0}),r(f,c,{value:d._readableState.endEmitted,writable:!0}),r(f,y,{value:function(x,L){var A=b[g].read();A?(b[w]=null,b[i]=null,b[s]=null,x(m(A,!1))):(b[i]=x,b[s]=L)},writable:!0}),f));return b[w]=null,l(d,function(x){if(x&&x.code!=="ERR_STREAM_PREMATURE_CLOSE"){var L=b[s];L!==null&&(b[w]=null,b[i]=null,b[s]=null,L(x)),b[a]=x;return}var A=b[i];A!==null&&(b[w]=null,b[i]=null,b[s]=null,A(m(void 0,!0))),b[c]=!0}),d.on("readable",N.bind(null,b)),b};return me=v,me}var Vn,Bn;function va(){return Bn||(Bn=1,Vn=function(){throw new Error("Readable.from is not available in the browser")}),Vn}var ge,Un;function Oi(){if(Un)return ge;Un=1,ge=u;var e;u.ReadableState=A,Zt().EventEmitter;var r=function(_,T){return _.listeners(T).length},n=Ei(),o=Jt.Buffer,l=(typeof U<"u"?U:typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function i(_){return o.from(_)}function s(_){return o.isBuffer(_)||_ instanceof l}var a=pi,c;a&&a.debuglog?c=a.debuglog("stream"):c=function(){};var w=fa(),y=Di(),g=Ci(),m=g.getHighWaterMark,E=jt().codes,N=E.ERR_INVALID_ARG_TYPE,D=E.ERR_STREAM_PUSH_AFTER_EOF,C=E.ERR_METHOD_NOT_IMPLEMENTED,S=E.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,v,d,f;Rt(u,n);var b=y.errorOrDestroy,x=["error","close","destroy","pause","resume"];function L(_,T,M){if(typeof _.prependListener=="function")return _.prependListener(T,M);!_._events||!_._events[T]?_.on(T,M):Array.isArray(_._events[T])?_._events[T].unshift(M):_._events[T]=[M,_._events[T]]}function A(_,T,M){e=e||Pt(),_=_||{},typeof M!="boolean"&&(M=T instanceof e),this.objectMode=!!_.objectMode,M&&(this.objectMode=this.objectMode||!!_.readableObjectMode),this.highWaterMark=m(this,_,"readableHighWaterMark",M),this.buffer=new w,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=_.emitClose!==!1,this.autoDestroy=!!_.autoDestroy,this.destroyed=!1,this.defaultEncoding=_.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,_.encoding&&(v||(v=Se().StringDecoder),this.decoder=new v(_.encoding),this.encoding=_.encoding)}function u(_){if(e=e||Pt(),!(this instanceof u))return new u(_);var T=this instanceof e;this._readableState=new A(_,this,T),this.readable=!0,_&&(typeof _.read=="function"&&(this._read=_.read),typeof _.destroy=="function"&&(this._destroy=_.destroy)),n.call(this)}Object.defineProperty(u.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(_){this._readableState&&(this._readableState.destroyed=_)}}),u.prototype.destroy=y.destroy,u.prototype._undestroy=y.undestroy,u.prototype._destroy=function(_,T){T(_)},u.prototype.push=function(_,T){var M=this._readableState,R;return M.objectMode?R=!0:typeof _=="string"&&(T=T||M.defaultEncoding,T!==M.encoding&&(_=o.from(_,T),T=""),R=!0),F(this,_,T,!1,R)},u.prototype.unshift=function(_){return F(this,_,null,!0,!1)};function F(_,T,M,R,Y){c("readableAddChunk",T);var W=_._readableState;if(T===null)W.reading=!1,G(_,W);else{var $;if(Y||($=j(W,T)),$)b(_,$);else if(W.objectMode||T&&T.length>0)if(typeof T!="string"&&!W.objectMode&&Object.getPrototypeOf(T)!==o.prototype&&(T=i(T)),R)W.endEmitted?b(_,new S):k(_,W,T,!0);else if(W.ended)b(_,new D);else{if(W.destroyed)return!1;W.reading=!1,W.decoder&&!M?(T=W.decoder.write(T),W.objectMode||T.length!==0?k(_,W,T,!1):at(_,W)):k(_,W,T,!1)}else R||(W.reading=!1,at(_,W))}return!W.ended&&(W.length<W.highWaterMark||W.length===0)}function k(_,T,M,R){T.flowing&&T.length===0&&!T.sync?(T.awaitDrain=0,_.emit("data",M)):(T.length+=T.objectMode?1:M.length,R?T.buffer.unshift(M):T.buffer.push(M),T.needReadable&&q(_)),at(_,T)}function j(_,T){var M;return!s(T)&&typeof T!="string"&&T!==void 0&&!_.objectMode&&(M=new N("chunk",["string","Buffer","Uint8Array"],T)),M}u.prototype.isPaused=function(){return this._readableState.flowing===!1},u.prototype.setEncoding=function(_){v||(v=Se().StringDecoder);var T=new v(_);this._readableState.decoder=T,this._readableState.encoding=this._readableState.decoder.encoding;for(var M=this._readableState.buffer.head,R="";M!==null;)R+=T.write(M.data),M=M.next;return this._readableState.buffer.clear(),R!==""&&this._readableState.buffer.push(R),this._readableState.length=R.length,this};var z=1073741824;function K(_){return _>=z?_=z:(_--,_|=_>>>1,_|=_>>>2,_|=_>>>4,_|=_>>>8,_|=_>>>16,_++),_}function Z(_,T){return _<=0||T.length===0&&T.ended?0:T.objectMode?1:_!==_?T.flowing&&T.length?T.buffer.head.data.length:T.length:(_>T.highWaterMark&&(T.highWaterMark=K(_)),_<=T.length?_:T.ended?T.length:(T.needReadable=!0,0))}u.prototype.read=function(_){c("read",_),_=parseInt(_,10);var T=this._readableState,M=_;if(_!==0&&(T.emittedReadable=!1),_===0&&T.needReadable&&((T.highWaterMark!==0?T.length>=T.highWaterMark:T.length>0)||T.ended))return c("read: emitReadable",T.length,T.ended),T.length===0&&T.ended?h(this):q(this),null;if(_=Z(_,T),_===0&&T.ended)return T.length===0&&h(this),null;var R=T.needReadable;c("need readable",R),(T.length===0||T.length-_<T.highWaterMark)&&(R=!0,c("length less than watermark",R)),T.ended||T.reading?(R=!1,c("reading or ended",R)):R&&(c("do read"),T.reading=!0,T.sync=!0,T.length===0&&(T.needReadable=!0),this._read(T.highWaterMark),T.sync=!1,T.reading||(_=Z(M,T)));var Y;return _>0?Y=p(_,T):Y=null,Y===null?(T.needReadable=T.length<=T.highWaterMark,_=0):(T.length-=_,T.awaitDrain=0),T.length===0&&(T.ended||(T.needReadable=!0),M!==_&&T.ended&&h(this)),Y!==null&&this.emit("data",Y),Y};function G(_,T){if(c("onEofChunk"),!T.ended){if(T.decoder){var M=T.decoder.end();M&&M.length&&(T.buffer.push(M),T.length+=T.objectMode?1:M.length)}T.ended=!0,T.sync?q(_):(T.needReadable=!1,T.emittedReadable||(T.emittedReadable=!0,St(_)))}}function q(_){var T=_._readableState;c("emitReadable",T.needReadable,T.emittedReadable),T.needReadable=!1,T.emittedReadable||(c("emitReadable",T.flowing),T.emittedReadable=!0,Q.nextTick(St,_))}function St(_){var T=_._readableState;c("emitReadable_",T.destroyed,T.length,T.ended),!T.destroyed&&(T.length||T.ended)&&(_.emit("readable"),T.emittedReadable=!1),T.needReadable=!T.flowing&&!T.ended&&T.length<=T.highWaterMark,P(_)}function at(_,T){T.readingMore||(T.readingMore=!0,Q.nextTick(ht,_,T))}function ht(_,T){for(;!T.reading&&!T.ended&&(T.length<T.highWaterMark||T.flowing&&T.length===0);){var M=T.length;if(c("maybeReadMore read 0"),_.read(0),M===T.length)break}T.readingMore=!1}u.prototype._read=function(_){b(this,new C("_read()"))},u.prototype.pipe=function(_,T){var M=this,R=this._readableState;switch(R.pipesCount){case 0:R.pipes=_;break;case 1:R.pipes=[R.pipes,_];break;default:R.pipes.push(_);break}R.pipesCount+=1,c("pipe count=%d opts=%j",R.pipesCount,T);var Y=(!T||T.end!==!1)&&_!==Q.stdout&&_!==Q.stderr,W=Y?rt:$t;R.endEmitted?Q.nextTick(W):M.once("end",W),_.on("unpipe",$);function $(Dt,Ct){c("onunpipe"),Dt===M&&Ct&&Ct.hasUnpiped===!1&&(Ct.hasUnpiped=!0,Ut())}function rt(){c("onend"),_.end()}var Vt=st(M);_.on("drain",Vt);var Bt=!1;function Ut(){c("cleanup"),_.removeListener("close",ee),_.removeListener("finish",re),_.removeListener("drain",Vt),_.removeListener("error",te),_.removeListener("unpipe",$),M.removeListener("end",rt),M.removeListener("end",$t),M.removeListener("data",qt),Bt=!0,R.awaitDrain&&(!_._writableState||_._writableState.needDrain)&&Vt()}M.on("data",qt);function qt(Dt){c("ondata");var Ct=_.write(Dt);c("dest.write",Ct),Ct===!1&&((R.pipesCount===1&&R.pipes===_||R.pipesCount>1&&O(R.pipes,_)!==-1)&&!Bt&&(c("false write response, pause",R.awaitDrain),R.awaitDrain++),M.pause())}function te(Dt){c("onerror",Dt),$t(),_.removeListener("error",te),r(_,"error")===0&&b(_,Dt)}L(_,"error",te);function ee(){_.removeListener("finish",re),$t()}_.once("close",ee);function re(){c("onfinish"),_.removeListener("close",ee),$t()}_.once("finish",re);function $t(){c("unpipe"),M.unpipe(_)}return _.emit("pipe",M),R.flowing||(c("pipe resume"),M.resume()),_};function st(_){return function(){var T=_._readableState;c("pipeOnDrain",T.awaitDrain),T.awaitDrain&&T.awaitDrain--,T.awaitDrain===0&&r(_,"data")&&(T.flowing=!0,P(_))}}u.prototype.unpipe=function(_){var T=this._readableState,M={hasUnpiped:!1};if(T.pipesCount===0)return this;if(T.pipesCount===1)return _&&_!==T.pipes?this:(_||(_=T.pipes),T.pipes=null,T.pipesCount=0,T.flowing=!1,_&&_.emit("unpipe",this,M),this);if(!_){var R=T.pipes,Y=T.pipesCount;T.pipes=null,T.pipesCount=0,T.flowing=!1;for(var W=0;W<Y;W++)R[W].emit("unpipe",this,{hasUnpiped:!1});return this}var $=O(T.pipes,_);return $===-1?this:(T.pipes.splice($,1),T.pipesCount-=1,T.pipesCount===1&&(T.pipes=T.pipes[0]),_.emit("unpipe",this,M),this)},u.prototype.on=function(_,T){var M=n.prototype.on.call(this,_,T),R=this._readableState;return _==="data"?(R.readableListening=this.listenerCount("readable")>0,R.flowing!==!1&&this.resume()):_==="readable"&&!R.endEmitted&&!R.readableListening&&(R.readableListening=R.needReadable=!0,R.flowing=!1,R.emittedReadable=!1,c("on readable",R.length,R.reading),R.length?q(this):R.reading||Q.nextTick(lt,this)),M},u.prototype.addListener=u.prototype.on,u.prototype.removeListener=function(_,T){var M=n.prototype.removeListener.call(this,_,T);return _==="readable"&&Q.nextTick(pt,this),M},u.prototype.removeAllListeners=function(_){var T=n.prototype.removeAllListeners.apply(this,arguments);return(_==="readable"||_===void 0)&&Q.nextTick(pt,this),T};function pt(_){var T=_._readableState;T.readableListening=_.listenerCount("readable")>0,T.resumeScheduled&&!T.paused?T.flowing=!0:_.listenerCount("data")>0&&_.resume()}function lt(_){c("readable nexttick read 0"),_.read(0)}u.prototype.resume=function(){var _=this._readableState;return _.flowing||(c("resume"),_.flowing=!_.readableListening,Nt(this,_)),_.paused=!1,this};function Nt(_,T){T.resumeScheduled||(T.resumeScheduled=!0,Q.nextTick(Et,_,T))}function Et(_,T){c("resume",T.reading),T.reading||_.read(0),T.resumeScheduled=!1,_.emit("resume"),P(_),T.flowing&&!T.reading&&_.read(0)}u.prototype.pause=function(){return c("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(c("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function P(_){var T=_._readableState;for(c("flow",T.flowing);T.flowing&&_.read()!==null;);}u.prototype.wrap=function(_){var T=this,M=this._readableState,R=!1;_.on("end",function(){if(c("wrapped end"),M.decoder&&!M.ended){var $=M.decoder.end();$&&$.length&&T.push($)}T.push(null)}),_.on("data",function($){if(c("wrapped data"),M.decoder&&($=M.decoder.write($)),!(M.objectMode&&$==null)&&!(!M.objectMode&&(!$||!$.length))){var rt=T.push($);rt||(R=!0,_.pause())}});for(var Y in _)this[Y]===void 0&&typeof _[Y]=="function"&&(this[Y]=function($){return function(){return _[$].apply(_,arguments)}}(Y));for(var W=0;W<x.length;W++)_.on(x[W],this.emit.bind(this,x[W]));return this._read=function($){c("wrapped _read",$),R&&(R=!1,_.resume())},this},typeof Symbol=="function"&&(u.prototype[Symbol.asyncIterator]=function(){return d===void 0&&(d=ya()),d(this)}),Object.defineProperty(u.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(u.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(u.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(_){this._readableState&&(this._readableState.flowing=_)}}),u._fromList=p,Object.defineProperty(u.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function p(_,T){if(T.length===0)return null;var M;return T.objectMode?M=T.buffer.shift():!_||_>=T.length?(T.decoder?M=T.buffer.join(""):T.buffer.length===1?M=T.buffer.first():M=T.buffer.concat(T.length),T.buffer.clear()):M=T.buffer.consume(_,T.decoder),M}function h(_){var T=_._readableState;c("endReadable",T.endEmitted),T.endEmitted||(T.ended=!0,Q.nextTick(I,T,_))}function I(_,T){if(c("endReadableNT",_.endEmitted,_.length),!_.endEmitted&&_.length===0&&(_.endEmitted=!0,T.readable=!1,T.emit("end"),_.autoDestroy)){var M=T._writableState;(!M||M.autoDestroy&&M.finished)&&T.destroy()}}typeof Symbol=="function"&&(u.from=function(_,T){return f===void 0&&(f=va()),f(u,_,T)});function O(_,T){for(var M=0,R=_.length;M<R;M++)if(_[M]===T)return M;return-1}return ge}var ye,qn;function Ai(){if(qn)return ye;qn=1,ye=a;var e=jt().codes,r=e.ERR_METHOD_NOT_IMPLEMENTED,n=e.ERR_MULTIPLE_CALLBACK,o=e.ERR_TRANSFORM_ALREADY_TRANSFORMING,l=e.ERR_TRANSFORM_WITH_LENGTH_0,i=Pt();Rt(a,i);function s(y,g){var m=this._transformState;m.transforming=!1;var E=m.writecb;if(E===null)return this.emit("error",new n);m.writechunk=null,m.writecb=null,g!=null&&this.push(g),E(y);var N=this._readableState;N.reading=!1,(N.needReadable||N.length<N.highWaterMark)&&this._read(N.highWaterMark)}function a(y){if(!(this instanceof a))return new a(y);i.call(this,y),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,y&&(typeof y.transform=="function"&&(this._transform=y.transform),typeof y.flush=="function"&&(this._flush=y.flush)),this.on("prefinish",c)}function c(){var y=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(g,m){w(y,g,m)}):w(this,null,null)}a.prototype.push=function(y,g){return this._transformState.needTransform=!1,i.prototype.push.call(this,y,g)},a.prototype._transform=function(y,g,m){m(new r("_transform()"))},a.prototype._write=function(y,g,m){var E=this._transformState;if(E.writecb=m,E.writechunk=y,E.writeencoding=g,!E.transforming){var N=this._readableState;(E.needTransform||N.needReadable||N.length<N.highWaterMark)&&this._read(N.highWaterMark)}},a.prototype._read=function(y){var g=this._transformState;g.writechunk!==null&&!g.transforming?(g.transforming=!0,this._transform(g.writechunk,g.writeencoding,g.afterTransform)):g.needTransform=!0},a.prototype._destroy=function(y,g){i.prototype._destroy.call(this,y,function(m){g(m)})};function w(y,g,m){if(g)return y.emit("error",g);if(m!=null&&y.push(m),y._writableState.length)throw new l;if(y._transformState.transforming)throw new o;return y.push(null)}return ye}var ve,$n;function wa(){if($n)return ve;$n=1,ve=r;var e=Ai();Rt(r,e);function r(n){if(!(this instanceof r))return new r(n);e.call(this,n)}return r.prototype._transform=function(n,o,l){l(null,n)},ve}var we,zn;function ba(){if(zn)return we;zn=1;var e;function r(m){var E=!1;return function(){E||(E=!0,m.apply(void 0,arguments))}}var n=jt().codes,o=n.ERR_MISSING_ARGS,l=n.ERR_STREAM_DESTROYED;function i(m){if(m)throw m}function s(m){return m.setHeader&&typeof m.abort=="function"}function a(m,E,N,D){D=r(D);var C=!1;m.on("close",function(){C=!0}),e===void 0&&(e=We()),e(m,{readable:E,writable:N},function(v){if(v)return D(v);C=!0,D()});var S=!1;return function(v){if(!C&&!S){if(S=!0,s(m))return m.abort();if(typeof m.destroy=="function")return m.destroy();D(v||new l("pipe"))}}}function c(m){m()}function w(m,E){return m.pipe(E)}function y(m){return!m.length||typeof m[m.length-1]!="function"?i:m.pop()}function g(){for(var m=arguments.length,E=new Array(m),N=0;N<m;N++)E[N]=arguments[N];var D=y(E);if(Array.isArray(E[0])&&(E=E[0]),E.length<2)throw new o("streams");var C,S=E.map(function(v,d){var f=d<E.length-1,b=d>0;return a(v,f,b,function(x){C||(C=x),x&&S.forEach(c),!f&&(S.forEach(c),D(C))})});return E.reduce(w)}return we=g,we}var be,Wn;function _a(){if(Wn)return be;Wn=1,be=n;var e=Zt().EventEmitter,r=Rt;r(n,e),n.Readable=Oi(),n.Writable=xi(),n.Duplex=Pt(),n.Transform=Ai(),n.PassThrough=wa(),n.finished=We(),n.pipeline=ba(),n.Stream=n;function n(){e.call(this)}return n.prototype.pipe=function(o,l){var i=this;function s(E){o.writable&&o.write(E)===!1&&i.pause&&i.pause()}i.on("data",s);function a(){i.readable&&i.resume&&i.resume()}o.on("drain",a),!o._isStdio&&(!l||l.end!==!1)&&(i.on("end",w),i.on("close",y));var c=!1;function w(){c||(c=!0,o.end())}function y(){c||(c=!0,typeof o.destroy=="function"&&o.destroy())}function g(E){if(m(),e.listenerCount(this,"error")===0)throw E}i.on("error",g),o.on("error",g);function m(){i.removeListener("data",s),o.removeListener("drain",a),i.removeListener("end",w),i.removeListener("close",y),i.removeListener("error",g),o.removeListener("error",g),i.removeListener("end",m),i.removeListener("close",m),o.removeListener("close",m)}return i.on("end",m),i.on("close",m),o.on("close",m),o.emit("pipe",i),o},be}var Hn;function Ta(){return Hn||(Hn=1,function(e){(function(r){r.parser=function(p,h){return new o(p,h)},r.SAXParser=o,r.SAXStream=y,r.createStream=w,r.MAX_BUFFER_LENGTH=64*1024;var n=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];r.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function o(p,h){if(!(this instanceof o))return new o(p,h);var I=this;i(I),I.q=I.c="",I.bufferCheckPosition=r.MAX_BUFFER_LENGTH,I.opt=h||{},I.opt.lowercase=I.opt.lowercase||I.opt.lowercasetags,I.looseCase=I.opt.lowercase?"toLowerCase":"toUpperCase",I.tags=[],I.closed=I.closedRoot=I.sawRoot=!1,I.tag=I.error=null,I.strict=!!p,I.noscript=!!(p||I.opt.noscript),I.state=u.BEGIN,I.strictEntities=I.opt.strictEntities,I.ENTITIES=I.strictEntities?Object.create(r.XML_ENTITIES):Object.create(r.ENTITIES),I.attribList=[],I.opt.xmlns&&(I.ns=Object.create(D)),I.trackPosition=I.opt.position!==!1,I.trackPosition&&(I.position=I.line=I.column=0),k(I,"onready")}Object.create||(Object.create=function(p){function h(){}h.prototype=p;var I=new h;return I}),Object.keys||(Object.keys=function(p){var h=[];for(var I in p)p.hasOwnProperty(I)&&h.push(I);return h});function l(p){for(var h=Math.max(r.MAX_BUFFER_LENGTH,10),I=0,O=0,_=n.length;O<_;O++){var T=p[n[O]].length;if(T>h)switch(n[O]){case"textNode":z(p);break;case"cdata":j(p,"oncdata",p.cdata),p.cdata="";break;case"script":j(p,"onscript",p.script),p.script="";break;default:Z(p,"Max buffer length exceeded: "+n[O])}I=Math.max(I,T)}var M=r.MAX_BUFFER_LENGTH-I;p.bufferCheckPosition=M+p.position}function i(p){for(var h=0,I=n.length;h<I;h++)p[n[h]]=""}function s(p){z(p),p.cdata!==""&&(j(p,"oncdata",p.cdata),p.cdata=""),p.script!==""&&(j(p,"onscript",p.script),p.script="")}o.prototype={end:function(){G(this)},write:P,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){s(this)}};var a;try{a=_a().Stream}catch{a=function(){}}a||(a=function(){});var c=r.EVENTS.filter(function(p){return p!=="error"&&p!=="end"});function w(p,h){return new y(p,h)}function y(p,h){if(!(this instanceof y))return new y(p,h);a.apply(this),this._parser=new o(p,h),this.writable=!0,this.readable=!0;var I=this;this._parser.onend=function(){I.emit("end")},this._parser.onerror=function(O){I.emit("error",O),I._parser.error=null},this._decoder=null,c.forEach(function(O){Object.defineProperty(I,"on"+O,{get:function(){return I._parser["on"+O]},set:function(_){if(!_)return I.removeAllListeners(O),I._parser["on"+O]=_,_;I.on(O,_)},enumerable:!0,configurable:!1})})}y.prototype=Object.create(a.prototype,{constructor:{value:y}}),y.prototype.write=function(p){if(typeof ne=="function"&&typeof ne.isBuffer=="function"&&ne.isBuffer(p)){if(!this._decoder){var h=Se().StringDecoder;this._decoder=new h("utf8")}p=this._decoder.write(p)}return this._parser.write(p.toString()),this.emit("data",p),!0},y.prototype.end=function(p){return p&&p.length&&this.write(p),this._parser.end(),!0},y.prototype.on=function(p,h){var I=this;return!I._parser["on"+p]&&c.indexOf(p)!==-1&&(I._parser["on"+p]=function(){var O=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);O.splice(0,0,p),I.emit.apply(I,O)}),a.prototype.on.call(I,p,h)};var g="[CDATA[",m="DOCTYPE",E="http://www.w3.org/XML/1998/namespace",N="http://www.w3.org/2000/xmlns/",D={xml:E,xmlns:N},C=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,S=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,v=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,d=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function f(p){return p===" "||p==="\n"||p==="\r"||p==="	"}function b(p){return p==='"'||p==="'"}function x(p){return p===">"||f(p)}function L(p,h){return p.test(h)}function A(p,h){return!L(p,h)}var u=0;r.STATE={BEGIN:u++,BEGIN_WHITESPACE:u++,TEXT:u++,TEXT_ENTITY:u++,OPEN_WAKA:u++,SGML_DECL:u++,SGML_DECL_QUOTED:u++,DOCTYPE:u++,DOCTYPE_QUOTED:u++,DOCTYPE_DTD:u++,DOCTYPE_DTD_QUOTED:u++,COMMENT_STARTING:u++,COMMENT:u++,COMMENT_ENDING:u++,COMMENT_ENDED:u++,CDATA:u++,CDATA_ENDING:u++,CDATA_ENDING_2:u++,PROC_INST:u++,PROC_INST_BODY:u++,PROC_INST_ENDING:u++,OPEN_TAG:u++,OPEN_TAG_SLASH:u++,ATTRIB:u++,ATTRIB_NAME:u++,ATTRIB_NAME_SAW_WHITE:u++,ATTRIB_VALUE:u++,ATTRIB_VALUE_QUOTED:u++,ATTRIB_VALUE_CLOSED:u++,ATTRIB_VALUE_UNQUOTED:u++,ATTRIB_VALUE_ENTITY_Q:u++,ATTRIB_VALUE_ENTITY_U:u++,CLOSE_TAG:u++,CLOSE_TAG_SAW_WHITE:u++,SCRIPT:u++,SCRIPT_ENDING:u++},r.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},r.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(r.ENTITIES).forEach(function(p){var h=r.ENTITIES[p],I=typeof h=="number"?String.fromCharCode(h):h;r.ENTITIES[p]=I});for(var F in r.STATE)r.STATE[r.STATE[F]]=F;u=r.STATE;function k(p,h,I){p[h]&&p[h](I)}function j(p,h,I){p.textNode&&z(p),k(p,h,I)}function z(p){p.textNode=K(p.opt,p.textNode),p.textNode&&k(p,"ontext",p.textNode),p.textNode=""}function K(p,h){return p.trim&&(h=h.trim()),p.normalize&&(h=h.replace(/\s+/g," ")),h}function Z(p,h){return z(p),p.trackPosition&&(h+="\nLine: "+p.line+"\nColumn: "+p.column+"\nChar: "+p.c),h=new Error(h),p.error=h,k(p,"onerror",h),p}function G(p){return p.sawRoot&&!p.closedRoot&&q(p,"Unclosed root tag"),p.state!==u.BEGIN&&p.state!==u.BEGIN_WHITESPACE&&p.state!==u.TEXT&&Z(p,"Unexpected end"),z(p),p.c="",p.closed=!0,k(p,"onend"),o.call(p,p.strict,p.opt),p}function q(p,h){if(typeof p!="object"||!(p instanceof o))throw new Error("bad call to strictFail");p.strict&&Z(p,h)}function St(p){p.strict||(p.tagName=p.tagName[p.looseCase]());var h=p.tags[p.tags.length-1]||p,I=p.tag={name:p.tagName,attributes:{}};p.opt.xmlns&&(I.ns=h.ns),p.attribList.length=0,j(p,"onopentagstart",I)}function at(p,h){var I=p.indexOf(":"),O=I<0?["",p]:p.split(":"),_=O[0],T=O[1];return h&&p==="xmlns"&&(_="xmlns",T=""),{prefix:_,local:T}}function ht(p){if(p.strict||(p.attribName=p.attribName[p.looseCase]()),p.attribList.indexOf(p.attribName)!==-1||p.tag.attributes.hasOwnProperty(p.attribName)){p.attribName=p.attribValue="";return}if(p.opt.xmlns){var h=at(p.attribName,!0),I=h.prefix,O=h.local;if(I==="xmlns")if(O==="xml"&&p.attribValue!==E)q(p,"xml: prefix must be bound to "+E+"\nActual: "+p.attribValue);else if(O==="xmlns"&&p.attribValue!==N)q(p,"xmlns: prefix must be bound to "+N+"\nActual: "+p.attribValue);else{var _=p.tag,T=p.tags[p.tags.length-1]||p;_.ns===T.ns&&(_.ns=Object.create(T.ns)),_.ns[O]=p.attribValue}p.attribList.push([p.attribName,p.attribValue])}else p.tag.attributes[p.attribName]=p.attribValue,j(p,"onattribute",{name:p.attribName,value:p.attribValue});p.attribName=p.attribValue=""}function st(p,h){if(p.opt.xmlns){var I=p.tag,O=at(p.tagName);I.prefix=O.prefix,I.local=O.local,I.uri=I.ns[O.prefix]||"",I.prefix&&!I.uri&&(q(p,"Unbound namespace prefix: "+JSON.stringify(p.tagName)),I.uri=O.prefix);var _=p.tags[p.tags.length-1]||p;I.ns&&_.ns!==I.ns&&Object.keys(I.ns).forEach(function(qt){j(p,"onopennamespace",{prefix:qt,uri:I.ns[qt]})});for(var T=0,M=p.attribList.length;T<M;T++){var R=p.attribList[T],Y=R[0],W=R[1],$=at(Y,!0),rt=$.prefix,Vt=$.local,Bt=rt===""?"":I.ns[rt]||"",Ut={name:Y,value:W,prefix:rt,local:Vt,uri:Bt};rt&&rt!=="xmlns"&&!Bt&&(q(p,"Unbound namespace prefix: "+JSON.stringify(rt)),Ut.uri=rt),p.tag.attributes[Y]=Ut,j(p,"onattribute",Ut)}p.attribList.length=0}p.tag.isSelfClosing=!!h,p.sawRoot=!0,p.tags.push(p.tag),j(p,"onopentag",p.tag),h||(!p.noscript&&p.tagName.toLowerCase()==="script"?p.state=u.SCRIPT:p.state=u.TEXT,p.tag=null,p.tagName=""),p.attribName=p.attribValue="",p.attribList.length=0}function pt(p){if(!p.tagName){q(p,"Weird empty close tag."),p.textNode+="</>",p.state=u.TEXT;return}if(p.script){if(p.tagName!=="script"){p.script+="</"+p.tagName+">",p.tagName="",p.state=u.SCRIPT;return}j(p,"onscript",p.script),p.script=""}var h=p.tags.length,I=p.tagName;p.strict||(I=I[p.looseCase]());for(var O=I;h--;){var _=p.tags[h];if(_.name!==O)q(p,"Unexpected close tag");else break}if(h<0){q(p,"Unmatched closing tag: "+p.tagName),p.textNode+="</"+p.tagName+">",p.state=u.TEXT;return}p.tagName=I;for(var T=p.tags.length;T-- >h;){var M=p.tag=p.tags.pop();p.tagName=p.tag.name,j(p,"onclosetag",p.tagName);var R={};for(var Y in M.ns)R[Y]=M.ns[Y];var W=p.tags[p.tags.length-1]||p;p.opt.xmlns&&M.ns!==W.ns&&Object.keys(M.ns).forEach(function($){var rt=M.ns[$];j(p,"onclosenamespace",{prefix:$,uri:rt})})}h===0&&(p.closedRoot=!0),p.tagName=p.attribValue=p.attribName="",p.attribList.length=0,p.state=u.TEXT}function lt(p){var h=p.entity,I=h.toLowerCase(),O,_="";return p.ENTITIES[h]?p.ENTITIES[h]:p.ENTITIES[I]?p.ENTITIES[I]:(h=I,h.charAt(0)==="#"&&(h.charAt(1)==="x"?(h=h.slice(2),O=parseInt(h,16),_=O.toString(16)):(h=h.slice(1),O=parseInt(h,10),_=O.toString(10))),h=h.replace(/^0+/,""),isNaN(O)||_.toLowerCase()!==h?(q(p,"Invalid character entity"),"&"+p.entity+";"):String.fromCodePoint(O))}function Nt(p,h){h==="<"?(p.state=u.OPEN_WAKA,p.startTagPosition=p.position):f(h)||(q(p,"Non-whitespace before first tag."),p.textNode=h,p.state=u.TEXT)}function Et(p,h){var I="";return h<p.length&&(I=p.charAt(h)),I}function P(p){var h=this;if(this.error)throw this.error;if(h.closed)return Z(h,"Cannot write after close. Assign an onready handler.");if(p===null)return G(h);typeof p=="object"&&(p=p.toString());for(var I=0,O="";O=Et(p,I++),h.c=O,!!O;)switch(h.trackPosition&&(h.position++,O==="\n"?(h.line++,h.column=0):h.column++),h.state){case u.BEGIN:if(h.state=u.BEGIN_WHITESPACE,O==="\uFEFF")continue;Nt(h,O);continue;case u.BEGIN_WHITESPACE:Nt(h,O);continue;case u.TEXT:if(h.sawRoot&&!h.closedRoot){for(var _=I-1;O&&O!=="<"&&O!=="&";)O=Et(p,I++),O&&h.trackPosition&&(h.position++,O==="\n"?(h.line++,h.column=0):h.column++);h.textNode+=p.substring(_,I-1)}O==="<"&&!(h.sawRoot&&h.closedRoot&&!h.strict)?(h.state=u.OPEN_WAKA,h.startTagPosition=h.position):(!f(O)&&(!h.sawRoot||h.closedRoot)&&q(h,"Text data outside of root node."),O==="&"?h.state=u.TEXT_ENTITY:h.textNode+=O);continue;case u.SCRIPT:O==="<"?h.state=u.SCRIPT_ENDING:h.script+=O;continue;case u.SCRIPT_ENDING:O==="/"?h.state=u.CLOSE_TAG:(h.script+="<"+O,h.state=u.SCRIPT);continue;case u.OPEN_WAKA:if(O==="!")h.state=u.SGML_DECL,h.sgmlDecl="";else if(!f(O))if(L(C,O))h.state=u.OPEN_TAG,h.tagName=O;else if(O==="/")h.state=u.CLOSE_TAG,h.tagName="";else if(O==="?")h.state=u.PROC_INST,h.procInstName=h.procInstBody="";else{if(q(h,"Unencoded <"),h.startTagPosition+1<h.position){var T=h.position-h.startTagPosition;O=new Array(T).join(" ")+O}h.textNode+="<"+O,h.state=u.TEXT}continue;case u.SGML_DECL:(h.sgmlDecl+O).toUpperCase()===g?(j(h,"onopencdata"),h.state=u.CDATA,h.sgmlDecl="",h.cdata=""):h.sgmlDecl+O==="--"?(h.state=u.COMMENT,h.comment="",h.sgmlDecl=""):(h.sgmlDecl+O).toUpperCase()===m?(h.state=u.DOCTYPE,(h.doctype||h.sawRoot)&&q(h,"Inappropriately located doctype declaration"),h.doctype="",h.sgmlDecl=""):O===">"?(j(h,"onsgmldeclaration",h.sgmlDecl),h.sgmlDecl="",h.state=u.TEXT):(b(O)&&(h.state=u.SGML_DECL_QUOTED),h.sgmlDecl+=O);continue;case u.SGML_DECL_QUOTED:O===h.q&&(h.state=u.SGML_DECL,h.q=""),h.sgmlDecl+=O;continue;case u.DOCTYPE:O===">"?(h.state=u.TEXT,j(h,"ondoctype",h.doctype),h.doctype=!0):(h.doctype+=O,O==="["?h.state=u.DOCTYPE_DTD:b(O)&&(h.state=u.DOCTYPE_QUOTED,h.q=O));continue;case u.DOCTYPE_QUOTED:h.doctype+=O,O===h.q&&(h.q="",h.state=u.DOCTYPE);continue;case u.DOCTYPE_DTD:h.doctype+=O,O==="]"?h.state=u.DOCTYPE:b(O)&&(h.state=u.DOCTYPE_DTD_QUOTED,h.q=O);continue;case u.DOCTYPE_DTD_QUOTED:h.doctype+=O,O===h.q&&(h.state=u.DOCTYPE_DTD,h.q="");continue;case u.COMMENT:O==="-"?h.state=u.COMMENT_ENDING:h.comment+=O;continue;case u.COMMENT_ENDING:O==="-"?(h.state=u.COMMENT_ENDED,h.comment=K(h.opt,h.comment),h.comment&&j(h,"oncomment",h.comment),h.comment=""):(h.comment+="-"+O,h.state=u.COMMENT);continue;case u.COMMENT_ENDED:O!==">"?(q(h,"Malformed comment"),h.comment+="--"+O,h.state=u.COMMENT):h.state=u.TEXT;continue;case u.CDATA:O==="]"?h.state=u.CDATA_ENDING:h.cdata+=O;continue;case u.CDATA_ENDING:O==="]"?h.state=u.CDATA_ENDING_2:(h.cdata+="]"+O,h.state=u.CDATA);continue;case u.CDATA_ENDING_2:O===">"?(h.cdata&&j(h,"oncdata",h.cdata),j(h,"onclosecdata"),h.cdata="",h.state=u.TEXT):O==="]"?h.cdata+="]":(h.cdata+="]]"+O,h.state=u.CDATA);continue;case u.PROC_INST:O==="?"?h.state=u.PROC_INST_ENDING:f(O)?h.state=u.PROC_INST_BODY:h.procInstName+=O;continue;case u.PROC_INST_BODY:if(!h.procInstBody&&f(O))continue;O==="?"?h.state=u.PROC_INST_ENDING:h.procInstBody+=O;continue;case u.PROC_INST_ENDING:O===">"?(j(h,"onprocessinginstruction",{name:h.procInstName,body:h.procInstBody}),h.procInstName=h.procInstBody="",h.state=u.TEXT):(h.procInstBody+="?"+O,h.state=u.PROC_INST_BODY);continue;case u.OPEN_TAG:L(S,O)?h.tagName+=O:(St(h),O===">"?st(h):O==="/"?h.state=u.OPEN_TAG_SLASH:(f(O)||q(h,"Invalid character in tag name"),h.state=u.ATTRIB));continue;case u.OPEN_TAG_SLASH:O===">"?(st(h,!0),pt(h)):(q(h,"Forward-slash in opening tag not followed by >"),h.state=u.ATTRIB);continue;case u.ATTRIB:if(f(O))continue;O===">"?st(h):O==="/"?h.state=u.OPEN_TAG_SLASH:L(C,O)?(h.attribName=O,h.attribValue="",h.state=u.ATTRIB_NAME):q(h,"Invalid attribute name");continue;case u.ATTRIB_NAME:O==="="?h.state=u.ATTRIB_VALUE:O===">"?(q(h,"Attribute without value"),h.attribValue=h.attribName,ht(h),st(h)):f(O)?h.state=u.ATTRIB_NAME_SAW_WHITE:L(S,O)?h.attribName+=O:q(h,"Invalid attribute name");continue;case u.ATTRIB_NAME_SAW_WHITE:if(O==="=")h.state=u.ATTRIB_VALUE;else{if(f(O))continue;q(h,"Attribute without value"),h.tag.attributes[h.attribName]="",h.attribValue="",j(h,"onattribute",{name:h.attribName,value:""}),h.attribName="",O===">"?st(h):L(C,O)?(h.attribName=O,h.state=u.ATTRIB_NAME):(q(h,"Invalid attribute name"),h.state=u.ATTRIB)}continue;case u.ATTRIB_VALUE:if(f(O))continue;b(O)?(h.q=O,h.state=u.ATTRIB_VALUE_QUOTED):(q(h,"Unquoted attribute value"),h.state=u.ATTRIB_VALUE_UNQUOTED,h.attribValue=O);continue;case u.ATTRIB_VALUE_QUOTED:if(O!==h.q){O==="&"?h.state=u.ATTRIB_VALUE_ENTITY_Q:h.attribValue+=O;continue}ht(h),h.q="",h.state=u.ATTRIB_VALUE_CLOSED;continue;case u.ATTRIB_VALUE_CLOSED:f(O)?h.state=u.ATTRIB:O===">"?st(h):O==="/"?h.state=u.OPEN_TAG_SLASH:L(C,O)?(q(h,"No whitespace between attributes"),h.attribName=O,h.attribValue="",h.state=u.ATTRIB_NAME):q(h,"Invalid attribute name");continue;case u.ATTRIB_VALUE_UNQUOTED:if(!x(O)){O==="&"?h.state=u.ATTRIB_VALUE_ENTITY_U:h.attribValue+=O;continue}ht(h),O===">"?st(h):h.state=u.ATTRIB;continue;case u.CLOSE_TAG:if(h.tagName)O===">"?pt(h):L(S,O)?h.tagName+=O:h.script?(h.script+="</"+h.tagName,h.tagName="",h.state=u.SCRIPT):(f(O)||q(h,"Invalid tagname in closing tag"),h.state=u.CLOSE_TAG_SAW_WHITE);else{if(f(O))continue;A(C,O)?h.script?(h.script+="</"+O,h.state=u.SCRIPT):q(h,"Invalid tagname in closing tag."):h.tagName=O}continue;case u.CLOSE_TAG_SAW_WHITE:if(f(O))continue;O===">"?pt(h):q(h,"Invalid characters in closing tag");continue;case u.TEXT_ENTITY:case u.ATTRIB_VALUE_ENTITY_Q:case u.ATTRIB_VALUE_ENTITY_U:var M,R;switch(h.state){case u.TEXT_ENTITY:M=u.TEXT,R="textNode";break;case u.ATTRIB_VALUE_ENTITY_Q:M=u.ATTRIB_VALUE_QUOTED,R="attribValue";break;case u.ATTRIB_VALUE_ENTITY_U:M=u.ATTRIB_VALUE_UNQUOTED,R="attribValue";break}if(O===";")if(h.opt.unparsedEntities){var Y=lt(h);h.entity="",h.state=M,h.write(Y)}else h[R]+=lt(h),h.entity="",h.state=M;else L(h.entity.length?d:v,O)?h.entity+=O:(q(h,"Invalid character in entity name"),h[R]+="&"+h.entity+O,h.entity="",h.state=M);continue;default:throw new Error(h,"Unknown state: "+h.state)}return h.position>=h.bufferCheckPosition&&l(h),h}String.fromCodePoint||function(){var p=String.fromCharCode,h=Math.floor,I=function(){var O=16384,_=[],T,M,R=-1,Y=arguments.length;if(!Y)return"";for(var W="";++R<Y;){var $=Number(arguments[R]);if(!isFinite($)||$<0||$>1114111||h($)!==$)throw RangeError("Invalid code point: "+$);$<=65535?_.push($):($-=65536,T=($>>10)+55296,M=$%1024+56320,_.push(T,M)),(R+1===Y||_.length>O)&&(W+=p.apply(null,_),_.length=0)}return W};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:I,configurable:!0,writable:!0}):String.fromCodePoint=I}()})(e)}(Nn)),Nn}var Gn={},Kn;function Sa(){return Kn||(Kn=1,(function(){Gn.stripBOM=function(e){return e[0]==="\uFEFF"?e.substring(1):e}}).call(U)),Gn}var Ot={},Yn;function Ii(){return Yn||(Yn=1,(function(){var e;e=new RegExp(/(?!xmlns)^.*:/),Ot.normalize=function(r){return r.toLowerCase()},Ot.firstCharLowerCase=function(r){return r.charAt(0).toLowerCase()+r.slice(1)},Ot.stripPrefix=function(r){return r.replace(e,"")},Ot.parseNumbers=function(r){return isNaN(r)||(r=r%1===0?parseInt(r,10):parseFloat(r)),r},Ot.parseBooleans=function(r){return/^(?:true|false)$/i.test(r)&&(r=r.toLowerCase()==="true"),r}}).call(U)),Ot}var it={},Na={},Qn;function Ea(){return Qn||(Qn=1,function(e,r){if(e.setImmediate)return;var n=1,o={},l=!1,i=e.document,s;function a(v){typeof v!="function"&&(v=new Function(""+v));for(var d=new Array(arguments.length-1),f=0;f<d.length;f++)d[f]=arguments[f+1];var b={callback:v,args:d};return o[n]=b,s(n),n++}function c(v){delete o[v]}function w(v){var d=v.callback,f=v.args;switch(f.length){case 0:d();break;case 1:d(f[0]);break;case 2:d(f[0],f[1]);break;case 3:d(f[0],f[1],f[2]);break;default:d.apply(r,f);break}}function y(v){if(l)setTimeout(y,0,v);else{var d=o[v];if(d){l=!0;try{w(d)}finally{c(v),l=!1}}}}function g(){s=function(v){Q.nextTick(function(){y(v)})}}function m(){if(e.postMessage&&!e.importScripts){var v=!0,d=e.onmessage;return e.onmessage=function(){v=!1},e.postMessage("","*"),e.onmessage=d,v}}function E(){var v="setImmediate$"+Math.random()+"$",d=function(f){f.source===e&&typeof f.data=="string"&&f.data.indexOf(v)===0&&y(+f.data.slice(v.length))};e.addEventListener?e.addEventListener("message",d,!1):e.attachEvent("onmessage",d),s=function(f){e.postMessage(v+f,"*")}}function N(){var v=new MessageChannel;v.port1.onmessage=function(d){var f=d.data;y(f)},s=function(d){v.port2.postMessage(d)}}function D(){var v=i.documentElement;s=function(d){var f=i.createElement("script");f.onreadystatechange=function(){y(d),f.onreadystatechange=null,v.removeChild(f),f=null},v.appendChild(f)}}function C(){s=function(v){setTimeout(y,0,v)}}var S=Object.getPrototypeOf&&Object.getPrototypeOf(e);S=S&&S.setTimeout?S:e,{}.toString.call(e.process)==="[object process]"?g():m()?E():e.MessageChannel?N():i&&"onreadystatechange"in i.createElement("script")?D():C(),S.setImmediate=a,S.clearImmediate=c}(typeof self>"u"?typeof U>"u"?U:U:self)),Na}var Xn;function Da(){if(Xn)return it;Xn=1;var e=typeof U<"u"&&U||typeof self<"u"&&self||window,r=Function.prototype.apply;it.setTimeout=function(){return new n(r.call(setTimeout,e,arguments),clearTimeout)},it.setInterval=function(){return new n(r.call(setInterval,e,arguments),clearInterval)},it.clearTimeout=it.clearInterval=function(o){o&&o.close()};function n(o,l){this._id=o,this._clearFn=l}return n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(e,this._id)},it.enroll=function(o,l){clearTimeout(o._idleTimeoutId),o._idleTimeout=l},it.unenroll=function(o){clearTimeout(o._idleTimeoutId),o._idleTimeout=-1},it._unrefActive=it.active=function(o){clearTimeout(o._idleTimeoutId);var l=o._idleTimeout;l>=0&&(o._idleTimeoutId=setTimeout(function(){o._onTimeout&&o._onTimeout()},l))},Ea(),it.setImmediate=typeof self<"u"&&self.setImmediate||typeof U<"u"&&U.setImmediate||U&&U.setImmediate,it.clearImmediate=typeof self<"u"&&self.clearImmediate||typeof U<"u"&&U.clearImmediate||U&&U.clearImmediate,it}var Zn;function Ca(){return Zn||(Zn=1,function(e){(function(){var r,n,o,l,i,s,a,c,w,y=function(E,N){return function(){return E.apply(N,arguments)}},g=function(E,N){for(var D in N)m.call(N,D)&&(E[D]=N[D]);function C(){this.constructor=E}return C.prototype=N.prototype,E.prototype=new C,E.__super__=N.prototype,E},m={}.hasOwnProperty;c=Ta(),l=Zt(),r=Sa(),a=Ii(),w=Da().setImmediate,n=Ae().defaults,i=function(E){return typeof E=="object"&&E!=null&&Object.keys(E).length===0},s=function(E,N,D){var C,S,v;for(C=0,S=E.length;C<S;C++)v=E[C],N=v(N,D);return N},o=function(E,N,D){var C;return C=Object.create(null),C.value=D,C.writable=!0,C.enumerable=!0,C.configurable=!0,Object.defineProperty(E,N,C)},e.Parser=function(E){g(N,E);function N(D){this.parseStringPromise=y(this.parseStringPromise,this),this.parseString=y(this.parseString,this),this.reset=y(this.reset,this),this.assignOrPush=y(this.assignOrPush,this),this.processAsync=y(this.processAsync,this);var C,S,v;if(!(this instanceof e.Parser))return new e.Parser(D);this.options={},S=n["0.2"];for(C in S)m.call(S,C)&&(v=S[C],this.options[C]=v);for(C in D)m.call(D,C)&&(v=D[C],this.options[C]=v);this.options.xmlns&&(this.options.xmlnskey=this.options.attrkey+"ns"),this.options.normalizeTags&&(this.options.tagNameProcessors||(this.options.tagNameProcessors=[]),this.options.tagNameProcessors.unshift(a.normalize)),this.reset()}return N.prototype.processAsync=function(){var D,C;try{return this.remaining.length<=this.options.chunkSize?(D=this.remaining,this.remaining="",this.saxParser=this.saxParser.write(D),this.saxParser.close()):(D=this.remaining.substr(0,this.options.chunkSize),this.remaining=this.remaining.substr(this.options.chunkSize,this.remaining.length),this.saxParser=this.saxParser.write(D),w(this.processAsync))}catch(S){if(C=S,!this.saxParser.errThrown)return this.saxParser.errThrown=!0,this.emit(C)}},N.prototype.assignOrPush=function(D,C,S){return C in D?(D[C]instanceof Array||o(D,C,[D[C]]),D[C].push(S)):this.options.explicitArray?o(D,C,[S]):o(D,C,S)},N.prototype.reset=function(){var D,C,S,v;return this.removeAllListeners(),this.saxParser=c.parser(this.options.strict,{trim:!1,normalize:!1,xmlns:this.options.xmlns}),this.saxParser.errThrown=!1,this.saxParser.onerror=function(d){return function(f){if(d.saxParser.resume(),!d.saxParser.errThrown)return d.saxParser.errThrown=!0,d.emit("error",f)}}(this),this.saxParser.onend=function(d){return function(){if(!d.saxParser.ended)return d.saxParser.ended=!0,d.emit("end",d.resultObject)}}(this),this.saxParser.ended=!1,this.EXPLICIT_CHARKEY=this.options.explicitCharkey,this.resultObject=null,v=[],D=this.options.attrkey,C=this.options.charkey,this.saxParser.onopentag=function(d){return function(f){var b,x,L,A,u;if(L={},L[C]="",!d.options.ignoreAttrs){u=f.attributes;for(b in u)m.call(u,b)&&(!(D in L)&&!d.options.mergeAttrs&&(L[D]={}),x=d.options.attrValueProcessors?s(d.options.attrValueProcessors,f.attributes[b],b):f.attributes[b],A=d.options.attrNameProcessors?s(d.options.attrNameProcessors,b):b,d.options.mergeAttrs?d.assignOrPush(L,A,x):o(L[D],A,x))}return L["#name"]=d.options.tagNameProcessors?s(d.options.tagNameProcessors,f.name):f.name,d.options.xmlns&&(L[d.options.xmlnskey]={uri:f.uri,local:f.local}),v.push(L)}}(this),this.saxParser.onclosetag=function(d){return function(){var f,b,x,L,A,u,F,k,j,z;if(u=v.pop(),A=u["#name"],(!d.options.explicitChildren||!d.options.preserveChildrenOrder)&&delete u["#name"],u.cdata===!0&&(f=u.cdata,delete u.cdata),j=v[v.length-1],u[C].match(/^\s*$/)&&!f?(b=u[C],delete u[C]):(d.options.trim&&(u[C]=u[C].trim()),d.options.normalize&&(u[C]=u[C].replace(/\s{2,}/g," ").trim()),u[C]=d.options.valueProcessors?s(d.options.valueProcessors,u[C],A):u[C],Object.keys(u).length===1&&C in u&&!d.EXPLICIT_CHARKEY&&(u=u[C])),i(u)&&(typeof d.options.emptyTag=="function"?u=d.options.emptyTag():u=d.options.emptyTag!==""?d.options.emptyTag:b),d.options.validator!=null&&(z="/"+function(){var K,Z,G;for(G=[],K=0,Z=v.length;K<Z;K++)L=v[K],G.push(L["#name"]);return G}().concat(A).join("/"),function(){var K;try{return u=d.options.validator(z,j&&j[A],u)}catch(Z){return K=Z,d.emit("error",K)}}()),d.options.explicitChildren&&!d.options.mergeAttrs&&typeof u=="object"){if(!d.options.preserveChildrenOrder)L={},d.options.attrkey in u&&(L[d.options.attrkey]=u[d.options.attrkey],delete u[d.options.attrkey]),!d.options.charsAsChildren&&d.options.charkey in u&&(L[d.options.charkey]=u[d.options.charkey],delete u[d.options.charkey]),Object.getOwnPropertyNames(u).length>0&&(L[d.options.childkey]=u),u=L;else if(j){j[d.options.childkey]=j[d.options.childkey]||[],F={};for(x in u)m.call(u,x)&&o(F,x,u[x]);j[d.options.childkey].push(F),delete u["#name"],Object.keys(u).length===1&&C in u&&!d.EXPLICIT_CHARKEY&&(u=u[C])}}return v.length>0?d.assignOrPush(j,A,u):(d.options.explicitRoot&&(k=u,u={},o(u,A,k)),d.resultObject=u,d.saxParser.ended=!0,d.emit("end",d.resultObject))}}(this),S=function(d){return function(f){var b,x;if(x=v[v.length-1],x)return x[C]+=f,d.options.explicitChildren&&d.options.preserveChildrenOrder&&d.options.charsAsChildren&&(d.options.includeWhiteChars||f.replace(/\\n/g,"").trim()!=="")&&(x[d.options.childkey]=x[d.options.childkey]||[],b={"#name":"__text__"},b[C]=f,d.options.normalize&&(b[C]=b[C].replace(/\s{2,}/g," ").trim()),x[d.options.childkey].push(b)),x}}(this),this.saxParser.ontext=S,this.saxParser.oncdata=function(d){return function(f){var b;if(b=S(f),b)return b.cdata=!0}}()},N.prototype.parseString=function(D,C){var S;C!=null&&typeof C=="function"&&(this.on("end",function(v){return this.reset(),C(null,v)}),this.on("error",function(v){return this.reset(),C(v)}));try{return D=D.toString(),D.trim()===""?(this.emit("end",null),!0):(D=r.stripBOM(D),this.options.async?(this.remaining=D,w(this.processAsync),this.saxParser):this.saxParser.write(D).close())}catch(v){if(S=v,this.saxParser.errThrown||this.saxParser.ended){if(this.saxParser.ended)throw S}else return this.emit("error",S),this.saxParser.errThrown=!0}},N.prototype.parseStringPromise=function(D){return new Promise(function(C){return function(S,v){return C.parseString(D,function(d,f){return d?v(d):S(f)})}}(this))},N}(l),e.parseString=function(E,N,D){var C,S,v;return D!=null?(typeof D=="function"&&(C=D),typeof N=="object"&&(S=N)):(typeof N=="function"&&(C=N),S={}),v=new e.Parser(S),v.parseString(E,C)},e.parseStringPromise=function(E,N){var D,C;return typeof N=="object"&&(D=N),C=new e.Parser(D),C.parseStringPromise(E)}}).call(U)}(Sn)),Sn}var Pi;(function(){var e,r,n,o=function(i,s){for(var a in s)l.call(s,a)&&(i[a]=s[a]);function c(){this.constructor=i}return c.prototype=s.prototype,i.prototype=new c,i.__super__=s.prototype,i},l={}.hasOwnProperty;r=Ae(),e=pa(),n=Ca(),Ii(),r.defaults,function(i){o(s,i);function s(a){this.message=a}return s}(Error),e.Builder,Pi=n.Parser,n.parseString,n.parseStringPromise}).call(U);const gt=function(...e){const r=ct("files",{state:()=>({files:{},roots:{}}),getters:{getNode:n=>o=>n.files[o],getNodes:n=>o=>o.map(l=>n.files[l]).filter(Boolean),getRoot:n=>o=>n.roots[o]},actions:{updateNodes(n){const o=n.reduce((l,i)=>i.fileid?(l[i.fileid]=i,l):(V.error("Trying to update/set a node without fileid",i),l),{});H.set(this,"files",{...this.files,...o})},deleteNodes(n){n.forEach(o=>{o.fileid&&H.delete(this.files,o.fileid)})},setRoot({service:n,root:o}){H.set(this.roots,n,o)},onDeletedNode(n){this.deleteNodes([n])},onCreatedNode(n){this.updateNodes([n])},onUpdatedNode(n){this.updateNodes([n])}}})(...e);return r._initialized||(nt("files:node:created",r.onCreatedNode),nt("files:node:deleted",r.onDeletedNode),nt("files:node:updated",r.onUpdatedNode),r._initialized=!0),r},He=function(...e){const r=gt(),n=ct("paths",{state:()=>({paths:{}}),getters:{getPath:o=>(l,i)=>{if(o.paths[l])return o.paths[l][i]}},actions:{addPath(o){this.paths[o.service]||H.set(this.paths,o.service,{}),H.set(this.paths[o.service],o.path,o.fileid)},onCreatedNode(o){var l,i;const s=((i=(l=ii())==null?void 0:l.active)==null?void 0:i.id)||"files";if(!o.fileid){V.error("Node has no fileid",{node:o});return}if(o.type===ut.Folder&&this.addPath({service:s,path:o.path,fileid:o.fileid}),o.dirname==="/"){const a=r.getRoot(s);a._children||H.set(a,"_children",[]),a._children.push(o.fileid);return}if(this.paths[s][o.dirname]){const a=this.paths[s][o.dirname],c=r.getNode(a);if(V.debug("Path already exists, updating children",{parentFolder:c,node:o}),!c){V.error("Parent folder not found",{parentId:a});return}c._children||H.set(c,"_children",[]),c._children.push(o.fileid);return}V.debug("Parent path does not exists, skipping children update",{node:o})}}})(...e);return n._initialized||(nt("files:node:created",n.onCreatedNode),n._initialized=!0),n},yt=ct("selection",{state:()=>({selected:[],lastSelection:[],lastSelectedIndex:null}),actions:{set(e=[]){H.set(this,"selected",[...new Set(e)])},setLastIndex(e=null){H.set(this,"lastSelection",e?this.selected:[]),H.set(this,"lastSelectedIndex",e)},reset(){H.set(this,"selected",[]),H.set(this,"lastSelection",[]),H.set(this,"lastSelectedIndex",null)}}});let Jn;const Fi=function(...e){return Jn=ui(),ct("uploader",{state:()=>({queue:Jn.queue})})(...e)};var xa=Object.defineProperty,Oa=(e,r,n)=>r in e?xa(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,Aa=(e,r,n)=>(Oa(e,r+"",n),n);class Ge extends File{constructor(r,n=[]){super([],r,{type:"httpd/unix-directory"}),Aa(this,"_contents"),this._contents=n}set contents(r){this._contents=r}get contents(){return this._contents}get size(){return this._computeDirectorySize(this)}get lastModified(){return this._contents.length===0?Date.now():this._computeDirectoryMtime(this)}_computeDirectoryMtime(r){return r.contents.reduce((n,o)=>o.lastModified>n?o.lastModified:n,0)}_computeDirectorySize(r){return r.contents.reduce((n,o)=>n+o.size,0)}}const Li=async e=>{if(e.isFile)return new Promise((l,i)=>{e.file(l,i)});V.debug("Handling recursive file tree",{entry:e.name});const r=e,n=await Ia(r),o=(await Promise.all(n.map(Li))).flat();return new Ge(r.name,o)},Ia=e=>{const r=e.createReader();return new Promise((n,o)=>{const l=[],i=()=>{r.readEntries(s=>{s.length?(l.push(...s),i()):n(l)},s=>{o(s)})};i()})},Pa=async e=>{const r=Gi();if(!await r.exists(e)){V.debug("Directory does not exist, creating it",{absolutePath:e}),await r.createDirectory(e,{recursive:!0});const n=await r.stat(e,{details:!0,data:Ki()});At("files:node:created",Yi(n.data))}},ki=async(e,r,n)=>{try{const o=e.filter(a=>n.find(c=>c.basename===(a instanceof File?a.name:a.basename))).filter(Boolean),l=e.filter(a=>!o.includes(a)),{selected:i,renamed:s}=await No(r.path,o,n);return V.debug("Conflict resolution",{uploads:l,selected:i,renamed:s}),i.length===0&&s.length===0?(xe(B("files","Conflicts resolution skipped")),V.info("User skipped the conflict resolution"),[]):[...l,...i,...s]}catch(o){console.error(o),X(B("files","Upload cancelled")),V.error("User cancelled the upload")}return[]},Ke=async e=>{const r=e.filter(l=>l.kind!=="file"?(V.debug("Skipping dropped item",{kind:l.kind,type:l.type}),!1):!0).map(l=>{var i,s,a,c;return(c=(a=(i=l==null?void 0:l.getAsEntry)==null?void 0:i.call(l))!=null?a:(s=l==null?void 0:l.webkitGetAsEntry)==null?void 0:s.call(l))!=null?c:l});let n=!1;const o=new Ge("root");for(const l of r){if(l instanceof DataTransferItem){V.warn("Could not get FilesystemEntry of item, falling back to file");const i=l.getAsFile();if(i===null){V.warn("Could not process DataTransferItem",{type:l.type,kind:l.kind}),X(B("files","One of the dropped files could not be processed"));continue}if(i.type==="httpd/unix-directory"||!i.type){n||(V.warn("Browser does not support Filesystem API. Directories will not be uploaded"),Go(B("files","Your browser does not support the Filesystem API. Directories will not be uploaded")),n=!0);continue}o.contents.push(i);continue}try{o.contents.push(await Li(l))}catch(i){V.error("Error while traversing file tree",{error:i})}}return o},Ye=async(e,r,n)=>{const o=ui();if(await ci(e.contents,n)&&(e.contents=await ki(e.contents,r,n)),e.contents.length===0)return V.info("No files to upload",{root:e}),xe(B("files","No files to upload")),[];V.debug("Uploading files to ".concat(r.path),{root:e,contents:e.contents});const l=[],i=async(a,c)=>{for(const w of a.contents){const y=It.join(c,w.name);if(w instanceof Ge){const g=Ko(Qi,r.path,y);try{console.debug("Processing directory",{relativePath:y}),await Pa(g),await i(w,y)}catch(m){X(B("files","Unable to create the directory {directory}",{directory:w.name})),V.error("",{error:m,absolutePath:g,directory:w})}continue}V.debug("Uploading file to "+It.join(r.path,y),{file:w}),l.push(o.upload(y,w,r.source))}};o.pause(),await i(e,"/"),o.start();const s=(await Promise.allSettled(l)).filter(a=>a.status==="rejected");return s.length>0?(V.error("Error while uploading files",{errors:s}),X(B("files","Some files could not be uploaded")),[]):(V.debug("Files uploaded successfully"),Mt(B("files","Files uploaded successfully")),Promise.all(l))},Mi=async(e,r,n,o=!1)=>{const l=[];if(await ci(e,n)&&(e=await ki(e,r,n)),e.length===0){V.info("No files to process",{nodes:e}),xe(B("files","No files to process"));return}for(const a of e)H.set(a,"status",_t.LOADING),l.push(Eo(a,r,o?tr.COPY:tr.MOVE));const i=await Promise.allSettled(l);e.forEach(a=>H.set(a,"status",void 0));const s=i.filter(a=>a.status==="rejected");if(s.length>0){V.error("Error while copying or moving files",{errors:s}),X(o?B("files","Some files could not be copied"):B("files","Some files could not be moved"));return}V.debug("Files copy/move successful"),Mt(o?B("files","Files copied successfully"):B("files","Files moved successfully"))},Qe=ct("dragging",{state:()=>({dragging:[]}),actions:{set(e=[]){H.set(this,"dragging",e)},reset(){H.set(this,"dragging",[])}}}),Wt=H.extend({data(){return{filesListWidth:null}},mounted(){var e;const r=document.querySelector("#app-content-vue");this.filesListWidth=(e=r==null?void 0:r.clientWidth)!=null?e:null,this.$resizeObserver=new ResizeObserver(n=>{n.length>0&&n[0].target===r&&(this.filesListWidth=n[0].contentRect.width)}),this.$resizeObserver.observe(r)},beforeDestroy(){this.$resizeObserver.disconnect()}}),Fa=et({name:"BreadCrumbs",components:{NcBreadcrumbs:ho,NcBreadcrumb:po,NcIconSvgWrapper:kt},mixins:[Wt],props:{path:{type:String,default:"/"}},setup(){const e=Qe(),r=gt(),n=He(),o=yt(),l=Fi();return{draggingStore:e,filesStore:r,pathsStore:n,selectionStore:o,uploaderStore:l}},computed:{currentView(){return this.$navigation.active},dirs(){const e=r=>n=>r+="".concat(n,"/");return["/",...this.path.split("/").filter(Boolean).map(e("/")).map(r=>r.replace(/^(.+)\/$/,"$1"))]},sections(){return this.dirs.map((e,r)=>{const n=this.getFileIdFromPath(e),o={...this.$route,params:{fileid:n},query:{dir:e}};return{dir:e,exact:!0,name:this.getDirDisplayName(e),to:o,disableDrop:r===this.dirs.length-1}})},isUploadInProgress(){return this.uploaderStore.queue.length!==0},wrapUploadProgressBar(){return this.isUploadInProgress&&this.filesListWidth<512},viewIcon(){var e,r;return(r=(e=this.currentView)==null?void 0:e.icon)!=null?r:Lo},selectedFiles(){return this.selectionStore.selected},draggingFiles(){return this.draggingStore.dragging}},methods:{getNodeFromId(e){return this.filesStore.getNode(e)},getFileIdFromPath(e){var r;return this.pathsStore.getPath((r=this.currentView)==null?void 0:r.id,e)},getDirDisplayName(e){var r,n,o;if(e==="/")return((n=(r=this.$navigation)==null?void 0:r.active)==null?void 0:n.name)||B("files","Home");const l=this.getFileIdFromPath(e),i=l?this.getNodeFromId(l):void 0;return((o=i==null?void 0:i.attributes)==null?void 0:o.displayName)||It.basename(e)},onClick(e){var r;((r=e==null?void 0:e.query)==null?void 0:r.dir)===this.$route.query.dir&&this.$emit("reload")},onDragOver(e,r){if(r===this.dirs[this.dirs.length-1]){e.dataTransfer.dropEffect="none";return}e.ctrlKey?e.dataTransfer.dropEffect="copy":e.dataTransfer.dropEffect="move"},async onDrop(e,r){var n,o,l,i;if(!this.draggingFiles&&!((o=(n=e.dataTransfer)==null?void 0:n.items)!=null&&o.length))return;e.preventDefault();const s=this.draggingFiles,a=[...((l=e.dataTransfer)==null?void 0:l.items)||[]],c=await Ke(a),w=await((i=this.currentView)==null?void 0:i.getContents(r)),y=w==null?void 0:w.folder;if(!y){X(this.t("files","Target folder does not exist any more"));return}const g=(y.permissions&Tt.CREATE)!==0,m=e.ctrlKey;if(!g||e.button!==0)return;if(V.debug("Dropped",{event:e,folder:y,selection:s,fileTree:c}),c.contents.length>0){await Ye(c,y,w.contents);return}const E=s.map(N=>this.filesStore.getNode(N));await Mi(E,y,w.contents,m),s.some(N=>this.selectedFiles.includes(N))&&(V.debug("Dropped selection, resetting select store..."),this.selectionStore.reset())},titleForSection(e,r){var n,o;return((o=(n=r==null?void 0:r.to)==null?void 0:n.query)==null?void 0:o.dir)===this.$route.query.dir?B("files","Reload current directory"):e===0?B("files",'Go to the "{dir}" directory',r):null},ariaForSection(e){var r,n;return((n=(r=e==null?void 0:e.to)==null?void 0:r.query)==null?void 0:n.dir)===this.$route.query.dir?B("files","Reload current directory"):null},t:B}});var La=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("NcBreadcrumbs",{staticClass:"files-list__breadcrumbs",class:{"files-list__breadcrumbs--with-progress":e.wrapUploadProgressBar},attrs:{"data-cy-files-content-breadcrumbs":"","aria-label":e.t("files","Current directory path")},scopedSlots:e._u([{key:"actions",fn:function(){return[e._t("actions")]},proxy:!0}],null,!0)},e._l(e.sections,function(n,o){return r("NcBreadcrumb",e._b({key:n.dir,attrs:{dir:"auto",to:n.to,"force-icon-text":o===0&&e.filesListWidth>=486,title:e.titleForSection(o,n),"aria-description":e.ariaForSection(n)},on:{drop:function(l){return e.onDrop(l,n.dir)}},nativeOn:{click:function(l){return e.onClick(n.to)},dragover:function(l){return e.onDragOver(l,n.dir)}},scopedSlots:e._u([o===0?{key:"icon",fn:function(){return[r("NcIconSvgWrapper",{attrs:{size:20,svg:e.viewIcon}})]},proxy:!0}:null],null,!0)},"NcBreadcrumb",n,!1))}),1)},ka=[],Ma=J(Fa,La,ka,!1,null,"72897581");const Ra=Ma.exports,Xe=ct("actionsmenu",{state:()=>({opened:null})}),Ze=function(...e){const r=ct("renaming",{state:()=>({renamingNode:void 0,newName:""})})(...e);return r._initialized||(nt("files:node:rename",function(n){r.renamingNode=n,r.newName=n.basename}),r._initialized=!0),r},ja=H.extend({name:"DragAndDropPreview",components:{FileMultipleIcon:ko,FolderIcon:hi},data(){return{nodes:[]}},computed:{isSingleNode(){return this.nodes.length===1},isSingleFolder(){return this.isSingleNode&&this.nodes[0].type===ut.Folder},name(){return this.size?"".concat(this.summary," – ").concat(this.size):this.summary},size(){const e=this.nodes.reduce((n,o)=>n+o.size||0,0),r=parseInt(e,10)||0;return typeof r!="number"||r<0?null:bt(r,!0)},summary(){var e;if(this.isSingleNode){const r=this.nodes[0];return((e=r.attributes)==null?void 0:e.displayName)||r.basename}return di(this.nodes)}},methods:{update(e){this.nodes=e,this.$refs.previewImg.replaceChildren(),e.slice(0,3).forEach(r=>{const n=document.querySelector('[data-cy-files-list-row-fileid="'.concat(r.fileid,'"] .files-list__row-icon img'));n&&this.$refs.previewImg.appendChild(n.parentNode.cloneNode(!0))}),this.$nextTick(()=>{this.$emit("loaded",this.$el)})}}});var Va=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("div",{staticClass:"files-list-drag-image"},[r("span",{staticClass:"files-list-drag-image__icon"},[r("span",{ref:"previewImg"}),e.isSingleFolder?r("FolderIcon"):r("FileMultipleIcon")],1),r("span",{staticClass:"files-list-drag-image__name"},[e._v(e._s(e.name))])])},Ba=[],Ua=J(ja,Va,Ba,!1,null,null);const qa=Ua.exports,$a=H.extend(qa);let vt;const za=async e=>new Promise(r=>{vt||(vt=new $a().$mount(),document.body.appendChild(vt.$el)),vt.update(e),vt.$on("loaded",()=>{r(vt.$el),vt.$off("loaded")})});H.directive("onClickOutside",fo);const Ri=et({props:{source:{type:[Ne,Xi,Zi],required:!0},nodes:{type:Array,required:!0},filesListWidth:{type:Number,default:0}},data(){return{loading:"",dragover:!1,gridMode:!1}},computed:{currentView(){return this.$navigation.active},currentDir(){var e,r,n;return(((n=(r=(e=this.$route)==null?void 0:e.query)==null?void 0:r.dir)==null?void 0:n.toString())||"/").replace(/^(.+)\/$/,"$1")},currentFileId(){var e,r;return((e=this.$route.params)==null?void 0:e.fileid)||((r=this.$route.query)==null?void 0:r.fileid)||null},fileid(){var e;return(e=this.source)==null?void 0:e.fileid},uniqueId(){return Qo(this.source.source)},isLoading(){return this.source.status===_t.LOADING},extension(){var e;return(e=this.source.attributes)!=null&&e.displayName?It.extname(this.source.attributes.displayName):this.source.extension||""},displayName(){const e=this.extension,r=String(this.source.attributes.displayName||this.source.basename);return e?r.slice(0,0-e.length):r},draggingFiles(){return this.draggingStore.dragging},selectedFiles(){return this.selectionStore.selected},isSelected(){return this.fileid&&this.selectedFiles.includes(this.fileid)},isRenaming(){return this.renamingStore.renamingNode===this.source},isRenamingSmallScreen(){return this.isRenaming&&this.filesListWidth<512},isActive(){var e,r,n,o;return((r=(e=this.fileid)==null?void 0:e.toString)==null?void 0:r.call(e))===((o=(n=this.currentFileId)==null?void 0:n.toString)==null?void 0:o.call(n))},canDrag(){if(this.isRenaming)return!1;const e=r=>((r==null?void 0:r.permissions)&Tt.UPDATE)!==0;return this.selectedFiles.length>0?this.selectedFiles.map(r=>this.filesStore.getNode(r)).every(e):e(this.source)},canDrop(){return this.source.type!==ut.Folder||this.fileid&&this.draggingFiles.includes(this.fileid)?!1:(this.source.permissions&Tt.CREATE)!==0},openedMenu:{get(){return this.actionsMenuStore.opened===this.uniqueId.toString()},set(e){var r;if(e){const n=(r=this.$el)==null?void 0:r.closest("main.app-content");n.style.removeProperty("--mouse-pos-x"),n.style.removeProperty("--mouse-pos-y")}this.actionsMenuStore.opened=e?this.uniqueId.toString():null}}},watch:{source(e,r){e.source!==r.source&&this.resetState()}},beforeDestroy(){this.resetState()},methods:{resetState(){var e,r,n;this.loading="",(n=(r=(e=this.$refs)==null?void 0:e.preview)==null?void 0:r.reset)==null||n.call(r),this.openedMenu=!1},onRightClick(e){var r;if(this.openedMenu)return;if(!this.gridMode){const o=(r=this.$el)==null?void 0:r.closest("main.app-content"),l=o.getBoundingClientRect();o.style.setProperty("--mouse-pos-x",Math.max(0,e.clientX-l.left-200)+"px"),o.style.setProperty("--mouse-pos-y",Math.max(0,e.clientY-l.top)+"px")}const n=this.selectedFiles.length>1;this.actionsMenuStore.opened=this.isSelected&&n?"global":this.uniqueId.toString(),e.preventDefault(),e.stopPropagation()},execDefaultAction(e){if(e.ctrlKey||e.metaKey)return e.preventDefault(),window.open(Ft("/f/{fileId}",{fileId:this.fileid})),!1;this.$refs.actions.execDefaultAction(e)},openDetailsIfAvailable(e){var r,n;e.preventDefault(),e.stopPropagation(),(n=(r=zt)==null?void 0:r.enabled)!=null&&n.call(r,[this.source],this.currentView)&&zt.exec(this.source,this.currentView,this.currentDir)},onDragOver(e){if(this.dragover=this.canDrop,!this.canDrop){e.dataTransfer.dropEffect="none";return}e.ctrlKey?e.dataTransfer.dropEffect="copy":e.dataTransfer.dropEffect="move"},onDragLeave(e){const r=e.currentTarget;r!=null&&r.contains(e.relatedTarget)||(this.dragover=!1)},async onDragStart(e){var r,n,o;if(e.stopPropagation(),!this.canDrag||!this.fileid){e.preventDefault(),e.stopPropagation();return}V.debug("Drag started",{event:e}),(n=(r=e.dataTransfer)==null?void 0:r.clearData)==null||n.call(r),this.renamingStore.$reset(),this.selectedFiles.includes(this.fileid)?this.draggingStore.set(this.selectedFiles):this.draggingStore.set([this.fileid]);const l=this.draggingStore.dragging.map(s=>this.filesStore.getNode(s)),i=await za(l);(o=e.dataTransfer)==null||o.setDragImage(i,-10,-10)},onDragEnd(){this.draggingStore.reset(),this.dragover=!1,V.debug("Drag ended")},async onDrop(e){var r,n,o,l;if(!this.draggingFiles&&!((n=(r=e.dataTransfer)==null?void 0:r.items)!=null&&n.length))return;e.preventDefault(),e.stopPropagation();const i=this.draggingFiles,s=[...((o=e.dataTransfer)==null?void 0:o.items)||[]],a=await Ke(s),c=await((l=this.currentView)==null?void 0:l.getContents(this.source.path)),w=c==null?void 0:c.folder;if(!w){X(this.t("files","Target folder does not exist any more"));return}if(!this.canDrop||e.button)return;const y=e.ctrlKey;if(this.dragover=!1,V.debug("Dropped",{event:e,folder:w,selection:i,fileTree:a}),a.contents.length>0){await Ye(a,w,c.contents);return}const g=i.map(m=>this.filesStore.getNode(m));await Mi(g,w,c.contents,y),i.some(m=>this.selectedFiles.includes(m))&&(V.debug("Dropped selection, resetting select store..."),this.selectionStore.reset())},t:B}}),Wa={name:"CustomElementRender",props:{source:{type:Object,required:!0},currentView:{type:Object,required:!0},render:{type:Function,required:!0}},watch:{source(){this.updateRootElement()},currentView(){this.updateRootElement()}},mounted(){this.updateRootElement()},methods:{async updateRootElement(){const e=await this.render(this.source,this.currentView);e?this.$el.replaceChildren(e):this.$el.replaceChildren()}}};var Ha=function(){var e=this,r=e._self._c;return r("span")},Ga=[],Ka=J(Wa,Ha,Ga,!1,null,null);const ji=Ka.exports,Ya=Ee(),Qa=et({name:"FileEntryActions",components:{ArrowLeftIcon:Mo,CustomElementRender:ji,NcActionButton:si,NcActions:ai,NcActionSeparator:mo,NcIconSvgWrapper:kt,NcLoadingIcon:Gt},props:{filesListWidth:{type:Number,required:!0},loading:{type:String,required:!0},opened:{type:Boolean,default:!1},source:{type:Object,required:!0},gridMode:{type:Boolean,default:!1}},data(){return{openedSubmenu:null}},computed:{currentDir(){var e,r,n;return(((n=(r=(e=this.$route)==null?void 0:e.query)==null?void 0:r.dir)==null?void 0:n.toString())||"/").replace(/^(.+)\/$/,"$1")},currentView(){return this.$navigation.active},isLoading(){return this.source.status===_t.LOADING},enabledActions(){return this.source.attributes.failed?[]:Ya.filter(e=>!e.enabled||e.enabled([this.source],this.currentView)).sort((e,r)=>(e.order||0)-(r.order||0))},enabledInlineActions(){return this.filesListWidth<768||this.gridMode?[]:this.enabledActions.filter(e=>{var r;return(r=e==null?void 0:e.inline)==null?void 0:r.call(e,this.source,this.currentView)})},enabledRenderActions(){return this.gridMode?[]:this.enabledActions.filter(e=>typeof e.renderInline=="function")},enabledDefaultActions(){return this.enabledActions.filter(e=>!!(e!=null&&e.default))},enabledMenuActions(){if(this.openedSubmenu)return this.enabledInlineActions;const e=[...this.enabledInlineActions,...this.enabledActions.filter(n=>n.default!==Ji.HIDDEN&&typeof n.renderInline!="function")].filter((n,o,l)=>o===l.findIndex(i=>i.id===n.id)),r=e.filter(n=>!n.parent).map(n=>n.id);return e.filter(n=>!(n.parent&&r.includes(n.parent)))},enabledSubmenuActions(){return this.enabledActions.filter(e=>e.parent).reduce((e,r)=>(e[r.parent]||(e[r.parent]=[]),e[r.parent].push(r),e),{})},openedMenu:{get(){return this.opened},set(e){this.$emit("update:opened",e)}},getBoundariesElement(){return document.querySelector(".app-content > .files-list")},mountType(){return this.source._attributes["mount-type"]}},methods:{actionDisplayName(e){if((this.gridMode||this.filesListWidth<768&&e.inline)&&typeof e.title=="function"){const r=e.title([this.source],this.currentView);if(r)return r}return e.displayName([this.source],this.currentView)},async onActionClick(e,r=!1){if(this.isLoading||this.loading!=="")return;if(this.enabledSubmenuActions[e.id]){this.openedSubmenu=e;return}const n=e.displayName([this.source],this.currentView);try{this.$emit("update:loading",e.id),H.set(this.source,"status",_t.LOADING);const o=await e.exec(this.source,this.currentView,this.currentDir);if(o==null)return;if(o){Mt(B("files",'"{displayName}" action executed successfully',{displayName:n}));return}X(B("files",'"{displayName}" action failed',{displayName:n}))}catch(o){V.error("Error while executing action",{action:e,e:o}),X(B("files",'"{displayName}" action failed',{displayName:n}))}finally{this.$emit("update:loading",""),H.set(this.source,"status",void 0),r&&(this.openedSubmenu=null)}},execDefaultAction(e){this.enabledDefaultActions.length>0&&(e.preventDefault(),e.stopPropagation(),this.enabledDefaultActions[0].exec(this.source,this.currentView,this.currentDir))},isMenu(e){var r;return((r=this.enabledSubmenuActions[e])==null?void 0:r.length)>0},async onBackToMenuClick(e){this.openedSubmenu=null,await this.$nextTick(),this.$nextTick(()=>{var r,n;const o=(r=this.$refs["action-".concat(e.id)])==null?void 0:r[0];o&&((n=o.$el.querySelector("button"))==null||n.focus())})},t:B}});var Xa=function(){var n,o;var e=this,r=e._self._c;return e._self._setupProxy,r("td",{staticClass:"files-list__row-actions",attrs:{"data-cy-files-list-row-actions":""}},[e._l(e.enabledRenderActions,function(l){return r("CustomElementRender",{key:l.id,staticClass:"files-list__row-action--inline",class:"files-list__row-action-"+l.id,attrs:{"current-view":e.currentView,render:l.renderInline,source:e.source}})}),r("NcActions",{ref:"actionsMenu",attrs:{"boundaries-element":e.getBoundariesElement,container:e.getBoundariesElement,"force-name":!0,type:"tertiary","force-menu":e.enabledInlineActions.length===0,inline:e.enabledInlineActions.length,open:e.openedMenu},on:{"update:open":function(l){e.openedMenu=l},close:function(l){e.openedSubmenu=null}}},[e._l(e.enabledMenuActions,function(l){var i;return r("NcActionButton",{key:l.id,ref:"action-".concat(l.id),refInFor:!0,class:{["files-list__row-action-".concat(l.id)]:!0,"files-list__row-action--menu":e.isMenu(l.id)},attrs:{"close-after-click":!e.isMenu(l.id),"data-cy-files-list-row-action":l.id,"is-menu":e.isMenu(l.id),title:(i=l.title)==null?void 0:i.call(l,[e.source],e.currentView)},on:{click:function(s){return e.onActionClick(l)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.loading===l.id?r("NcLoadingIcon",{attrs:{size:18}}):r("NcIconSvgWrapper",{attrs:{svg:l.iconSvgInline([e.source],e.currentView)}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.mountType==="shared"&&l.id==="sharing-status"?"":e.actionDisplayName(l))+" ")])}),e.openedSubmenu&&e.enabledSubmenuActions[(n=e.openedSubmenu)==null?void 0:n.id]?[r("NcActionButton",{staticClass:"files-list__row-action-back",on:{click:function(l){return e.onBackToMenuClick(e.openedSubmenu)}},scopedSlots:e._u([{key:"icon",fn:function(){return[r("ArrowLeftIcon")]},proxy:!0}],null,!1,3001860362)},[e._v(" "+e._s(e.actionDisplayName(e.openedSubmenu))+" ")]),r("NcActionSeparator"),e._l(e.enabledSubmenuActions[(o=e.openedSubmenu)==null?void 0:o.id],function(l){var i;return r("NcActionButton",{key:l.id,staticClass:"files-list__row-action--submenu",class:"files-list__row-action-".concat(l.id),attrs:{"close-after-click":"","data-cy-files-list-row-action":l.id,title:(i=l.title)==null?void 0:i.call(l,[e.source],e.currentView)},on:{click:function(s){return e.onActionClick(l)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.loading===l.id?r("NcLoadingIcon",{attrs:{size:18}}):r("NcIconSvgWrapper",{attrs:{svg:l.iconSvgInline([e.source],e.currentView)}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(e.actionDisplayName(l))+" ")])})]:e._e()],2)],2)},Za=[],Ja=J(Qa,Xa,Za,!1,null,"36729064");const Vi=Ja.exports,tl=function(...e){const r=ct("keyboard",{state:()=>({altKey:!1,ctrlKey:!1,metaKey:!1,shiftKey:!1}),actions:{onEvent(n){n||(n=window.event),H.set(this,"altKey",!!n.altKey),H.set(this,"ctrlKey",!!n.ctrlKey),H.set(this,"metaKey",!!n.metaKey),H.set(this,"shiftKey",!!n.shiftKey)}}})(...e);return r._initialized||(window.addEventListener("keydown",r.onEvent),window.addEventListener("keyup",r.onEvent),window.addEventListener("mousemove",r.onEvent),r._initialized=!0),r},el=et({name:"FileEntryCheckbox",components:{NcCheckboxRadioSwitch:Ce,NcLoadingIcon:Gt},props:{fileid:{type:Number,required:!0},isLoading:{type:Boolean,default:!1},nodes:{type:Array,required:!0},source:{type:Object,required:!0}},setup(){const e=yt();return{keyboardStore:tl(),selectionStore:e}},computed:{selectedFiles(){return this.selectionStore.selected},isSelected(){return this.selectedFiles.includes(this.fileid)},index(){return this.nodes.findIndex(e=>e.fileid===this.fileid)},isFile(){return this.source.type===ut.File},ariaLabel(){return this.isFile?B("files",'Toggle selection for file "{displayName}"',{displayName:this.source.basename}):B("files",'Toggle selection for folder "{displayName}"',{displayName:this.source.basename})}},methods:{onSelectionChange(e){var r;const n=this.index,o=this.selectionStore.lastSelectedIndex;if((r=this.keyboardStore)!=null&&r.shiftKey&&o!==null){const i=this.selectedFiles.includes(this.fileid),s=Math.min(n,o),a=Math.max(o,n),c=this.selectionStore.lastSelection,w=this.nodes.map(g=>g.fileid).slice(s,a+1).filter(Boolean),y=[...c,...w].filter(g=>!i||g!==this.fileid);V.debug("Shift key pressed, selecting all files in between",{start:s,end:a,filesToSelect:w,isAlreadySelected:i}),this.selectionStore.set(y);return}const l=e?[...this.selectedFiles,this.fileid]:this.selectedFiles.filter(i=>i!==this.fileid);V.debug("Updating selection",{selection:l}),this.selectionStore.set(l),this.selectionStore.setLastIndex(n)},resetSelection(){this.selectionStore.reset()},t:B}});var rl=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("td",{staticClass:"files-list__row-checkbox",on:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"esc",27,n.key,["Esc","Escape"])||n.ctrlKey||n.shiftKey||n.altKey||n.metaKey?null:e.resetSelection.apply(null,arguments)}}},[e.isLoading?r("NcLoadingIcon"):r("NcCheckboxRadioSwitch",{attrs:{"aria-label":e.ariaLabel,checked:e.isSelected},on:{"update:checked":e.onSelectionChange}})],1)},nl=[],il=J(el,rl,nl,!1,null,null);const Bi=il.exports,ol=Lt("files","forbiddenCharacters",[]),sl=et({name:"FileEntryName",components:{NcTextField:go},props:{displayName:{type:String,required:!0},extension:{type:String,required:!0},filesListWidth:{type:Number,required:!0},nodes:{type:Array,required:!0},source:{type:Object,required:!0},gridMode:{type:Boolean,default:!1}},setup(){return{renamingStore:Ze()}},computed:{currentView(){return this.$navigation.active},isRenaming(){return this.renamingStore.renamingNode===this.source},isRenamingSmallScreen(){return this.isRenaming&&this.filesListWidth<512},newName:{get(){return this.renamingStore.newName},set(e){this.renamingStore.newName=e}},renameLabel(){return{[ut.File]:B("files","File name"),[ut.Folder]:B("files","Folder name")}[this.source.type]},linkTo(){var e,r,n,o;if(this.source.attributes.failed)return{is:"span",params:{title:B("files","This node is unavailable")}};const l=(n=(r=(e=this.$parent)==null?void 0:e.$refs)==null?void 0:r.actions)==null?void 0:n.enabledDefaultActions;return(l==null?void 0:l.length)>0?{is:"a",params:{title:l[0].displayName([this.source],this.currentView),role:"button",tabindex:"0"}}:((o=this.source)==null?void 0:o.permissions)&Tt.READ?{is:"a",params:{download:this.source.basename,href:this.source.source,title:B("files","Download file {name}",{name:this.displayName}),tabindex:"0"}}:{is:"span"}}},watch:{isRenaming:{immediate:!0,handler(e){e&&this.startRenaming()}}},methods:{checkInputValidity(e){var r,n;const o=e.target,l=((n=(r=this.newName).trim)==null?void 0:n.call(r))||"";V.debug("Checking input validity",{newName:l});try{this.isFileNameValid(l),o.setCustomValidity(""),o.title=""}catch(i){i instanceof Error?(o.setCustomValidity(i.message),o.title=i.message):o.setCustomValidity(B("files","Invalid file name"))}finally{o.reportValidity()}},isFileNameValid(e){const r=e.trim();if(r==="."||r==="..")throw new Error(B("files",'"{name}" is an invalid file name.',{name:e}));if(r.length===0)throw new Error(B("files","File name cannot be empty."));if(r.indexOf("/")!==-1)throw new Error(B("files",'"/" is not allowed inside a file name.'));if(r.match(window.OC.config.blacklist_files_regex))throw new Error(B("files",'"{name}" is not an allowed filetype.',{name:e}));if(this.checkIfNodeExists(e))throw new Error(B("files","{newName} already exists.",{newName:e}));const n=ol.find(o=>r.includes(o));if(n)throw new Error(B("files",'"{char}" is not allowed inside a file name.',{char:n}));return!0},checkIfNodeExists(e){return this.nodes.find(r=>r.basename===e&&r!==this.source)},startRenaming(){this.$nextTick(()=>{var e,r,n,o;const l=(this.source.extension||"").split("").length,i=this.source.basename.split("").length-l,s=(o=(n=(r=(e=this.$refs.renameInput)==null?void 0:e.$refs)==null?void 0:r.inputField)==null?void 0:n.$refs)==null?void 0:o.input;if(!s){V.error("Could not find the rename input");return}s.setSelectionRange(0,i),s.focus(),s.dispatchEvent(new Event("keyup"))})},stopRenaming(){this.isRenaming&&this.renamingStore.$reset()},async onRename(){var e,r,n,o,l;const i=this.source.basename,s=this.source.encodedSource,a=((r=(e=this.newName).trim)==null?void 0:r.call(e))||"";if(a===""){X(B("files","Name cannot be empty"));return}if(i===a){this.stopRenaming();return}if(this.checkIfNodeExists(a)){X(B("files","Another entry with the same name already exists"));return}H.set(this.source,"status",_t.LOADING),this.source.rename(a),V.debug("Moving file to",{destination:this.source.encodedSource,oldEncodedSource:s});try{await De({method:"MOVE",url:s,headers:{Destination:this.source.encodedSource,Overwrite:"F"}}),At("files:node:updated",this.source),At("files:node:renamed",this.source),Mt(B("files",'Renamed "{oldName}" to "{newName}"',{oldName:i,newName:a})),this.stopRenaming(),this.$nextTick(()=>{var c;(c=this.$refs.basename)==null||c.focus()})}catch(c){if(V.error("Error while renaming file",{error:c}),this.source.rename(i),(n=this.$refs.renameInput)==null||n.focus(),yo(c)){if(((o=c==null?void 0:c.response)==null?void 0:o.status)===404){X(B("files",'Could not rename "{oldName}", it does not exist any more',{oldName:i}));return}else if(((l=c==null?void 0:c.response)==null?void 0:l.status)===412){X(B("files",'The name "{newName}" is already used in the folder "{dir}". Please choose a different name.',{newName:a,dir:this.currentDir}));return}}X(B("files",'Could not rename "{oldName}"',{oldName:i}))}finally{H.set(this.source,"status",void 0)}},t:B}});var al=function(){var e=this,r=e._self._c;return e._self._setupProxy,e.isRenaming?r("form",{directives:[{name:"on-click-outside",rawName:"v-on-click-outside",value:e.onRename,expression:"onRename"}],staticClass:"files-list__row-rename",attrs:{"aria-label":e.t("files","Rename file")},on:{submit:function(n){return n.preventDefault(),n.stopPropagation(),e.onRename.apply(null,arguments)}}},[r("NcTextField",{ref:"renameInput",attrs:{label:e.renameLabel,autofocus:!0,minlength:1,required:!0,value:e.newName,enterkeyhint:"done"},on:{"update:value":function(n){e.newName=n},keyup:[e.checkInputValidity,function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"esc",27,n.key,["Esc","Escape"])?null:e.stopRenaming.apply(null,arguments)}]}})],1):r(e.linkTo.is,e._b({ref:"basename",tag:"component",staticClass:"files-list__row-name-link",attrs:{"aria-hidden":e.isRenaming,"data-cy-files-list-row-name-link":""},on:{click:function(n){return e.$emit("click",n)}}},"component",e.linkTo.params,!1),[r("span",{staticClass:"files-list__row-name-text"},[r("span",{staticClass:"files-list__row-name-",domProps:{textContent:e._s(e.displayName)}}),r("span",{staticClass:"files-list__row-name-ext",domProps:{textContent:e._s(e.extension)}})])])},ll=[],ul=J(sl,al,ll,!1,null,null);const Ui=ul.exports,cl={name:"CollectivesIcon",props:{title:{type:String,default:""},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}};var dl=function(){var e=this,r=e._self._c;return r("span",e._b({staticClass:"material-design-icon collectives-icon",attrs:{"aria-hidden":!e.title,"aria-label":e.title,role:"img"},on:{click:function(n){return e.$emit("click",n)}}},"span",e.$attrs,!1),[r("svg",{staticClass:"material-design-icon__svg",attrs:{fill:e.fillColor,width:e.size,height:e.size,viewBox:"0 0 16 16"}},[r("path",{attrs:{d:"M2.9,8.8c0-1.2,0.4-2.4,1.2-3.3L0.3,6c-0.2,0-0.3,0.3-0.1,0.4l2.7,2.6C2.9,9,2.9,8.9,2.9,8.8z"}}),r("path",{attrs:{d:"M8,3.7c0.7,0,1.3,0.1,1.9,0.4L8.2,0.6c-0.1-0.2-0.3-0.2-0.4,0L6.1,4C6.7,3.8,7.3,3.7,8,3.7z"}}),r("path",{attrs:{d:"M3.7,11.5L3,15.2c0,0.2,0.2,0.4,0.4,0.3l3.3-1.7C5.4,13.4,4.4,12.6,3.7,11.5z"}}),r("path",{attrs:{d:"M15.7,6l-3.7-0.5c0.7,0.9,1.2,2,1.2,3.3c0,0.1,0,0.2,0,0.3l2.7-2.6C15.9,6.3,15.9,6.1,15.7,6z"}}),r("path",{attrs:{d:"M12.3,11.5c-0.7,1.1-1.8,1.9-3,2.2l3.3,1.7c0.2,0.1,0.4-0.1,0.4-0.3L12.3,11.5z"}}),r("path",{attrs:{d:"M9.6,10.1c-0.4,0.5-1,0.8-1.6,0.8c-1.1,0-2-0.9-2.1-2C5.9,7.7,6.8,6.7,8,6.7c0.6,0,1.1,0.3,1.5,0.7 c0.1,0.1,0.1,0.1,0.2,0.1h1.4c0.2,0,0.4-0.2,0.3-0.5c-0.7-1.3-2.1-2.2-3.8-2.1C5.8,5,4.3,6.6,4.1,8.5C4,10.8,5.8,12.7,8,12.7 c1.6,0,2.9-0.9,3.5-2.3c0.1-0.2-0.1-0.4-0.3-0.4H9.9C9.8,10,9.7,10,9.6,10.1z"}})])])},hl=[],pl=J(cl,dl,hl,!1,null,null);const ti=pl.exports,fl=et({name:"FavoriteIcon",components:{NcIconSvgWrapper:kt},data(){return{StarSvg:Ro}},async mounted(){var e;await this.$nextTick();const r=this.$el.querySelector("svg");(e=r==null?void 0:r.setAttribute)==null||e.call(r,"viewBox","-4 -4 30 30")},methods:{t:B}});var ml=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("NcIconSvgWrapper",{staticClass:"favorite-marker-icon",attrs:{name:e.t("files","Favorite"),svg:e.StarSvg}})},gl=[],yl=J(fl,ml,gl,!1,null,"481d23b5");const vl=yl.exports,wl=H.extend({name:"FileEntryPreview",components:{AccountGroupIcon:er,AccountPlusIcon:_e,CollectivesIcon:ti,FavoriteIcon:vl,FileIcon:jo,FolderIcon:hi,FolderOpenIcon:Vo,KeyIcon:rr,LinkIcon:Te,NetworkIcon:nr,TagIcon:ir},props:{source:{type:Object,required:!0},dragover:{type:Boolean,default:!1},gridMode:{type:Boolean,default:!1}},setup(){return{userConfigStore:Kt()}},data(){return{backgroundFailed:void 0}},computed:{fileid(){var e,r,n;return(n=(r=(e=this.source)==null?void 0:e.fileid)==null?void 0:r.toString)==null?void 0:n.call(r)},isFavorite(){return this.source.attributes.favorite===1},userConfig(){return this.userConfigStore.userConfig},cropPreviews(){return this.userConfig.crop_image_previews===!0},previewUrl(){if(this.source.type===ut.Folder||this.backgroundFailed===!0)return null;try{const e=this.source.attributes.previewUrl||Ft("/core/preview?fileId={fileid}",{fileid:this.fileid}),r=new URL(window.location.origin+e);return r.searchParams.set("x",this.gridMode?"128":"32"),r.searchParams.set("y",this.gridMode?"128":"32"),r.searchParams.set("mimeFallback","true"),r.searchParams.set("a",this.cropPreviews===!0?"0":"1"),r.href}catch{return null}},fileOverlay(){return Do(this.source)?Bo:null},folderOverlay(){var e,r,n,o,l,i,s,a;if(this.source.type!==ut.Folder)return null;if(((r=(e=this.source)==null?void 0:e.attributes)==null?void 0:r["is-encrypted"])===1)return rr;if((o=(n=this.source)==null?void 0:n.attributes)!=null&&o["is-tag"])return ir;const c=Object.values(((i=(l=this.source)==null?void 0:l.attributes)==null?void 0:i["share-types"])||{}).flat();if(c.some(w=>w===wt.SHARE_TYPE_LINK||w===wt.SHARE_TYPE_EMAIL))return Te;if(c.length>0)return _e;switch((a=(s=this.source)==null?void 0:s.attributes)==null?void 0:a["mount-type"]){case"external":case"external-session":return nr;case"group":return er;case"collective":return ti}return null}},methods:{reset(){this.backgroundFailed=void 0,this.$refs.previewImg&&(this.$refs.previewImg.src="")},onBackgroundError(e){var r;((r=e.target)==null?void 0:r.src)!==""&&(this.backgroundFailed=!0)},t:B}});var bl=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("span",{staticClass:"files-list__row-icon"},[e.source.type==="folder"?[e.dragover?e._m(0):[e._m(1),e.folderOverlay?r(e.folderOverlay,{tag:"OverlayIcon",staticClass:"files-list__row-icon-overlay"}):e._e()]]:e.previewUrl&&e.backgroundFailed!==!0?r("img",{ref:"previewImg",staticClass:"files-list__row-icon-preview",class:{"files-list__row-icon-preview--loaded":e.backgroundFailed===!1},attrs:{alt:"",loading:"lazy",src:e.previewUrl},on:{error:e.onBackgroundError,load:function(n){e.backgroundFailed=!1}}}):e._m(2),e.isFavorite?r("span",{staticClass:"files-list__row-icon-favorite"},[e._m(3)],1):e._e(),e.fileOverlay?r(e.fileOverlay,{tag:"OverlayIcon",staticClass:"files-list__row-icon-overlay files-list__row-icon-overlay--file"}):e._e()],2)},_l=[function(){var e=this,r=e._self._c;return e._self._setupProxy,r("FolderOpenIcon")},function(){var e=this,r=e._self._c;return e._self._setupProxy,r("FolderIcon")},function(){var e=this,r=e._self._c;return e._self._setupProxy,r("FileIcon")},function(){var e=this,r=e._self._c;return e._self._setupProxy,r("FavoriteIcon")}],Tl=J(wl,bl,_l,!1,null,null);const qi=Tl.exports,Sl=et({name:"FileEntry",components:{CustomElementRender:ji,FileEntryActions:Vi,FileEntryCheckbox:Bi,FileEntryName:Ui,FileEntryPreview:qi,NcDateTime:vo},mixins:[Ri],props:{isMtimeAvailable:{type:Boolean,default:!1},isSizeAvailable:{type:Boolean,default:!1},compact:{type:Boolean,default:!1}},setup(){const e=Xe(),r=Qe(),n=gt(),o=Ze(),l=yt();return{actionsMenuStore:e,draggingStore:r,filesStore:n,renamingStore:o,selectionStore:l}},computed:{rowListeners(){return{...this.isRenaming?{}:{dragstart:this.onDragStart,dragover:this.onDragOver},contextmenu:this.onRightClick,dragleave:this.onDragLeave,dragend:this.onDragEnd,drop:this.onDrop}},columns(){var e;return this.filesListWidth<512||this.compact?[]:((e=this.currentView)==null?void 0:e.columns)||[]},size(){const e=parseInt(this.source.size,10)||0;return typeof e!="number"||e<0?this.t("files","Pending"):bt(e,!0)},sizeOpacity(){const e=parseInt(this.source.size,10)||0;if(!e||e<0)return{};const r=Math.round(Math.min(100,100*Math.pow(this.source.size/10485760,2)));return{color:"color-mix(in srgb, var(--color-main-text) ".concat(r,"%, var(--color-text-maxcontrast))")}},mtimeOpacity(){var e,r;const n=(r=(e=this.source.mtime)==null?void 0:e.getTime)==null?void 0:r.call(e);if(!n)return{};const o=Math.round(Math.min(100,100*(26784e5-(Date.now()-n))/26784e5));return o<0?{}:{color:"color-mix(in srgb, var(--color-main-text) ".concat(o,"%, var(--color-text-maxcontrast))")}},mtimeTitle(){return this.source.mtime?Yo(this.source.mtime).format("LLL"):""},isActive(){var e,r;return this.fileid===((r=(e=this.currentFileId)==null?void 0:e.toString)==null?void 0:r.call(e))}},methods:{formatFileSize:bt}});var Nl=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("tr",e._g({staticClass:"files-list__row",class:{"files-list__row--dragover":e.dragover,"files-list__row--loading":e.isLoading,"files-list__row--active":e.isActive},attrs:{"data-cy-files-list-row":"","data-cy-files-list-row-fileid":e.fileid,"data-cy-files-list-row-name":e.source.basename,draggable:e.canDrag}},e.rowListeners),[e.source.attributes.failed?r("span",{staticClass:"files-list__row--failed"}):e._e(),r("FileEntryCheckbox",{attrs:{fileid:e.fileid,"is-loading":e.isLoading,nodes:e.nodes,source:e.source}}),r("td",{staticClass:"files-list__row-name",attrs:{"data-cy-files-list-row-name":""}},[r("FileEntryPreview",{ref:"preview",attrs:{source:e.source,dragover:e.dragover},nativeOn:{click:function(n){return e.execDefaultAction.apply(null,arguments)}}}),r("FileEntryName",{ref:"name",attrs:{"display-name":e.displayName,extension:e.extension,"files-list-width":e.filesListWidth,nodes:e.nodes,source:e.source},on:{click:e.execDefaultAction}})],1),r("FileEntryActions",{directives:[{name:"show",rawName:"v-show",value:!e.isRenamingSmallScreen,expression:"!isRenamingSmallScreen"}],ref:"actions",class:"files-list__row-actions-".concat(e.uniqueId),attrs:{"files-list-width":e.filesListWidth,loading:e.loading,opened:e.openedMenu,source:e.source},on:{"update:loading":function(n){e.loading=n},"update:opened":function(n){e.openedMenu=n}}}),!e.compact&&e.isSizeAvailable?r("td",{staticClass:"files-list__row-size",style:e.sizeOpacity,attrs:{"data-cy-files-list-row-size":""},on:{click:e.openDetailsIfAvailable}},[r("span",[e._v(e._s(e.size))])]):e._e(),!e.compact&&e.isMtimeAvailable?r("td",{staticClass:"files-list__row-mtime",style:e.mtimeOpacity,attrs:{"data-cy-files-list-row-mtime":""},on:{click:e.openDetailsIfAvailable}},[r("NcDateTime",{attrs:{timestamp:e.source.mtime,"ignore-seconds":!0}})],1):e._e(),e._l(e.columns,function(n){var o;return r("td",{key:n.id,staticClass:"files-list__row-column-custom",class:"files-list__row-".concat((o=e.currentView)==null?void 0:o.id,"-").concat(n.id),attrs:{"data-cy-files-list-row-column-custom":n.id},on:{click:e.openDetailsIfAvailable}},[r("CustomElementRender",{attrs:{"current-view":e.currentView,render:n.render,source:e.source}})],1)})],2)},El=[],Dl=J(Sl,Nl,El,!1,null,null);const Cl=Dl.exports,xl=et({name:"FileEntryGrid",components:{FileEntryActions:Vi,FileEntryCheckbox:Bi,FileEntryName:Ui,FileEntryPreview:qi},mixins:[Ri],inheritAttrs:!1,setup(){const e=Xe(),r=Qe(),n=gt(),o=Ze(),l=yt();return{actionsMenuStore:e,draggingStore:r,filesStore:n,renamingStore:o,selectionStore:l}},data(){return{gridMode:!0}}});var Ol=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("tr",{staticClass:"files-list__row",class:{"files-list__row--active":e.isActive,"files-list__row--dragover":e.dragover,"files-list__row--loading":e.isLoading},attrs:{"data-cy-files-list-row":"","data-cy-files-list-row-fileid":e.fileid,"data-cy-files-list-row-name":e.source.basename,draggable:e.canDrag},on:{contextmenu:e.onRightClick,dragover:e.onDragOver,dragleave:e.onDragLeave,dragstart:e.onDragStart,dragend:e.onDragEnd,drop:e.onDrop}},[e.source.attributes.failed?r("span",{staticClass:"files-list__row--failed"}):e._e(),r("FileEntryCheckbox",{attrs:{fileid:e.fileid,"is-loading":e.isLoading,nodes:e.nodes,source:e.source}}),r("td",{staticClass:"files-list__row-name",attrs:{"data-cy-files-list-row-name":""}},[r("FileEntryPreview",{ref:"preview",attrs:{dragover:e.dragover,"grid-mode":!0,source:e.source},nativeOn:{click:function(n){return e.execDefaultAction.apply(null,arguments)}}}),r("FileEntryName",{ref:"name",attrs:{"display-name":e.displayName,extension:e.extension,"files-list-width":e.filesListWidth,"grid-mode":!0,nodes:e.nodes,source:e.source},on:{click:e.execDefaultAction}})],1),r("FileEntryActions",{ref:"actions",class:"files-list__row-actions-".concat(e.uniqueId),attrs:{"files-list-width":e.filesListWidth,"grid-mode":!0,loading:e.loading,opened:e.openedMenu,source:e.source},on:{"update:loading":function(n){e.loading=n},"update:opened":function(n){e.openedMenu=n}}})],1)},Al=[],Il=J(xl,Ol,Al,!1,null,null);const Pl=Il.exports,Fl={name:"FilesListHeader",props:{header:{type:Object,required:!0},currentFolder:{type:Object,required:!0},currentView:{type:Object,required:!0}},computed:{enabled(){return this.header.enabled(this.currentFolder,this.currentView)}},watch:{enabled(e){e&&this.header.updated(this.currentFolder,this.currentView)},currentFolder(){this.header.updated(this.currentFolder,this.currentView)}},mounted(){console.debug("Mounted",this.header.id),this.header.render(this.$refs.mount,this.currentFolder,this.currentView)}};var Ll=function(){var e=this,r=e._self._c;return r("div",{directives:[{name:"show",rawName:"v-show",value:e.enabled,expression:"enabled"}],class:"files-list__header-".concat(e.header.id)},[r("span",{ref:"mount"})])},kl=[],Ml=J(Fl,Ll,kl,!1,null,null);const Rl=Ml.exports,jl=H.extend({name:"FilesListTableFooter",components:{},props:{isMtimeAvailable:{type:Boolean,default:!1},isSizeAvailable:{type:Boolean,default:!1},nodes:{type:Array,required:!0},summary:{type:String,default:""},filesListWidth:{type:Number,default:0}},setup(){const e=He();return{filesStore:gt(),pathsStore:e}},computed:{currentView(){return this.$navigation.active},dir(){var e,r;return(((r=(e=this.$route)==null?void 0:e.query)==null?void 0:r.dir)||"/").replace(/^(.+)\/$/,"$1")},currentFolder(){var e;if(!((e=this.currentView)!=null&&e.id))return;if(this.dir==="/")return this.filesStore.getRoot(this.currentView.id);const r=this.pathsStore.getPath(this.currentView.id,this.dir);return this.filesStore.getNode(r)},columns(){var e;return this.filesListWidth<512?[]:((e=this.currentView)==null?void 0:e.columns)||[]},totalSize(){var e;return(e=this.currentFolder)!=null&&e.size?bt(this.currentFolder.size,!0):bt(this.nodes.reduce((r,n)=>r+n.size||0,0),!0)}},methods:{classForColumn(e){return{"files-list__row-column-custom":!0,["files-list__row-".concat(this.currentView.id,"-").concat(e.id)]:!0}},t:B}});var Vl=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("tr",[r("th",{staticClass:"files-list__row-checkbox"},[r("span",{staticClass:"hidden-visually"},[e._v(e._s(e.t("files","Total rows summary")))])]),r("td",{staticClass:"files-list__row-name"},[r("span",{staticClass:"files-list__row-icon"}),r("span",[e._v(e._s(e.summary))])]),r("td",{staticClass:"files-list__row-actions"}),e.isSizeAvailable?r("td",{staticClass:"files-list__column files-list__row-size"},[r("span",[e._v(e._s(e.totalSize))])]):e._e(),e.isMtimeAvailable?r("td",{staticClass:"files-list__column files-list__row-mtime"}):e._e(),e._l(e.columns,function(n){var o;return r("th",{key:n.id,class:e.classForColumn(n)},[r("span",[e._v(e._s((o=n.summary)==null?void 0:o.call(n,e.nodes,e.currentView)))])])})],2)},Bl=[],Ul=J(jl,Vl,Bl,!1,null,"7cb0eba7");const ql=Ul.exports,Je=H.extend({computed:{...Wi(Oe,["getConfig","setSortingBy","toggleSortingDirection"]),currentView(){return this.$navigation.active},sortingMode(){var e,r;return((e=this.getConfig(this.currentView.id))==null?void 0:e.sorting_mode)||((r=this.currentView)==null?void 0:r.defaultSortKey)||"basename"},isAscSorting(){var e;return((e=this.getConfig(this.currentView.id))==null?void 0:e.sorting_direction)!=="desc"}},methods:{toggleSortBy(e){if(this.sortingMode===e){this.toggleSortingDirection(this.currentView.id);return}this.setSortingBy(e,this.currentView.id)}}}),$l=et({name:"FilesListTableHeaderButton",components:{MenuDown:Uo,MenuUp:qo,NcButton:li},mixins:[Je],props:{name:{type:String,required:!0},mode:{type:String,required:!0}},methods:{t:B}});var zl=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("NcButton",{class:["files-list__column-sort-button",{"files-list__column-sort-button--active":e.sortingMode===e.mode,"files-list__column-sort-button--size":e.sortingMode==="size"}],attrs:{alignment:e.mode==="size"?"end":"start-reverse",type:"tertiary"},on:{click:function(n){return e.toggleSortBy(e.mode)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.sortingMode!==e.mode||e.isAscSorting?r("MenuUp",{staticClass:"files-list__column-sort-button-icon"}):r("MenuDown",{staticClass:"files-list__column-sort-button-icon"})]},proxy:!0}])},[r("span",{staticClass:"files-list__column-sort-button-text"},[e._v(e._s(e.name))])])},Wl=[],Hl=J($l,zl,Wl,!1,null,"e1206304");const Gl=Hl.exports,Kl=et({name:"FilesListTableHeader",components:{FilesListTableHeaderButton:Gl,NcCheckboxRadioSwitch:Ce},mixins:[Je],props:{isMtimeAvailable:{type:Boolean,default:!1},isSizeAvailable:{type:Boolean,default:!1},nodes:{type:Array,required:!0},filesListWidth:{type:Number,default:0}},setup(){const e=gt(),r=yt();return{filesStore:e,selectionStore:r}},computed:{currentView(){return this.$navigation.active},columns(){var e;return this.filesListWidth<512?[]:((e=this.currentView)==null?void 0:e.columns)||[]},dir(){var e,r;return(((r=(e=this.$route)==null?void 0:e.query)==null?void 0:r.dir)||"/").replace(/^(.+)\/$/,"$1")},selectAllBind(){const e=B("files","Toggle selection for all files and folders");return{"aria-label":e,checked:this.isAllSelected,indeterminate:this.isSomeSelected,title:e}},selectedNodes(){return this.selectionStore.selected},isAllSelected(){return this.selectedNodes.length===this.nodes.length},isNoneSelected(){return this.selectedNodes.length===0},isSomeSelected(){return!this.isAllSelected&&!this.isNoneSelected}},methods:{ariaSortForMode(e){return this.sortingMode===e?this.isAscSorting?"ascending":"descending":null},classForColumn(e){var r;return{"files-list__column":!0,"files-list__column--sortable":!!e.sort,"files-list__row-column-custom":!0,["files-list__row-".concat((r=this.currentView)==null?void 0:r.id,"-").concat(e.id)]:!0}},onToggleAll(e){if(e){const r=this.nodes.map(n=>n.fileid).filter(Boolean);V.debug("Added all nodes to selection",{selection:r}),this.selectionStore.setLastIndex(null),this.selectionStore.set(r)}else V.debug("Cleared selection"),this.selectionStore.reset()},resetSelection(){this.selectionStore.reset()},t:B}});var Yl=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("tr",{staticClass:"files-list__row-head"},[r("th",{staticClass:"files-list__column files-list__row-checkbox",on:{keyup:function(n){return!n.type.indexOf("key")&&e._k(n.keyCode,"esc",27,n.key,["Esc","Escape"])||n.ctrlKey||n.shiftKey||n.altKey||n.metaKey?null:e.resetSelection.apply(null,arguments)}}},[r("NcCheckboxRadioSwitch",e._b({on:{"update:checked":e.onToggleAll}},"NcCheckboxRadioSwitch",e.selectAllBind,!1))],1),r("th",{staticClass:"files-list__column files-list__row-name files-list__column--sortable",attrs:{"aria-sort":e.ariaSortForMode("basename")}},[r("span",{staticClass:"files-list__row-icon"}),r("FilesListTableHeaderButton",{attrs:{name:e.t("files","Name"),mode:"basename"}})],1),r("th",{staticClass:"files-list__row-actions"}),e.isSizeAvailable?r("th",{staticClass:"files-list__column files-list__row-size",class:{"files-list__column--sortable":e.isSizeAvailable},attrs:{"aria-sort":e.ariaSortForMode("size")}},[r("FilesListTableHeaderButton",{attrs:{name:e.t("files","Size"),mode:"size"}})],1):e._e(),e.isMtimeAvailable?r("th",{staticClass:"files-list__column files-list__row-mtime",class:{"files-list__column--sortable":e.isMtimeAvailable},attrs:{"aria-sort":e.ariaSortForMode("mtime")}},[r("FilesListTableHeaderButton",{attrs:{name:e.t("files","Modified"),mode:"mtime"}})],1):e._e(),e._l(e.columns,function(n){return r("th",{key:n.id,class:e.classForColumn(n),attrs:{"aria-sort":e.ariaSortForMode(n.id)}},[n.sort?r("FilesListTableHeaderButton",{attrs:{name:n.title,mode:n.id}}):r("span",[e._v(" "+e._s(n.title)+" ")])],1)})],2)},Ql=[],Xl=J(Kl,Yl,Ql,!1,null,"5a7fd371");const Zl=Xl.exports,Jl=H.extend({name:"VirtualList",mixins:[Wt],props:{dataComponent:{type:[Object,Function],required:!0},dataKey:{type:String,required:!0},dataSources:{type:Array,required:!0},extraProps:{type:Object,default:()=>({})},scrollToIndex:{type:Number,default:0},gridMode:{type:Boolean,default:!1},caption:{type:String,default:""}},data(){return{index:this.scrollToIndex,beforeHeight:0,headerHeight:0,tableHeight:0,resizeObserver:null}},computed:{isReady(){return this.tableHeight>0},bufferItems(){return this.gridMode?this.columnCount:3},itemHeight(){return this.gridMode?197:55},itemWidth(){return 175},rowCount(){return Math.ceil((this.tableHeight-this.headerHeight)/this.itemHeight)+this.bufferItems/this.columnCount*2+1},columnCount(){return this.gridMode?Math.floor(this.filesListWidth/this.itemWidth):1},startIndex(){return Math.max(0,this.index-this.bufferItems)},shownItems(){return this.gridMode?this.rowCount*this.columnCount:this.rowCount},renderedItems(){if(!this.isReady)return[];const e=this.dataSources.slice(this.startIndex,this.startIndex+this.shownItems),r=e.filter(o=>Object.values(this.$_recycledPool).includes(o[this.dataKey])).map(o=>o[this.dataKey]),n=Object.keys(this.$_recycledPool).filter(o=>!r.includes(this.$_recycledPool[o]));return e.map(o=>{const l=Object.values(this.$_recycledPool).indexOf(o[this.dataKey]);if(l!==-1)return{key:Object.keys(this.$_recycledPool)[l],item:o};const i=n.pop()||Math.random().toString(36).substr(2);return this.$_recycledPool[i]=o[this.dataKey],{key:i,item:o}})},tbodyStyle(){const e=this.startIndex+this.rowCount>this.dataSources.length,r=this.dataSources.length-this.startIndex-this.shownItems,n=Math.floor(Math.min(this.dataSources.length-this.startIndex,r)/this.columnCount);return{paddingTop:"".concat(Math.floor(this.startIndex/this.columnCount)*this.itemHeight,"px"),paddingBottom:e?0:"".concat(n*this.itemHeight,"px")}}},watch:{scrollToIndex(e){this.scrollTo(e)},columnCount(e,r){if(r===0){console.debug("VirtualList: columnCount is 0, skipping scroll");return}this.scrollTo(this.index)}},mounted(){var e,r;const n=(e=this.$refs)==null?void 0:e.before,o=this.$el,l=(r=this.$refs)==null?void 0:r.thead;this.resizeObserver=new ResizeObserver(Xo.debounce(()=>{var i,s,a;this.beforeHeight=(i=n==null?void 0:n.clientHeight)!=null?i:0,this.headerHeight=(s=l==null?void 0:l.clientHeight)!=null?s:0,this.tableHeight=(a=o==null?void 0:o.clientHeight)!=null?a:0,V.debug("VirtualList: resizeObserver updated"),this.onScroll()},100,!1)),this.resizeObserver.observe(n),this.resizeObserver.observe(o),this.resizeObserver.observe(l),this.scrollToIndex&&this.scrollTo(this.scrollToIndex),this.$el.addEventListener("scroll",this.onScroll,{passive:!0}),this.$_recycledPool={}},beforeDestroy(){this.resizeObserver&&this.resizeObserver.disconnect()},methods:{scrollTo(e){const r=Math.ceil(this.dataSources.length/this.columnCount);if(r<this.rowCount){V.debug("VirtualList: Skip scrolling. nothing to scroll",{index:e,targetRow:r,rowCount:this.rowCount});return}this.index=e;const n=(Math.floor(e/this.columnCount)-.5)*this.itemHeight+this.beforeHeight;V.debug("VirtualList: scrolling to index "+e,{scrollTop:n,columnCount:this.columnCount}),this.$el.scrollTop=n},onScroll(){var e;(e=this._onScrollHandle)!=null||(this._onScrollHandle=requestAnimationFrame(()=>{this._onScrollHandle=null;const r=this.$el.scrollTop-this.beforeHeight,n=Math.floor(r/this.itemHeight)*this.columnCount;this.index=Math.max(0,n),this.$emit("scroll")}))}}});var tu=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("div",{staticClass:"files-list",attrs:{"data-cy-files-list":""}},[r("div",{ref:"before",staticClass:"files-list__before"},[e._t("before")],2),e.$scopedSlots["header-overlay"]?r("div",{staticClass:"files-list__thead-overlay"},[e._t("header-overlay")],2):e._e(),r("table",{staticClass:"files-list__table",class:{"files-list__table--with-thead-overlay":!!e.$scopedSlots["header-overlay"]}},[e.caption?r("caption",{staticClass:"hidden-visually"},[e._v(" "+e._s(e.caption)+" ")]):e._e(),r("thead",{ref:"thead",staticClass:"files-list__thead",attrs:{"data-cy-files-list-thead":""}},[e._t("header")],2),r("tbody",{staticClass:"files-list__tbody",class:e.gridMode?"files-list__tbody--grid":"files-list__tbody--list",style:e.tbodyStyle,attrs:{"data-cy-files-list-tbody":""}},e._l(e.renderedItems,function({key:n,item:o},l){return r(e.dataComponent,e._b({key:n,tag:"component",attrs:{source:o,index:l}},"component",e.extraProps,!1))}),1),r("tfoot",{directives:[{name:"show",rawName:"v-show",value:e.isReady,expression:"isReady"}],staticClass:"files-list__tfoot",attrs:{"data-cy-files-list-tfoot":""}},[e._t("footer")],2)])])},eu=[],ru=J(Jl,tu,eu,!1,null,null);const nu=ru.exports,iu=Ee(),ou=et({name:"FilesListTableHeaderActions",components:{NcActions:ai,NcActionButton:si,NcIconSvgWrapper:kt,NcLoadingIcon:Gt},mixins:[Wt],props:{currentView:{type:Object,required:!0},selectedNodes:{type:Array,default:()=>[]}},setup(){const e=Xe(),r=gt(),n=yt();return{actionsMenuStore:e,filesStore:r,selectionStore:n}},data(){return{loading:null}},computed:{dir(){var e,r;return(((r=(e=this.$route)==null?void 0:e.query)==null?void 0:r.dir)||"/").replace(/^(.+)\/$/,"$1")},enabledActions(){return iu.filter(e=>e.execBatch).filter(e=>!e.enabled||e.enabled(this.nodes,this.currentView)).sort((e,r)=>(e.order||0)-(r.order||0))},nodes(){return this.selectedNodes.map(e=>this.getNode(e)).filter(Boolean)},areSomeNodesLoading(){return this.nodes.some(e=>e.status===_t.LOADING)},openedMenu:{get(){return this.actionsMenuStore.opened==="global"},set(e){this.actionsMenuStore.opened=e?"global":null}},inlineActions(){return this.filesListWidth<512?0:this.filesListWidth<768?1:this.filesListWidth<1024?2:3}},methods:{getNode(e){return this.filesStore.getNode(e)},async onActionClick(e){const r=e.displayName(this.nodes,this.currentView),n=this.selectedNodes;try{this.loading=e.id,this.nodes.forEach(l=>{H.set(l,"status",_t.LOADING)});const o=await e.execBatch(this.nodes,this.currentView,this.dir);if(!o.some(l=>l!==null)){this.selectionStore.reset();return}if(o.some(l=>l===!1)){const l=n.filter((i,s)=>o[s]===!1);if(this.selectionStore.set(l),o.some(i=>i===null))return;X(this.t("files",'"{displayName}" failed on some elements ',{displayName:r}));return}Mt(this.t("files",'"{displayName}" batch action executed successfully',{displayName:r})),this.selectionStore.reset()}catch(o){V.error("Error while executing action",{action:e,e:o}),X(this.t("files",'"{displayName}" action failed',{displayName:r}))}finally{this.loading=null,this.nodes.forEach(o=>{H.set(o,"status",void 0)})}},t:B}});var su=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("div",{staticClass:"files-list__column files-list__row-actions-batch"},[r("NcActions",{ref:"actionsMenu",attrs:{disabled:!!e.loading||e.areSomeNodesLoading,"force-name":!0,inline:e.inlineActions,"menu-name":e.inlineActions<=1?e.t("files","Actions"):null,open:e.openedMenu},on:{"update:open":function(n){e.openedMenu=n}}},e._l(e.enabledActions,function(n){return r("NcActionButton",{key:n.id,class:"files-list__row-actions-batch-"+n.id,on:{click:function(o){return e.onActionClick(n)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.loading===n.id?r("NcLoadingIcon",{attrs:{size:18}}):r("NcIconSvgWrapper",{attrs:{svg:n.iconSvgInline(e.nodes,e.currentView)}})]},proxy:!0}],null,!0)},[e._v(" "+e._s(n.displayName(e.nodes,e.currentView))+" ")])}),1)],1)},au=[],lu=J(ou,su,au,!1,null,"42f681a6");const uu=lu.exports,cu=et({name:"FilesListVirtual",components:{FilesListHeader:Rl,FilesListTableFooter:ql,FilesListTableHeader:Zl,VirtualList:nu,FilesListTableHeaderActions:uu},mixins:[Wt],props:{currentView:{type:to,required:!0},currentFolder:{type:Ne,required:!0},nodes:{type:Array,required:!0}},setup(){const e=Kt(),r=yt();return{userConfigStore:e,selectionStore:r}},data(){return{FileEntry:Cl,FileEntryGrid:Pl,headers:eo(),scrollToIndex:0,openFileId:null}},computed:{userConfig(){return this.userConfigStore.userConfig},fileId(){return parseInt(this.$route.params.fileid)||null},openFile(){return!!this.$route.query.openfile},summary(){return di(this.nodes)},isMtimeAvailable(){return this.filesListWidth<768?!1:this.nodes.some(e=>e.mtime!==void 0)},isSizeAvailable(){return this.filesListWidth<768?!1:this.nodes.some(e=>e.attributes.size!==void 0)},sortedHeaders(){return!this.currentFolder||!this.currentView?[]:[...this.headers].sort((e,r)=>e.order-r.order)},caption(){const e=B("files","List of files and folders."),r=this.currentView.caption||e,n=B("files","Column headers with buttons are sortable."),o=B("files","This list is not fully rendered for performance reasons. The files will be rendered as you navigate through the list.");return"".concat(r,"\n").concat(n,"\n").concat(o)},selectedNodes(){return this.selectionStore.selected},isNoneSelected(){return this.selectedNodes.length===0}},watch:{fileId(e){this.scrollToFile(e,!1)},openFile(e){e&&this.$nextTick(()=>this.handleOpenFile(this.fileId))}},mounted(){window.document.querySelector("main.app-content").addEventListener("dragover",this.onDragOver);const{id:e}=Lt("files","openFileInfo",{});this.scrollToFile(e!=null?e:this.fileId),this.openSidebarForFile(e!=null?e:this.fileId),this.handleOpenFile(e!=null?e:null)},beforeDestroy(){window.document.querySelector("main.app-content").removeEventListener("dragover",this.onDragOver)},methods:{openSidebarForFile(e){var r,n;if(document.documentElement.clientWidth>1024&&this.currentFolder.fileid!==e){const o=this.nodes.find(l=>l.fileid===e);o&&(n=(r=zt)==null?void 0:r.enabled)!=null&&n.call(r,[o],this.currentView)&&(V.debug("Opening sidebar on file "+o.path,{node:o}),zt.exec(o,this.currentView,this.currentFolder.path))}},scrollToFile(e,r=!0){if(e){const n=this.nodes.findIndex(o=>o.fileid===e);r&&n===-1&&e!==this.currentFolder.fileid&&X(this.t("files","File not found")),this.scrollToIndex=Math.max(0,n)}},handleOpenFile(e){if(e===null||this.openFileId===e)return;const r=this.nodes.find(n=>n.fileid===e);r===void 0||r.type===ut.Folder||(V.debug("Opening file "+r.path,{node:r}),this.openFileId=e,Ee().filter(n=>!n.enabled||n.enabled([r],this.currentView)).sort((n,o)=>(n.order||0)-(o.order||0)).filter(n=>!!(n!=null&&n.default))[0].exec(r,this.currentView,this.currentFolder.path))},getFileId(e){return e.fileid},onDragOver(e){var r;if((r=e.dataTransfer)!=null&&r.types.includes("Files"))return;e.preventDefault(),e.stopPropagation();const n=this.$refs.table.$el.getBoundingClientRect().top,o=n+this.$refs.table.$el.getBoundingClientRect().height;if(e.clientY<n+100){this.$refs.table.$el.scrollTop=this.$refs.table.$el.scrollTop-25;return}e.clientY>o-50&&(this.$refs.table.$el.scrollTop=this.$refs.table.$el.scrollTop+25)},t:B}});var du=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("VirtualList",{ref:"table",attrs:{"data-component":e.userConfig.grid_view?e.FileEntryGrid:e.FileEntry,"data-key":"source","data-sources":e.nodes,"grid-mode":e.userConfig.grid_view,"extra-props":{isMtimeAvailable:e.isMtimeAvailable,isSizeAvailable:e.isSizeAvailable,nodes:e.nodes,filesListWidth:e.filesListWidth},"scroll-to-index":e.scrollToIndex,caption:e.caption},scopedSlots:e._u([e.isNoneSelected?null:{key:"header-overlay",fn:function(){return[r("span",{staticClass:"files-list__selected"},[e._v(e._s(e.t("files","{count} selected",{count:e.selectedNodes.length})))]),r("FilesListTableHeaderActions",{attrs:{"current-view":e.currentView,"selected-nodes":e.selectedNodes}})]},proxy:!0},{key:"before",fn:function(){return e._l(e.sortedHeaders,function(n){return r("FilesListHeader",{key:n.id,attrs:{"current-folder":e.currentFolder,"current-view":e.currentView,header:n}})})},proxy:!0},{key:"header",fn:function(){return[r("FilesListTableHeader",{ref:"thead",attrs:{"files-list-width":e.filesListWidth,"is-mtime-available":e.isMtimeAvailable,"is-size-available":e.isSizeAvailable,nodes:e.nodes}})]},proxy:!0},{key:"footer",fn:function(){return[r("FilesListTableFooter",{attrs:{"files-list-width":e.filesListWidth,"is-mtime-available":e.isMtimeAvailable,"is-size-available":e.isSizeAvailable,nodes:e.nodes,summary:e.summary}})]},proxy:!0}],null,!0)})},hu=[],pu=J(cu,du,hu,!1,null,"2719c075");const fu=pu.exports,mu=et({name:"DragAndDropNotice",components:{TrayArrowDownIcon:$o},props:{currentFolder:{type:Ne,required:!0}},data(){return{dragover:!1}},computed:{currentView(){return this.$navigation.active},canUpload(){return this.currentFolder&&(this.currentFolder.permissions&Tt.CREATE)!==0},isQuotaExceeded(){var e,r;return((r=(e=this.currentFolder)==null?void 0:e.attributes)==null?void 0:r["quota-available-bytes"])===0},cantUploadLabel(){return this.isQuotaExceeded?this.t("files","Your have used your space quota and cannot upload files anymore"):this.canUpload?null:this.t("files","You don’t have permission to upload or create files here")}},mounted(){const e=window.document.querySelector("main.app-content");e.addEventListener("dragover",this.onDragOver),e.addEventListener("dragleave",this.onDragLeave),e.addEventListener("drop",this.onContentDrop)},beforeDestroy(){const e=window.document.querySelector("main.app-content");e.removeEventListener("dragover",this.onDragOver),e.removeEventListener("dragleave",this.onDragLeave),e.removeEventListener("drop",this.onContentDrop)},methods:{onDragOver(e){var r;e.preventDefault(),(r=e.dataTransfer)!=null&&r.types.includes("Files")&&(this.dragover=!0)},onDragLeave(e){var r;const n=e.currentTarget;n!=null&&n.contains((r=e.relatedTarget)!=null?r:e.target)||this.dragover&&(this.dragover=!1)},onContentDrop(e){V.debug("Drag and drop cancelled, dropped on empty space",{event:e}),e.preventDefault(),this.dragover&&(this.dragover=!1)},async onDrop(e){var r,n,o,l,i;if(this.cantUploadLabel){X(this.cantUploadLabel);return}if((r=this.$el.querySelector("tbody"))!=null&&r.contains(e.target))return;e.preventDefault(),e.stopPropagation();const s=[...((n=e.dataTransfer)==null?void 0:n.items)||[]],a=await Ke(s),c=await((o=this.currentView)==null?void 0:o.getContents(this.currentFolder.path)),w=c==null?void 0:c.folder;if(!w){X(this.t("files","Target folder does not exist any more"));return}if(e.button)return;V.debug("Dropped",{event:e,folder:w,fileTree:a});const y=(await Ye(a,w,c.contents)).findLast(g=>{var m,E;return g.status!==Co.FAILED&&!g.file.webkitRelativePath.includes("/")&&((E=(m=g.response)==null?void 0:m.headers)==null?void 0:E["oc-fileid"])&&g.source.replace(w.source,"").split("/").length===2});y!==void 0&&(V.debug("Scrolling to last upload in current folder",{lastUpload:y}),this.$router.push({...this.$route,params:{view:(i=(l=this.$route.params)==null?void 0:l.view)!=null?i:"files",fileid:parseInt(y.response.headers["oc-fileid"])}})),this.dragover=!1},t:B}});var gu=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("div",{directives:[{name:"show",rawName:"v-show",value:e.dragover,expression:"dragover"}],staticClass:"files-list__drag-drop-notice",attrs:{"data-cy-files-drag-drop-area":""},on:{drop:e.onDrop}},[r("div",{staticClass:"files-list__drag-drop-notice-wrapper"},[e.canUpload&&!e.isQuotaExceeded?[r("TrayArrowDownIcon",{attrs:{size:48}}),r("h3",{staticClass:"files-list-drag-drop-notice__title"},[e._v(" "+e._s(e.t("files","Drag and drop files here to upload"))+" ")])]:[r("h3",{staticClass:"files-list-drag-drop-notice__title"},[e._v(" "+e._s(e.cantUploadLabel)+" ")])]],2)])},yu=[],vu=J(mu,gu,yu,!1,null,"5ffb7398");const wu=vu.exports;var ei;const bu=((ei=wo())==null?void 0:ei.files_sharing)!==void 0,_u=et({name:"FilesList",components:{BreadCrumbs:Ra,DragAndDropNotice:wu,FilesListVirtual:fu,LinkIcon:Te,ListViewIcon:zo,NcAppContent:bo,NcButton:li,NcEmptyContent:_o,NcIconSvgWrapper:kt,NcLoadingIcon:Gt,PlusIcon:Wo,AccountPlusIcon:_e,UploadPicker:xo,ViewGridIcon:Ho},mixins:[Wt,Je],setup(){var e;const r=gt(),n=He(),o=yt(),l=Fi(),i=Kt(),s=Oe(),a=(e=Lt("core","config",[])["enable_non-accessible_features"])!=null?e:!0;return{filesStore:r,pathsStore:n,selectionStore:o,uploaderStore:l,userConfigStore:i,viewConfigStore:s,enableGridView:a}},data(){return{filterText:"",loading:!0,promise:null,Type:wt,_unsubscribeStore:()=>{}}},computed:{userConfig(){return this.userConfigStore.userConfig},currentView(){return this.$navigation.active||this.$navigation.views.find(e=>{var r,n;return e.id===((n=(r=this.$route.params)==null?void 0:r.view)!=null?n:"files")})},pageHeading(){var e,r;return(r=(e=this.currentView)==null?void 0:e.name)!=null?r:this.t("files","Files")},dir(){var e,r,n;return(((n=(r=(e=this.$route)==null?void 0:e.query)==null?void 0:r.dir)==null?void 0:n.toString())||"/").replace(/^(.+)\/$/,"$1")},currentFolder(){var e;if(!((e=this.currentView)!=null&&e.id))return;if(this.dir==="/")return this.filesStore.getRoot(this.currentView.id);const r=this.pathsStore.getPath(this.currentView.id,this.dir);return this.filesStore.getNode(r)},sortingParameters(){const e=[...this.userConfig.sort_favorites_first?[n=>{var o;return((o=n.attributes)==null?void 0:o.favorite)!==1}]:[],...this.userConfig.sort_folders_first?[n=>n.type!=="folder"]:[],...this.sortingMode!=="basename"?[n=>n[this.sortingMode]]:[],n=>{var o;return((o=n.attributes)==null?void 0:o.displayName)||n.basename},n=>n.basename],r=[...this.userConfig.sort_favorites_first?["asc"]:[],...this.userConfig.sort_folders_first?["asc"]:[],...this.sortingMode==="mtime"?[this.isAscSorting?"desc":"asc"]:[],...this.sortingMode!=="mtime"&&this.sortingMode!=="basename"?[this.isAscSorting?"asc":"desc"]:[],this.isAscSorting?"asc":"desc",this.isAscSorting?"asc":"desc"];return[e,r]},dirContentsSorted(){var e;if(!this.currentView)return[];let r=[...this.dirContents];this.filterText&&(r=r.filter(o=>o.attributes.basename.toLowerCase().includes(this.filterText.toLowerCase())),console.debug("Files view filtered",r));const n=(((e=this.currentView)==null?void 0:e.columns)||[]).find(o=>o.id===this.sortingMode);if(n!=null&&n.sort&&typeof n.sort=="function"){const o=[...this.dirContents].sort(n.sort);return this.isAscSorting?o:o.reverse()}return ia(r,...this.sortingParameters)},dirContents(){var e,r;const n=(e=this.userConfigStore)==null?void 0:e.userConfig.show_hidden;return(((r=this.currentFolder)==null?void 0:r._children)||[]).map(this.getNode).filter(o=>{var l;return n?!!o:o&&((l=o==null?void 0:o.attributes)==null?void 0:l.hidden)!==!0&&!(o!=null&&o.basename.startsWith("."))})},isEmptyDir(){return this.dirContents.length===0},isRefreshing(){return this.currentFolder!==void 0&&!this.isEmptyDir&&this.loading},toPreviousDir(){const e=this.dir.split("/").slice(0,-1).join("/")||"/";return{...this.$route,query:{dir:e}}},shareAttributes(){var e,r,n,o;if((r=(e=this.currentFolder)==null?void 0:e.attributes)!=null&&r["share-types"])return Object.values(((o=(n=this.currentFolder)==null?void 0:n.attributes)==null?void 0:o["share-types"])||{}).flat()},shareButtonLabel(){return this.shareAttributes?this.shareButtonType===wt.SHARE_TYPE_LINK?this.t("files","Shared by link"):this.t("files","Shared"):this.t("files","Share")},shareButtonType(){return this.shareAttributes?this.shareAttributes.some(e=>e===wt.SHARE_TYPE_LINK)?wt.SHARE_TYPE_LINK:wt.SHARE_TYPE_USER:null},gridViewButtonLabel(){return this.userConfig.grid_view?this.t("files","Switch to list view"):this.t("files","Switch to grid view")},canUpload(){return this.currentFolder&&(this.currentFolder.permissions&Tt.CREATE)!==0},isQuotaExceeded(){var e,r;return((r=(e=this.currentFolder)==null?void 0:e.attributes)==null?void 0:r["quota-available-bytes"])===0},cantUploadLabel(){return this.isQuotaExceeded?this.t("files","Your have used your space quota and cannot upload files anymore"):this.t("files","You don’t have permission to upload or create files here")},canShare(){return bu&&this.currentFolder&&(this.currentFolder.permissions&Tt.SHARE)!==0}},watch:{currentView(e,r){(e==null?void 0:e.id)!==(r==null?void 0:r.id)&&(V.debug("View changed",{newView:e,oldView:r}),this.selectionStore.reset(),this.resetSearch(),this.fetchContent())},dir(e,r){var n,o;V.debug("Directory changed",{newDir:e,oldDir:r}),this.selectionStore.reset(),this.resetSearch(),this.fetchContent(),(o=(n=this.$refs)==null?void 0:n.filesListVirtual)!=null&&o.$el&&(this.$refs.filesListVirtual.$el.scrollTop=0)},dirContents(e){V.debug("Directory contents changed",{view:this.currentView,folder:this.currentFolder,contents:e}),At("files:list:updated",{view:this.currentView,folder:this.currentFolder,contents:e})}},mounted(){this.fetchContent(),nt("files:node:updated",this.onUpdatedNode),nt("nextcloud:unified-search.search",this.onSearch),nt("nextcloud:unified-search.reset",this.onSearch),this._unsubscribeStore=this.userConfigStore.$subscribe(()=>this.fetchContent(),{deep:!0})},unmounted(){ie("files:node:updated",this.onUpdatedNode),ie("nextcloud:unified-search.search",this.onSearch),ie("nextcloud:unified-search.reset",this.onSearch),this._unsubscribeStore()},methods:{async fetchContent(){var e;this.loading=!0;const r=this.dir,n=this.currentView;if(!n){V.debug("The current view doesn't exists or is not ready.",{currentView:n});return}typeof((e=this.promise)==null?void 0:e.cancel)=="function"&&(this.promise.cancel(),V.debug("Cancelled previous ongoing fetch")),this.promise=n.getContents(r);try{const{folder:o,contents:l}=await this.promise;V.debug("Fetched contents",{dir:r,folder:o,contents:l}),this.filesStore.updateNodes(l),this.$set(o,"_children",l.map(i=>i.fileid)),r==="/"?this.filesStore.setRoot({service:n.id,root:o}):o.fileid?(this.filesStore.updateNodes([o]),this.pathsStore.addPath({service:n.id,fileid:o.fileid,path:r})):V.error("Invalid root folder returned",{dir:r,folder:o,currentView:n}),l.filter(i=>i.type==="folder").forEach(i=>{this.pathsStore.addPath({service:n.id,fileid:i.fileid,path:It.join(r,i.basename)})})}catch(o){V.error("Error while fetching content",{error:o})}finally{this.loading=!1}},getNode(e){return this.filesStore.getNode(e)},onUpload(e){var r;It.dirname(e.source)===((r=this.currentFolder)==null?void 0:r.source)&&this.fetchContent()},async onUploadFail(e){var r,n;const o=((r=e.response)==null?void 0:r.status)||0;if(o===507){X(this.t("files","Not enough free space"));return}else if(o===404||o===409){X(this.t("files","Target folder does not exist any more"));return}else if(o===403){X(this.t("files","Operation is blocked by access control"));return}try{const l=(await new Pi({trim:!0,explicitRoot:!1}).parseStringPromise((n=e.response)==null?void 0:n.data))["s:message"][0];if(typeof l=="string"&&l.trim()!==""){X(this.t("files","Error during upload: {message}",{message:l}));return}}catch(l){V.error("Error while parsing",{error:l})}if(o!==0){X(this.t("files","Error during upload, status code {status}",{status:o}));return}X(this.t("files","Unknown error during upload"))},onUpdatedNode(e){var r;(e==null?void 0:e.fileid)===((r=this.currentFolder)==null?void 0:r.fileid)&&this.fetchContent()},onSearch:Zo(function(e){console.debug("Files app handling search event from unified search...",e),this.filterText=e.query},500),resetSearch(){this.filterText=""},openSharingSidebar(){var e,r,n;if(!this.currentFolder){V.debug("No current folder found for opening sharing sidebar");return}(n=(r=(e=window==null?void 0:window.OCA)==null?void 0:e.Files)==null?void 0:r.Sidebar)!=null&&n.setActiveTab&&window.OCA.Files.Sidebar.setActiveTab("sharing"),zt.exec(this.currentFolder,this.currentView,this.currentFolder.path)},toggleGridView(){this.userConfigStore.update("grid_view",!this.userConfig.grid_view)},t:B,n:To}});var Tu=function(){var n,o;var e=this,r=e._self._c;return e._self._setupProxy,r("NcAppContent",{attrs:{"page-heading":e.pageHeading,"data-cy-files-content":""}},[r("div",{staticClass:"files-list__header"},[r("BreadCrumbs",{attrs:{path:e.dir},on:{reload:e.fetchContent},scopedSlots:e._u([{key:"actions",fn:function(){return[e.canShare&&e.filesListWidth>=512?r("NcButton",{staticClass:"files-list__header-share-button",class:{"files-list__header-share-button--shared":e.shareButtonType},attrs:{"aria-label":e.shareButtonLabel,title:e.shareButtonLabel,type:"tertiary"},on:{click:e.openSharingSidebar},scopedSlots:e._u([{key:"icon",fn:function(){return[e.shareButtonType===e.Type.SHARE_TYPE_LINK?r("LinkIcon"):r("AccountPlusIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,2969853559)}):e._e(),!e.canUpload||e.isQuotaExceeded?r("NcButton",{staticClass:"files-list__header-upload-button--disabled",attrs:{"aria-label":e.cantUploadLabel,title:e.cantUploadLabel,disabled:!0,type:"secondary"},scopedSlots:e._u([{key:"icon",fn:function(){return[r("PlusIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,2953566425)},[e._v(" "+e._s(e.t("files","New"))+" ")]):e.currentFolder?r("UploadPicker",{staticClass:"files-list__header-upload-button",attrs:{content:e.dirContents,destination:e.currentFolder,multiple:!0},on:{failed:e.onUploadFail,uploaded:e.onUpload}}):e._e()]},proxy:!0}])}),e.filesListWidth>=512&&e.enableGridView?r("NcButton",{staticClass:"files-list__header-grid-button",attrs:{"aria-label":e.gridViewButtonLabel,title:e.gridViewButtonLabel,type:"tertiary"},on:{click:e.toggleGridView},scopedSlots:e._u([{key:"icon",fn:function(){return[e.userConfig.grid_view?r("ListViewIcon"):r("ViewGridIcon")]},proxy:!0}],null,!1,1682960703)}):e._e(),e.isRefreshing?r("NcLoadingIcon",{staticClass:"files-list__refresh-icon"}):e._e()],1),!e.loading&&e.canUpload?r("DragAndDropNotice",{attrs:{"current-folder":e.currentFolder}}):e._e(),e.loading&&!e.isRefreshing?r("NcLoadingIcon",{staticClass:"files-list__loading-icon",attrs:{size:38,name:e.t("files","Loading current folder")}}):!e.loading&&e.isEmptyDir?r("NcEmptyContent",{attrs:{name:((n=e.currentView)==null?void 0:n.emptyTitle)||e.t("files","No files in here"),description:((o=e.currentView)==null?void 0:o.emptyCaption)||e.t("files","Upload some content or sync with your devices!"),"data-cy-files-content-empty":""},scopedSlots:e._u([{key:"action",fn:function(){return[e.dir!=="/"?r("NcButton",{attrs:{"aria-label":e.t("files","Go to the previous folder"),type:"primary",to:e.toPreviousDir}},[e._v(" "+e._s(e.t("files","Go back"))+" ")]):e._e()]},proxy:!0},{key:"icon",fn:function(){return[r("NcIconSvgWrapper",{attrs:{svg:e.currentView.icon}})]},proxy:!0}])}):r("FilesListVirtual",{ref:"filesListVirtual",attrs:{"current-folder":e.currentFolder,"current-view":e.currentView,nodes:e.dirContentsSorted}})],1)},Su=[],Nu=J(_u,Tu,Su,!1,null,"6d29e508");const Eu=Nu.exports,Du=et({name:"FilesApp",components:{NcContent:So,FilesList:Eu,Navigation:Ds}});var Cu=function(){var e=this,r=e._self._c;return e._self._setupProxy,r("NcContent",{attrs:{"app-name":"files"}},[r("Navigation"),r("FilesList")],1)},xu=[],Ou=J(Du,Cu,xu,!1,null,null);const Au=Ou.exports;var ri,ni;window.OCA.Files=(ri=window.OCA.Files)!=null?ri:{},window.OCP.Files=(ni=window.OCP.Files)!=null?ni:{};const Iu=new rs(fi);Object.assign(window.OCP.Files,{Router:Iu}),H.use(Hi);const Pu=H.observable(ii());H.prototype.$navigation=Pu;const Fu=new is;Object.assign(window.OCA.Files,{Settings:Fu}),Object.assign(window.OCA.Files.Settings,{Setting:ns});const Lu=H.extend(Au);new Lu({router:fi,pinia:Oo}).$mount("#content");
