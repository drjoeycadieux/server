const __vite__fileDeps=["./chunks/TemplatePicker-BUmmP6hD.mjs","./core-common.mjs","./chunks/index-7XKGWWeV.mjs","./chunks/_plugin-vue2_normalizer-VrK6B12S-B9aYHv6f.mjs","./chunks/index-BdIeO5n5.mjs","./chunks/index-CFlSzEWv.mjs","./chunks/index-Dizl7-P2.mjs","./chunks/icons-Dg_LJaFK.mjs","./chunks/logger-abzvQ-j7.mjs"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
/*! third party licenses: dist/vendor.LICENSE.txt */
import{e as h,N as c,L as u,W as H,v as V,w as te,g as S,u as ie,h as ne,f as C,p as g,b as oe,d as re,a as se,D as _,T as ae,t as p,o as A}from"./chunks/index-BdIeO5n5.mjs";import{bS as b,bR as w,bT as n,b_ as T,b$ as Y,bY as y,aW as G,a$ as le,F as de,T as ce,al as fe,c0 as R,a_ as ue,c1 as L,ck as pe}from"./core-common.mjs";import{p as I}from"./chunks/index-7XKGWWeV.mjs";import{j as me,z as J,B as he}from"./chunks/_plugin-vue2_normalizer-VrK6B12S-B9aYHv6f.mjs";import{av as we,b7 as ye,b8 as ve,b9 as ge,ba as be,bb as Ne,bc as K,bd as O,b6 as Ce,aO as De,n as Fe,be as Se,bf as Ee,aa as xe,aq as Te}from"./chunks/icons-Dg_LJaFK.mjs";import{l as d}from"./chunks/logger-abzvQ-j7.mjs";import{e as Q}from"./chunks/index-CFlSzEWv.mjs";import{a as Re,b as Ie,p as Oe,i as Pe,c as ke}from"./chunks/LivePhotos-CUhPYrnz.mjs";import{a as _e}from"./chunks/sidebarAction-Cvd2IrgV.mjs";import{u as Ae}from"./chunks/index-BHGcQw02.mjs";import{_ as Le}from"./chunks/preload-helper-BG02UnR2.mjs";import{g as We,r as W,h as Ue,a as X}from"./chunks/Files-CnJT5alL.mjs";import"./chunks/index-Dizl7-P2.mjs";import"./chunks/pinia-DMoXqkoa.mjs";import"./chunks/index-BxD44Goc.mjs";const v=e=>e.every(t=>t.attributes["is-mount-root"]===!0&&t.attributes["mount-type"]==="shared"),E=e=>e.every(t=>t.attributes["is-mount-root"]===!0&&t.attributes["mount-type"]==="external"),$e=e=>{if(e.length===1)return!1;const t=e.some(o=>v([o])),i=e.some(o=>!v([o]));return t&&i},qe=e=>!e.some(t=>t.type!==u.File),Be=e=>!e.some(t=>t.type!==u.Folder),U=(e,t)=>t.id==="trashbin"?n("files","Delete permanently"):$e(e)?n("files","Delete and unshare"):v(e)?e.length===1?n("files","Leave this share"):n("files","Leave these shares"):E(e)?e.length===1?n("files","Disconnect storage"):n("files","Disconnect storages"):qe(e)?e.length===1?n("files","Delete file"):n("files","Delete files"):Be(e)?e.length===1?n("files","Delete folder"):n("files","Delete folders"):n("files","Delete"),je=new h({id:"delete",displayName:U,iconSvgInline:e=>v(e)?we:E(e)?ye:ve,enabled(e){return e.length>0&&e.map(t=>t.permissions).every(t=>(t&c.DELETE)!==0)},async exec(e){try{return await b.delete(e.encodedSource),w("files:node:deleted",e),!0}catch(t){return d.error("Error while deleting a file",{error:t,source:e.source,node:e}),!1}},async execBatch(e,t,i){return await new Promise(o=>{if(e.length>=5&&!v(e)&&!E(e)){window.OC.dialogs.confirmDestructive(n("files","You are about to delete {count} items.",{count:e.length}),n("files","Confirm deletion"),{type:window.OC.dialogs.YES_NO_BUTTONS,confirm:U(e,t),confirmClasses:"error",cancel:n("files","Cancel")},s=>{o(s)});return}o(!0)})===!1?(me(n("files","Deletion cancelled")),Promise.all(e.map(()=>!1))):Promise.all(e.map(o=>this.exec(o,t,i)))},order:100}),Z=function(e){const t=document.createElement("a");t.download="",t.href=e,t.click()},$=function(e,t){const i=Math.random().toString(36).substring(2),o=T("/apps/files/ajax/download.php?dir={dir}&files={files}&downloadStartSecret={secret}",{dir:e,secret:i,files:JSON.stringify(t.map(s=>s.basename))});Z(o)},Me=function(e){var t,i;if(!(e.permissions&c.READ))return!1;if(e.attributes["mount-type"]==="shared"){const o=JSON.parse((t=e.attributes["share-attributes"])!=null?t:"null"),s=(i=o==null?void 0:o.find)==null?void 0:i.call(o,a=>a.scope==="permissions"&&a.key==="download");if(s!==void 0&&s.enabled===!1)return!1}return!0},ze=new h({id:"download",displayName:()=>n("files","Download"),iconSvgInline:()=>ge,enabled(e){return e.length===0||e.some(t=>t.type===u.Folder)&&e.some(t=>{var i;return!((i=t.root)!=null&&i.startsWith("/files"))})?!1:e.every(Me)},async exec(e,t,i){return e.type===u.Folder?($(i,[e]),null):(Z(e.encodedSource),null)},async execBatch(e,t,i){return e.length===1?(this.exec(e[0],t,i),[null]):($(i,e),new Array(e.length).fill(null))},order:30}),He=async function(e){var t;const i=Y("apps/files/api/v1")+"/openlocaleditor?format=json";try{const o=await b.post(i,{path:e}),s=(t=y())==null?void 0:t.uid;let a="nc://open/".concat(s,"@")+window.location.host+Q(e);a+="?token="+o.data.ocs.data.token,window.location.href=a}catch{J(n("files","Failed to redirect to client"))}},Ve=new h({id:"edit-locally",displayName:()=>n("files","Edit locally"),iconSvgInline:()=>be,enabled(e){return e.length!==1?!1:(e[0].permissions&c.UPDATE)!==0},async exec(e){return He(e.path),null},order:25}),N=e=>e.some(t=>t.attributes.favorite!==1),q=async(e,t,i)=>{try{const o=T("/apps/files/api/v1/files")+Q(e.path);return await b.post(o,{tags:i?[window.OC.TAG_FAVORITE]:[]}),t.id==="favorites"&&!i&&e.dirname==="/"&&w("files:node:deleted",e),G.set(e.attributes,"favorite",i?1:0),i?w("files:favorites:added",e):w("files:favorites:removed",e),!0}catch(o){const s=i?"adding a file to favourites":"removing a file from favourites";return d.error("Error while "+s,{error:o,source:e.source,node:e}),!1}},Ye=new h({id:"favorite",displayName(e){return N(e)?n("files","Add to favorites"):n("files","Remove from favorites")},iconSvgInline:e=>N(e)?Ne:K,enabled(e){return!e.some(t=>{var i,o;return!((o=(i=t.root)==null?void 0:i.startsWith)!=null&&o.call(i,"/files"))})&&e.every(t=>t.permissions!==c.NONE)},async exec(e,t){const i=N([e]);return await q(e,t,i)},async execBatch(e,t){const i=N(e);return Promise.all(e.map(async o=>await q(o,t,i)))},order:-50}),Ge=new h({id:"open-folder",displayName(e){const t=e[0].attributes.displayName||e[0].basename;return n("files","Open folder {displayName}",{displayName:t})},iconSvgInline:()=>O,enabled(e){if(e.length!==1)return!1;const t=e[0];return t.isDavRessource?t.type===u.Folder&&(t.permissions&c.READ)!==0:!1},async exec(e,t){return!e||e.type!==u.Folder?!1:(window.OCP.Files.Router.goToRoute(null,{view:t.id,fileid:e.fileid},{dir:e.path}),null)},default:H.HIDDEN,order:-100}),Je=new h({id:"open-in-files-recent",displayName:()=>n("files","Open in Files"),iconSvgInline:()=>"",enabled:(e,t)=>t.id==="recent",async exec(e){let t=e.dirname;return e.type===u.Folder&&(t=t+"/"+e.basename),window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:e.fileid},{dir:t}),null},order:-1e3,default:H.HIDDEN}),Ke=new h({id:"rename",displayName:()=>n("files","Rename"),iconSvgInline:()=>Ce,enabled:e=>e.length>0&&e.map(t=>t.permissions).every(t=>(t&c.UPDATE)!==0),async exec(e){return w("files:node:rename",e),null},order:10}),Qe=new h({id:"view-in-folder",displayName(){return n("files","View in folder")},iconSvgInline:()=>De,enabled(e,t){if(t.id==="files"||e.length!==1)return!1;const i=e[0];return!i.isDavRessource||i.permissions===c.NONE?!1:i.type===u.File},async exec(e){return!e||e.type!==u.File?!1:(window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:e.fileid},{dir:e.dirname}),null)},order:80}),Xe=le({name:"NewNodeDialog",components:{NcButton:de,NcDialog:ce,NcTextField:fe},props:{defaultName:{type:String,default:n("files","New folder")},otherNames:{type:Array,default:()=>[]},open:{type:Boolean,default:!0},name:{type:String,default:n("files","Create new folder")},label:{type:String,default:n("files","Folder name")}},emits:{close:e=>e===null||e},data(){return{localDefaultName:this.defaultName||n("files","New folder")}},computed:{errorMessage(){return this.isUniqueName?"":n("files","A file or folder with that name already exists.")},uniqueName(){return Re(this.localDefaultName,this.otherNames)},isUniqueName(){return this.localDefaultName===this.uniqueName}},watch:{defaultName(){this.localDefaultName=this.defaultName||n("files","New folder")},open(){this.$nextTick(()=>this.focusInput())}},mounted(){this.localDefaultName=this.uniqueName,this.$nextTick(()=>this.focusInput())},methods:{t:n,focusInput(){this.open&&this.$nextTick(()=>{var e,t;return(t=(e=this.$refs.input)==null?void 0:e.focus)==null?void 0:t.call(e)})},onCreate(){this.$emit("close",this.localDefaultName)},onClose(e){e||this.$emit("close",null)}}});var Ze=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("NcDialog",{attrs:{name:e.name,open:e.open,"close-on-click-outside":"","out-transition":""},on:{"update:open":e.onClose},scopedSlots:e._u([{key:"actions",fn:function(){return[t("NcButton",{attrs:{type:"primary",disabled:!e.isUniqueName},on:{click:e.onCreate}},[e._v(" "+e._s(e.t("files","Create"))+" ")])]},proxy:!0}])},[t("form",{on:{submit:function(i){return i.preventDefault(),e.onCreate.apply(null,arguments)}}},[t("NcTextField",{ref:"input",attrs:{error:!e.isUniqueName,"helper-text":e.errorMessage,label:e.label,value:e.localDefaultName},on:{"update:value":function(i){e.localDefaultName=i}}})],1)])},et=[],tt=Fe(Xe,Ze,et,!1,null,null);const it=tt.exports;function P(e,t,i={}){const o=t.map(s=>s.basename);return new Promise(s=>{Ae(it,{...i,defaultName:e,otherNames:o},a=>{s(a)})})}const nt=async(e,t)=>{const i=e.source+"/"+t,o=e.encodedSource+"/"+encodeURIComponent(t),s=await b({method:"MKCOL",url:o,headers:{Overwrite:"F"}});return{fileid:parseInt(s.headers["oc-fileid"]),source:i}},ot={id:"newFolder",displayName:n("files","New folder"),enabled:e=>(e.permissions&c.CREATE)!==0,iconSvgInline:Se,order:0,async handler(e,t){var i,o,s,a,r;const l=await P(n("files","New folder"),t);if(l!==null){const{fileid:f,source:m}=await nt(e,l),D=new V({source:m,id:f,mtime:new Date,owner:((i=y())==null?void 0:i.uid)||null,permissions:c.ALL,root:(e==null?void 0:e.root)||"/files/"+((o=y())==null?void 0:o.uid),attributes:{"mount-type":(s=e.attributes)==null?void 0:s["mount-type"],"owner-id":(a=e.attributes)==null?void 0:a["owner-id"],"owner-display-name":(r=e.attributes)==null?void 0:r["owner-display-name"]}});he(n("files",'Created new folder "{name}"',{name:I.basename(m)})),d.debug("Created new folder",{folder:D,source:m}),w("files:node:created",D),window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:D.fileid},{dir:e.path})}}};let k=R("files","templates_path",!1);d.debug("Initial templates folder",{templatesPath:k});const rt=async function(e,t){const i=I.join(e.path,t);try{d.debug("Initializing the templates directory",{templatePath:i});const{data:o}=await b.post(Y("apps/files/api/v1/templates/path"),{templatePath:i,copySystemTemplates:!0});window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:void 0},{dir:i}),d.info("Created new templates folder",{...o.ocs.data}),k=o.ocs.data.templates_path}catch{d.error("Unable to initialize the templates directory"),J(n("files","Unable to initialize the templates directory"))}},st={id:"template-picker",displayName:n("files","Create new templates folder"),iconSvgInline:Ee,order:10,enabled(e){var t;return k||e.owner!==((t=y())==null?void 0:t.uid)?!1:(e.permissions&c.CREATE)!==0},async handler(e,t){const i=await P(n("files","Templates"),t,{name:n("files","New template folder")});i!==null&&(rt(e,i),te("template-picker"))}},at=ue(()=>Le(()=>import("./chunks/TemplatePicker-BUmmP6hD.mjs"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url));let F=null;const lt=async e=>{if(F===null){const t=document.createElement("div");t.id="template-picker",document.body.appendChild(t),F=new G({render:i=>i(at,{ref:"picker",props:{parent:e}}),methods:{open(...i){this.$refs.picker.open(...i)}},el:t})}return F};function dt(){R("files","templates",[]).forEach((e,t)=>{S({id:"template-new-".concat(e.app,"-").concat(t),displayName:e.label,iconClass:e.iconClass||"icon-file",iconSvgInline:e.iconSvgInline,enabled(i){return(i.permissions&c.CREATE)!==0},order:11,async handler(i,o){const s=lt(i),a=await P("".concat(e.label).concat(e.extension),o,{label:n("files","Filename"),name:e.label});a!==null&&(await s).open(a,e)}})})}const B=We(),ee=async(e="/")=>{const t=ie(),i=ne();let o;e==="/"&&(o=await B.stat(e,{details:!0,data:t}));const s=await B.getDirectoryContents(e,{details:!0,data:e==="/"?i:t,headers:{method:e==="/"?"REPORT":"PROPFIND"},includeSelf:!0}),a=(o==null?void 0:o.data)||s.data[0],r=s.data.filter(l=>l.filename!==e);return{folder:W(a),contents:r.map(W)}},j=function(e,t=0){return new g({id:x(e.path),name:I.basename(e.path),icon:O,order:t,params:{dir:e.path,fileid:e.fileid.toString(),view:"favorites"},parent:"favorites",columns:[],getContents:ee})},x=function(e){return"favorite-".concat(Ue(e))},ct=()=>{const e=R("files","favoriteFolders",[]),t=e.map((r,l)=>j(r,l));d.debug("Generating favorites view",{favoriteFolders:e});const i=C();i.register(new g({id:"favorites",name:n("files","Favorites"),caption:n("files","List of favorites files and folders."),emptyTitle:n("files","No favorites yet"),emptyCaption:n("files","Files and folders you mark as favorite will show up here"),icon:K,order:15,columns:[],getContents:ee})),t.forEach(r=>i.register(r)),L("files:favorites:added",r=>{var l;if(r.type===u.Folder){if(r.path===null||!((l=r.root)!=null&&l.startsWith("/files"))){d.error("Favorite folder is not within user files root",{node:r});return}s(r)}}),L("files:favorites:removed",r=>{var l;if(r.type===u.Folder){if(r.path===null||!((l=r.root)!=null&&l.startsWith("/files"))){d.error("Favorite folder is not within user files root",{node:r});return}a(r.path)}});const o=function(){e.sort((r,l)=>r.path.localeCompare(l.path,pe(),{ignorePunctuation:!0})),e.forEach((r,l)=>{const f=t.find(m=>m.id===x(r.path));f&&(f.order=l)})},s=function(r){const l={path:r.path,fileid:r.fileid},f=j(l);e.find(m=>m.path===r.path)||(e.push(l),t.push(f),o(),i.register(f))},a=function(r){const l=x(r),f=e.findIndex(m=>m.path===r);f!==-1&&(e.splice(f,1),t.splice(f,1),i.remove(l),o())}},ft=oe(),ut=Math.round(Date.now()/1e3-60*60*24*14),pt=async(e="/")=>{var t;const i=Ie(Oe),o=a=>e!=="/"||i.userConfig.show_hidden||!a.dirname.split("/").some(r=>r.startsWith(".")),s=(await ft.getDirectoryContents(e,{details:!0,data:re(ut),headers:{method:"SEARCH","Content-Type":"application/xml; charset=utf-8"},deep:!0})).data;return{folder:new V({id:0,source:"".concat(se).concat(_),root:_,owner:((t=y())==null?void 0:t.uid)||null,permissions:c.READ}),contents:s.map(a=>ae(a)).filter(o)}},mt=()=>{C().register(new g({id:"recent",name:n("files","Recent"),caption:n("files","List of recently modified files and folders."),emptyTitle:n("files","No recently modified files"),emptyCaption:n("files","Files and folders you recently modified will show up here."),icon:xe,order:10,defaultSortKey:"mtime",getContents:pt}))};var M;const z=(M=y())==null?void 0:M.uid,ht=function(e){const t=["group","shared"],i=e.attributes["mount-type"];return(z?e.owner===z:!0)&&!t.includes(i)},wt=(e="/")=>X(e).then(t=>(t.contents=t.contents.filter(ht),t)),yt=()=>{C().register(new g({id:"personal",name:n("files","Personal Files"),caption:n("files","List of your files and folders that are not shared."),emptyTitle:n("files","No personal files found"),emptyCaption:n("files","Files that are not shared will show up here."),icon:Te,order:5,getContents:wt}))},vt=()=>{C().register(new g({id:"files",name:n("files","All files"),caption:n("files","List of your files and folders."),icon:O,order:0,getContents:X}))},gt=()=>{"serviceWorker"in navigator?window.addEventListener("load",async()=>{try{const e=T("/apps/files/preview-service-worker.js",{},{noRewrite:!0}),t=await navigator.serviceWorker.register(e,{scope:"/"});d.debug("SW registered: ",{registration:t})}catch(e){d.error("SW registration failed: ",{error:e})}}):d.debug("Service Worker is not enabled on this browser.")};p(je),p(ze),p(Ve),p(Ye),p(ke),p(Ge),p(Je),p(Ke),p(_e),p(Qe),S(ot),S(st),dt(),ct(),vt(),mt(),yt(),gt(),A("nc:hidden",{nc:"http://nextcloud.org/ns"}),A("nc:is-mount-root",{nc:"http://nextcloud.org/ns"}),Pe();
