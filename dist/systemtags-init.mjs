/*! third party licenses: dist/vendor.LICENSE.txt */
import{e as y,o as h,t as v,v as d,N as m,S as w,V as T,f as b,p as E}from"./chunks/index-BdIeO5n5.mjs";import{bT as n,c2 as g,bY as f}from"./core-common.mjs";import{K as _}from"./chunks/icons-Dg_LJaFK.mjs";import{f as N}from"./chunks/api-4b9alufB.mjs";import{g as x,r as A}from"./chunks/Files-CnJT5alL.mjs";import"./chunks/index-7XKGWWeV.mjs";import"./chunks/index-CFlSzEWv.mjs";import"./chunks/index-Dizl7-P2.mjs";import"./chunks/logger-abzvQ-j7.mjs";const r=function(s){var t,e;const a=(e=(t=s.attributes)==null?void 0:t["system-tags"])==null?void 0:e["system-tag"];return a===void 0?[]:[a].flat()},l=function(s,t=!1){const e=document.createElement("li");return e.classList.add("files-list__system-tag"),e.textContent=s,t&&e.classList.add("files-list__system-tag--more"),e},C=new y({id:"system-tags",displayName:()=>"",iconSvgInline:()=>"",enabled(s){if(s.length!==1)return!1;const t=s[0];return r(t).length!==0},exec:async()=>null,async renderInline(s){const t=r(s);if(t.length===0)return null;const e=document.createElement("ul");if(e.classList.add("files-list__system-tags"),t.length===1)e.setAttribute("aria-label",n("files","This file has the tag {tag}",{tag:t[0]}));else{const a=t.slice(0,-1).join(", "),i=t[t.length-1];e.setAttribute("aria-label",n("files","This file has the tags {firstTags} and {lastTag}",{firstTags:a,lastTag:i}))}if(e.append(l(t[0])),t.length>1){const a=l("+"+(t.length-1),!0);a.setAttribute("title",t.slice(1).join(", ")),e.append(a)}return e},order:0});h("nc:system-tags"),v(C);const L=s=>'<?xml version="1.0"?>\n<oc:filter-files '.concat(w(),">\n	<d:prop>\n		").concat(T(),"\n	</d:prop>\n    <oc:filter-rules>\n        <oc:systemtag>").concat(s,"</oc:systemtag>\n    </oc:filter-rules>\n</oc:filter-files>"),c=function(s){var t;return new d({id:s.id,source:g("dav/systemtags/"+s.id),owner:(t=f())==null?void 0:t.uid,root:"/systemtags",permissions:m.READ,attributes:{...s,"is-tag":!0}})},I=async(s="/")=>{var t;const e=(await N()).filter(o=>o.userVisible);if(s==="/")return{folder:new d({id:0,source:g("dav/systemtags"),owner:(t=f())==null?void 0:t.uid,root:"/systemtags",permissions:m.NONE}),contents:e.map(c)};const a=parseInt(s.replace("/",""),10),i=e.find(o=>o.id===a);if(!i)throw new Error("Tag not found");const u=c(i),p=await x().getDirectoryContents("/",{details:!0,data:L(a),headers:{method:"REPORT"}});return{folder:u,contents:p.data.map(A)}},R=b();R.register(new E({id:"tags",name:n("systemtags","Tags"),caption:n("systemtags","List of tags and their associated files and folders."),emptyTitle:n("systemtags","No tags found"),emptyCaption:n("systemtags","Tags you have created will show up here."),icon:_,order:25,getContents:I}));
