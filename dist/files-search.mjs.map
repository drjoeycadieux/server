{"version":3,"file":"files-search.mjs","sources":["../apps/files/src/plugins/search/folderSearch.ts"],"sourcesContent":["/**\n * @copyright Copyright (c) 2024 Fon E. Noel NFEBE <opensource@nfebe.com>\n *\n * @author Fon E. Noel NFEBE <opensource@nfebe.com>\n *\n * @license GNU AGPL version 3 or any later version\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU Affero General Public License as\n * published by the Free Software Foundation, either version 3 of the\n * License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n */\n\nimport type { Node } from '@nextcloud/files'\nimport { emit } from '@nextcloud/event-bus'\nimport { getFilePickerBuilder } from '@nextcloud/dialogs';\nimport { imagePath } from '@nextcloud/router'\nimport { translate as t } from '@nextcloud/l10n'\nimport logger from '../../logger'\n\n/**\n * Initialize the unified search plugin.\n */\nfunction init() {\n\tconst OCA = window.OCA\n\tif (!OCA.UnifiedSearch) {\n\t\treturn\n\t}\n\n\tlogger.info('Initializing unified search plugin: folder search from files app');\n\tOCA.UnifiedSearch.registerFilterAction({\n\t\tid: 'files',\n\t\tappId: 'files',\n\t\tlabel: t('files', 'In folder'),\n\t\ticon: imagePath('files', 'app.svg'),\n\t\tcallback: () => {\n\t\t\tconst filepicker = getFilePickerBuilder('Pick plain text files')\n\t\t\t\t.addMimeTypeFilter('httpd/unix-directory')\n\t\t\t\t.allowDirectories(true)\n\t\t\t\t.addButton({\n\t\t\t\t\tlabel: 'Pick',\n\t\t\t\t\tcallback: (nodes: Node[]) => {\n\t\t\t\t\t\tlogger.info('Folder picked', { folder: nodes[0] })\n\t\t\t\t\t\tconst folder = nodes[0]\n\t\t\t\t\t\temit('nextcloud:unified-search:add-filter', {\n\t\t\t\t\t\t\tid: 'files',\n\t\t\t\t\t\t\tpayload: folder,\n\t\t\t\t\t\t\tfilterUpdateText: t('files', 'Search in folder: {folder}', { folder: folder.basename }),\n\t\t\t\t\t\t\tfilterParams: { path: folder.path },\n\t\t\t\t\t\t})\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\t.build()\n\t\t\tfilepicker.pick()\n\t\t},\n\t})\n}\n\ndocument.addEventListener('DOMContentLoaded', init)\n"],"names":["init","OCA","logger","t","imagePath","getFilePickerBuilder","nodes","folder","emit"],"mappings":";wSA+BA,SAASA,GAAO,CACf,MAAMC,EAAM,OAAO,IACdA,EAAI,gBAITC,EAAO,KAAK,kEAAkE,EAC9ED,EAAI,cAAc,qBAAqB,CACtC,GAAI,QACJ,MAAO,QACP,MAAOE,EAAE,QAAS,WAAW,EAC7B,KAAMC,EAAU,QAAS,SAAS,EAClC,SAAU,IAAM,CACIC,EAAqB,uBAAuB,EAC7D,kBAAkB,sBAAsB,EACxC,iBAAiB,EAAI,EACrB,UAAU,CACV,MAAO,OACP,SAAWC,GAAkB,CAC5BJ,EAAO,KAAK,gBAAiB,CAAE,OAAQI,EAAM,CAAC,EAAG,EAC3C,MAAAC,EAASD,EAAM,CAAC,EACtBE,EAAK,sCAAuC,CAC3C,GAAI,QACJ,QAASD,EACT,iBAAkBJ,EAAE,QAAS,6BAA8B,CAAE,OAAQI,EAAO,SAAU,EACtF,aAAc,CAAE,KAAMA,EAAO,IAAK,CAAA,CAClC,CACF,CAAA,CACA,EACA,MAAM,EACG,KAAK,CACjB,CAAA,CACA,EACF,CAEA,SAAS,iBAAiB,mBAAoBP,CAAI"}