/*! third party licenses: dist/vendor.LICENSE.txt */
import{b_ as r,bS as o,G as N,a7 as m,F as k,I as V,c0 as g,a4 as C,al as F,a$ as M,af as A,ai as S,aY as y,bT as v,aW as h}from"./core-common.mjs";import{A as T,r as $}from"./chunks/AppOrderSelector-CwX1_l01.mjs";import{n as u,b2 as x,b3 as q,a3 as U,b4 as I}from"./chunks/icons-Dg_LJaFK.mjs";import{a as P}from"./chunks/index-D61A_Z5g.mjs";import"./chunks/index-7XKGWWeV.mjs";import{z as L}from"./chunks/_plugin-vue2_normalizer-VrK6B12S-B9aYHv6f.mjs";import"./chunks/sortable.esm-D5slCXxa.mjs";const B=["color","logo","background","logoheader","favicon","disable-user-theming"],w={emits:["update:theming"],data(){return{showSuccess:!1,errorMessage:""}},computed:{id(){return"admin-theming-".concat(this.name)}},methods:{reset(){this.showSuccess=!1,this.errorMessage=""},handleSuccess(){this.showSuccess=!0,setTimeout(()=>{this.showSuccess=!1},2e3),B.includes(this.name)&&this.$emit("update:theming")}}},f={mixins:[w],watch:{value(e){this.localValue=e}},data(){return{localValue:this.value}},methods:{async save(){var i;this.reset();const e=r("/apps/theming/ajax/updateStylesheet"),a=this.localValue===!0?"yes":this.localValue===!1?"no":this.localValue;try{await o.post(e,{setting:this.name,value:a}),this.$emit("update:value",this.localValue),this.handleSuccess()}catch(s){this.errorMessage=(i=s.response.data.data)==null?void 0:i.message}},async undo(){var a;this.reset();const e=r("/apps/theming/ajax/undoChanges");try{await o.post(e,{setting:this.name}),this.$emit("update:value",this.defaultValue),this.handleSuccess()}catch(i){this.errorMessage=(a=i.response.data.data)==null?void 0:a.message}}}},D={name:"CheckboxField",components:{NcCheckboxRadioSwitch:N,NcNoteCard:m},mixins:[f],props:{name:{type:String,required:!0},value:{type:Boolean,required:!0},defaultValue:{type:Boolean,required:!0},displayName:{type:String,required:!0},label:{type:String,required:!0},description:{type:String,required:!0}}};var R=function(){var e=this,a=e._self._c;return a("div",{staticClass:"field"},[a("label",{attrs:{for:e.id}},[e._v(e._s(e.displayName))]),a("div",{staticClass:"field__row"},[a("NcCheckboxRadioSwitch",{attrs:{type:"switch",id:e.id,checked:e.localValue},on:{"update:checked":[function(i){e.localValue=i},e.save]}},[e._v(" "+e._s(e.label)+" ")])],1),a("p",{staticClass:"field__description"},[e._v(e._s(e.description))]),e.errorMessage?a("NcNoteCard",{attrs:{type:"error","show-alert":!0}},[a("p",[e._v(e._s(e.errorMessage))])]):e._e()],1)},z=[],j=u(D,R,z,!1,null,"b415526c");const O=j.exports,E={name:"ColorPickerField",components:{NcButton:k,NcColorPicker:V,NcNoteCard:m,Undo:x,Palette:q},mixins:[f],props:{name:{type:String,required:!0},value:{type:String,required:!0},defaultValue:{type:String,required:!0},displayName:{type:String,required:!0}},methods:{debounceSave:P.debounce(async function(){await this.save()},200)}};var G=function(){var e=this,a=e._self._c;return a("div",{staticClass:"field"},[a("label",{attrs:{for:e.id}},[e._v(e._s(e.displayName))]),a("div",{staticClass:"field__row"},[a("NcColorPicker",{attrs:{value:e.localValue,"advanced-fields":!0,"data-admin-theming-setting-primary-color-picker":""},on:{"update:value":[function(i){e.localValue=i},e.debounceSave]}},[a("NcButton",{attrs:{type:"secondary",id:e.id},scopedSlots:e._u([{key:"icon",fn:function(){return[a("Palette",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("theming","Change color"))+" ")])],1),a("div",{staticClass:"field__color-preview",attrs:{"data-admin-theming-setting-primary-color":""}}),e.value!==e.defaultValue?a("NcButton",{attrs:{type:"tertiary","aria-label":e.t("theming","Reset to default"),"data-admin-theming-setting-primary-color-reset":""},on:{click:e.undo},scopedSlots:e._u([{key:"icon",fn:function(){return[a("Undo",{attrs:{size:20}})]},proxy:!0}],null,!1,33666776)}):e._e()],1),e.errorMessage?a("NcNoteCard",{attrs:{type:"error","show-alert":!0}},[a("p",[e._v(e._s(e.errorMessage))])]):e._e()],1)},W=[],H=u(E,G,W,!1,null,"3053a5a4");const Y=H.exports,{allowedMimeTypes:J}=g("theming","adminThemingParameters",{}),K={name:"FileInputField",components:{Delete:U,NcButton:k,NcLoadingIcon:C,NcNoteCard:m,Undo:x,Upload:I},mixins:[w],props:{name:{type:String,required:!0},mimeName:{type:String,required:!0},mimeValue:{type:String,required:!0},defaultMimeValue:{type:String,required:!0},displayName:{type:String,required:!0},ariaLabel:{type:String,required:!0}},data(){return{showLoading:!1,acceptMime:(J[this.name]||["image/jpeg","image/png","image/gif","image/webp"]).join(",")}},computed:{showReset(){return this.mimeValue!==this.defaultMimeValue},showRemove(){return!!(this.name==="background"&&(this.mimeValue.startsWith("image/")||this.mimeValue===this.defaultMimeValue))}},methods:{activateLocalFilePicker(){this.reset(),this.$refs.input.value=null,this.$refs.input.click()},async onChange(e){var d;const a=e.target.files[0],i=new FormData;i.append("key",this.name),i.append("image",a);const s=r("/apps/theming/ajax/uploadImage");try{this.showLoading=!0,await o.post(s,i),this.showLoading=!1,this.$emit("update:mime-value",a.type),this.handleSuccess()}catch(c){this.showLoading=!1,this.errorMessage=(d=c.response.data.data)==null?void 0:d.message}},async undo(){var a;this.reset();const e=r("/apps/theming/ajax/undoChanges");try{await o.post(e,{setting:this.mimeName}),this.$emit("update:mime-value",this.defaultMimeValue),this.handleSuccess()}catch(i){this.errorMessage=(a=i.response.data.data)==null?void 0:a.message}},async removeBackground(){var a;this.reset();const e=r("/apps/theming/ajax/updateStylesheet");try{await o.post(e,{setting:this.mimeName,value:"backgroundColor"}),this.$emit("update:mime-value","backgroundColor"),this.handleSuccess()}catch(i){this.errorMessage=(a=i.response.data.data)==null?void 0:a.message}}}};var Q=function(){var e=this,a=e._self._c;return a("div",{staticClass:"field"},[a("label",{attrs:{for:e.id}},[e._v(e._s(e.displayName))]),a("div",{staticClass:"field__row"},[a("NcButton",{attrs:{type:"secondary",id:e.id,"aria-label":e.ariaLabel,"data-admin-theming-setting-file-picker":""},on:{click:e.activateLocalFilePicker},scopedSlots:e._u([{key:"icon",fn:function(){return[a("Upload",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("theming","Upload"))+" ")]),e.showReset?a("NcButton",{attrs:{type:"tertiary","aria-label":e.t("theming","Reset to default"),"data-admin-theming-setting-file-reset":""},on:{click:e.undo},scopedSlots:e._u([{key:"icon",fn:function(){return[a("Undo",{attrs:{size:20}})]},proxy:!0}],null,!1,33666776)}):e._e(),e.showRemove?a("NcButton",{attrs:{type:"tertiary","aria-label":e.t("theming","Remove background image"),"data-admin-theming-setting-file-remove":""},on:{click:e.removeBackground},scopedSlots:e._u([{key:"icon",fn:function(){return[a("Delete",{attrs:{size:20}})]},proxy:!0}],null,!1,2705356561)}):e._e(),e.showLoading?a("NcLoadingIcon",{staticClass:"field__loading-icon",attrs:{size:20}}):e._e()],1),(e.name==="logoheader"||e.name==="favicon")&&e.mimeValue!==e.defaultMimeValue?a("div",{staticClass:"field__preview",class:{"field__preview--logoheader":e.name==="logoheader","field__preview--favicon":e.name==="favicon"}}):e._e(),e.errorMessage?a("NcNoteCard",{attrs:{type:"error","show-alert":!0}},[a("p",[e._v(e._s(e.errorMessage))])]):e._e(),a("input",{ref:"input",attrs:{accept:e.acceptMime,type:"file"},on:{change:e.onChange}})],1)},X=[],Z=u(K,Q,X,!1,null,"ef8d85bf");const ee=Z.exports,te={name:"TextField",components:{NcTextField:F},mixins:[f],props:{name:{type:String,required:!0},value:{type:String,required:!0},defaultValue:{type:String,required:!0},type:{type:String,required:!0},displayName:{type:String,required:!0},placeholder:{type:String,required:!0},maxlength:{type:Number,required:!0}}};var ae=function(){var e=this,a=e._self._c;return a("div",{staticClass:"field"},[a("NcTextField",{attrs:{value:e.localValue,label:e.displayName,placeholder:e.placeholder,type:e.type,maxlength:e.maxlength,spellcheck:!1,success:e.showSuccess,error:!!e.errorMessage,"helper-text":e.errorMessage,"show-trailing-button":e.value!==e.defaultValue,"trailing-button-icon":"undo"},on:{"update:value":function(i){e.localValue=i},"trailing-button-click":e.undo,keydown:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:e.save.apply(null,arguments)},blur:e.save}})],1)},ie=[],se=u(te,ae,ie,!1,null,"1993d502");const le=se.exports,ne=M({name:"AppMenuSection",components:{AppOrderSelector:T,NcCheckboxRadioSwitch:N,NcSelect:A,NcSettingsSection:S},props:{defaultApps:{type:Array,required:!0}},emits:{"update:defaultApps":e=>Array.isArray(e)&&e.every(a=>typeof a=="string")},setup(e,{emit:a}){const i=y({get:()=>e.defaultApps.length>0,set:l=>{l?a("update:defaultApps",["dashboard","files"]):d.value=[]}}),s=Object.values(g("core","apps")).map(({id:l,name:n,icon:p})=>({label:n,id:l,icon:p})),d=y({get:()=>e.defaultApps.map(l=>s.filter(n=>n.id===l)[0]),set(l){c("defaultApps",l.map(n=>n.id)).then(()=>a("update:defaultApps",l.map(n=>n.id))).catch(()=>L(v("theming","Could not set global default apps")))}}),c=async(l,n)=>{const p=r("/apps/theming/ajax/updateAppMenu");return await o.put(p,{setting:l,value:n})};return{allApps:s,selectedApps:d,hasCustomDefaultApp:i,t:v}}});var re=function(){var e=this,a=e._self._c;return e._self._setupProxy,a("NcSettingsSection",{attrs:{name:e.t("theming","Navigation bar settings")}},[a("h3",[e._v(e._s(e.t("theming","Default app")))]),a("p",{staticClass:"info-note"},[e._v(" "+e._s(e.t("theming","The default app is the app that is e.g. opened after login or when the logo in the menu is clicked."))+" ")]),a("NcCheckboxRadioSwitch",{attrs:{checked:e.hasCustomDefaultApp,type:"switch","data-cy-switch-default-app":""},on:{"update:checked":function(i){e.hasCustomDefaultApp=i}}},[e._v(" "+e._s(e.t("theming","Use custom default app"))+" ")]),e.hasCustomDefaultApp?[a("h4",[e._v(e._s(e.t("theming","Global default app")))]),a("NcSelect",{attrs:{"close-on-select":!1,placeholder:e.t("theming","Global default apps"),options:e.allApps,multiple:!0},model:{value:e.selectedApps,callback:function(i){e.selectedApps=i},expression:"selectedApps"}}),a("h5",[e._v(e._s(e.t("theming","Default app priority")))]),a("p",{staticClass:"info-note"},[e._v(" "+e._s(e.t("theming","If an app is not enabled for a user, the next app with lower priority is used."))+" ")]),a("AppOrderSelector",{attrs:{value:e.selectedApps},on:{"update:value":function(i){e.selectedApps=i}}})]:e._e()],2)},oe=[],ue=u(ne,re,oe,!1,null,"b7b6c880");const de=ue.exports,{backgroundMime:me,canThemeIcons:ce,color:pe,docUrl:he,docUrlIcons:ge,faviconMime:fe,isThemable:ye,legalNoticeUrl:ve,logoheaderMime:_e,logoMime:be,name:Ne,notThemableErrorMessage:ke,privacyPolicyUrl:Se,slogan:xe,url:we,userThemingDisabled:Ve,defaultApps:Ce}=g("theming","adminThemingParameters"),_=[{name:"name",value:Ne,defaultValue:"Nextcloud",type:"text",displayName:t("theming","Name"),placeholder:t("theming","Name"),maxlength:250},{name:"url",value:we,defaultValue:"https://nextcloud.com",type:"url",displayName:t("theming","Web link"),placeholder:"https://…",maxlength:500},{name:"slogan",value:xe,defaultValue:t("theming","a safe home for all your data"),type:"text",displayName:t("theming","Slogan"),placeholder:t("theming","Slogan"),maxlength:500}],Fe={name:"color",value:pe,defaultValue:"#0082c9",displayName:t("theming","Color")},Me=[{name:"logo",mimeName:"logoMime",mimeValue:be,defaultMimeValue:"",displayName:t("theming","Logo"),ariaLabel:t("theming","Upload new logo")},{name:"background",mimeName:"backgroundMime",mimeValue:me,defaultMimeValue:"",displayName:t("theming","Background and login image"),ariaLabel:t("theming","Upload new background and login image")}],Ae=[{name:"imprintUrl",value:ve,defaultValue:"",type:"url",displayName:t("theming","Legal notice link"),placeholder:"https://…",maxlength:500},{name:"privacyUrl",value:Se,defaultValue:"",type:"url",displayName:t("theming","Privacy policy link"),placeholder:"https://…",maxlength:500}],Te=[{name:"logoheader",mimeName:"logoheaderMime",mimeValue:_e,defaultMimeValue:"",displayName:t("theming","Header logo"),ariaLabel:t("theming","Upload new header logo")},{name:"favicon",mimeName:"faviconMime",mimeValue:fe,defaultMimeValue:"",displayName:t("theming","Favicon"),ariaLabel:t("theming","Upload new favicon")}],$e={name:"disable-user-theming",value:Ve,defaultValue:!1,displayName:t("theming","User settings"),label:t("theming","Disable user theming"),description:t("theming","Although you can select and customize your instance, users can change their background and colors. If you want to enforce your customization, you can toggle this on.")},qe={name:"AdminTheming",components:{AppMenuSection:de,CheckboxField:O,ColorPickerField:Y,FileInputField:ee,NcNoteCard:m,NcSettingsSection:S,TextField:le},emits:["update:theming"],textFields:_,data(){return{textFields:_,colorPickerField:Fe,fileInputFields:Me,advancedTextFields:Ae,advancedFileInputFields:Te,userThemingField:$e,defaultApps:Ce,canThemeIcons:ce,docUrl:he,docUrlIcons:ge,isThemable:ye,notThemableErrorMessage:ke}}};var Ue=function(){var e=this,a=e._self._c;return a("section",[a("NcSettingsSection",{attrs:{name:e.t("theming","Theming"),description:e.t("theming","Theming makes it possible to easily customize the look and feel of your instance and supported clients. This will be visible for all users."),"doc-url":e.docUrl,"data-admin-theming-settings":""}},[a("div",{staticClass:"admin-theming"},[e.isThemable?e._e():a("NcNoteCard",{attrs:{type:"error","show-alert":!0}},[a("p",[e._v(e._s(e.notThemableErrorMessage))])]),e._l(e.textFields,function(i){return a("TextField",{key:i.name,attrs:{"data-admin-theming-setting-field":i.name,"default-value":i.defaultValue,"display-name":i.displayName,maxlength:i.maxlength,name:i.name,placeholder:i.placeholder,type:i.type,value:i.value},on:{"update:value":function(s){return e.$set(i,"value",s)},"update:theming":function(s){return e.$emit("update:theming")}}})}),a("ColorPickerField",{attrs:{name:e.colorPickerField.name,"default-value":e.colorPickerField.defaultValue,"display-name":e.colorPickerField.displayName,value:e.colorPickerField.value},on:{"update:value":function(i){return e.$set(e.colorPickerField,"value",i)},"update:theming":function(i){return e.$emit("update:theming")}}}),e._l(e.fileInputFields,function(i){return a("FileInputField",{key:i.name,attrs:{"aria-label":i.ariaLabel,"data-admin-theming-setting-file":i.name,"default-mime-value":i.defaultMimeValue,"display-name":i.displayName,"mime-name":i.mimeName,"mime-value":i.mimeValue,name:i.name},on:{"update:mimeValue":function(s){return e.$set(i,"mimeValue",s)},"update:mime-value":function(s){return e.$set(i,"mimeValue",s)},"update:theming":function(s){return e.$emit("update:theming")}}})}),a("div",{staticClass:"admin-theming__preview",attrs:{"data-admin-theming-preview":""}},[a("div",{staticClass:"admin-theming__preview-logo",attrs:{"data-admin-theming-preview-logo":""}})])],2)]),a("NcSettingsSection",{attrs:{name:e.t("theming","Advanced options")}},[a("div",{staticClass:"admin-theming-advanced"},[e._l(e.advancedTextFields,function(i){return a("TextField",{key:i.name,attrs:{name:i.name,value:i.value,"default-value":i.defaultValue,type:i.type,"display-name":i.displayName,placeholder:i.placeholder,maxlength:i.maxlength},on:{"update:value":function(s){return e.$set(i,"value",s)},"update:theming":function(s){return e.$emit("update:theming")}}})}),e._l(e.advancedFileInputFields,function(i){return a("FileInputField",{key:i.name,attrs:{name:i.name,"mime-name":i.mimeName,"mime-value":i.mimeValue,"default-mime-value":i.defaultMimeValue,"display-name":i.displayName,"aria-label":i.ariaLabel},on:{"update:mimeValue":function(s){return e.$set(i,"mimeValue",s)},"update:mime-value":function(s){return e.$set(i,"mimeValue",s)},"update:theming":function(s){return e.$emit("update:theming")}}})}),a("CheckboxField",{attrs:{name:e.userThemingField.name,value:e.userThemingField.value,"default-value":e.userThemingField.defaultValue,"display-name":e.userThemingField.displayName,label:e.userThemingField.label,description:e.userThemingField.description,"data-admin-theming-setting-disable-user-theming":""},on:{"update:theming":function(i){return e.$emit("update:theming")}}}),e.canThemeIcons?e._e():a("a",{attrs:{href:e.docUrlIcons,rel:"noreferrer noopener"}},[a("em",[e._v(e._s(e.t("theming","Install the ImageMagick PHP extension with support for SVG images to automatically generate favicons based on the uploaded logo and color.")))])])],2)]),a("AppMenuSection",{attrs:{"default-apps":e.defaultApps},on:{"update:defaultApps":function(i){e.defaultApps=i},"update:default-apps":function(i){e.defaultApps=i}}})],1)},Ie=[],Pe=u(qe,Ue,Ie,!1,null,"73142ee4");const Le=Pe.exports;h.prototype.OC=OC,h.prototype.t=t;const Be=h.extend(Le),b=new Be;b.$mount("#admin-theming"),b.$on("update:theming",$);
